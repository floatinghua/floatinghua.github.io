<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>唐杠杠的个人博客</title>
  <icon>https://www.gravatar.com/avatar/f1fbf9a74d6268e8a32f37b7ab05f752</icon>
  <subtitle>Stay hungry,Stay foolish</subtitle>
  <link href="https://floatinghua.github.io/atom.xml" rel="self"/>
  
  <link href="https://floatinghua.github.io/"/>
  <updated>2021-04-08T09:02:44.712Z</updated>
  <id>https://floatinghua.github.io/</id>
  
  <author>
    <name>wutang.cc</name>
    <email>465132483@qq.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hexo博客同步迁移</title>
    <link href="https://floatinghua.github.io/2021/04/08/hexo%E5%8D%9A%E5%AE%A2%E5%90%8C%E6%AD%A5%E8%BF%81%E7%A7%BB/"/>
    <id>https://floatinghua.github.io/2021/04/08/hexo%E5%8D%9A%E5%AE%A2%E5%90%8C%E6%AD%A5%E8%BF%81%E7%A7%BB/</id>
    <published>2021-04-08T08:26:17.000Z</published>
    <updated>2021-04-08T09:02:44.712Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>当你更换工作环境的时候，博客也需要同步更新，当然你可以完全拷贝文件夹，所以这边的做法就是上传到github上，因为本身就是部署到github上的静态页面</p></blockquote><h4 id="上传项目"><a href="#上传项目" class="headerlink" title="上传项目"></a>上传项目</h4><ol><li>建立hexo（随便你取名）的分支</li></ol><p><img src="http://cdn.wutang.cc/image-20210408163845707.png" alt="image-20210408163845707"></p><ol start="2"><li><p>在本地盘下（位置任意）右键Git bash here，执行以下指令，把 git clone xxx.github.io 项目文件克隆到本地,<strong>删除除了 .git 以外的所有文件夹</strong></p><p><img src="http://cdn.wutang.cc/image-20210408164126648.png" alt="image-20210408164126648"></p></li><li><p>然后将你博客文件夹内的所有文件复制到这个xxx.github.io 中</p></li><li><p>注意自己的gitignore文件是不是如图所示，一般默认就是这种</p><p><img src="http://cdn.wutang.cc/image-20210408164338333.png" alt="image-20210408164338333"></p></li></ol><ol start="5"><li><p>然后在 xxxx.github.io根目录下创建一个分支，并且切换到这个分支</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b hexo</span><br></pre></td></tr></table></figure></li></ol><p>​    </p><ol start="6"><li><p>添加文件到暂存区，这个地方有个<code>坑</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add --all</span><br></pre></td></tr></table></figure></li></ol><p>   <code>坑:</code></p><p>   如果是有主题的，你上传到git上可能主题文件夹就是空的，导致你拉下来的时候，主题都不见了，可能是该子文件夹下有.git文件夹导致无法上传</p><p>   删除子文件夹下.git后，依然无法提交子文件夹下的文件。</p><p>   就在 xxx.github.io 根目录下执行,反正就是要多添加一次，把主题文件夹添加进去</p>   <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached themes/xxx主题</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line"></span><br><span class="line">git commit -m "xxx"</span><br></pre></td></tr></table></figure><ol start="7"><li><p>提交</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m ""</span><br></pre></td></tr></table></figure></li></ol><ol start="8"><li><p>推送到仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin hexo</span><br></pre></td></tr></table></figure></li></ol><ol start="9"><li>最后记得检查下git上，主题文件夹是不是有东西，没有的就看下6里面的坑</li></ol><h4 id="新电脑-新环境"><a href="#新电脑-新环境" class="headerlink" title="新电脑\新环境"></a>新电脑\新环境</h4><blockquote><p>首先安装npm hexo就不多介绍了</p></blockquote><p>安装好之后，进入到你新建的博客目录安装模块</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">npm install hexo-generator-feed --save</span><br><span class="line">npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure><p>然后就可以继续写博客了</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>总的来说步骤很简单，就是遇见的坑不少</p>]]></content>
    
    
    <summary type="html">hexo 使用github博客同步迁移</summary>
    
    
    
    <category term="hexo" scheme="https://floatinghua.github.io/categories/hexo/"/>
    
    
    <category term="hexo" scheme="https://floatinghua.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>windows使用docker搭建minio</title>
    <link href="https://floatinghua.github.io/2021/03/30/windows%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAminio/"/>
    <id>https://floatinghua.github.io/2021/03/30/windows%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAminio/</id>
    <published>2021-03-30T08:11:40.000Z</published>
    <updated>2021-04-01T09:04:12.287Z</updated>
    
    <content type="html"><![CDATA[<p>官方文档：<a href="http://www.minio.org.cn/" target="_blank" rel="noopener">MinIO | 高性能，对Kubernetes友好的对象存储</a></p><p><a href="https://zhuanlan.zhihu.com/p/280128756" target="_blank" rel="noopener">详解块存储、文件存储、对象存储区别 - 知乎 (zhihu.com)</a></p><blockquote><p>总结来说用对象储存的好处：</p><ol><li>对象储存可扩展性高，储存方式类似于hash表</li><li>对象储存无需迁移，横向扩展，自动计算储存节点</li><li>安全性高 ，</li><li>访问方便：不光支持HTTP(S)协议，采用REST的API方式调用和检索数据，同样增加了NFS和SMB支持；</li><li>成本相对低</li><li>效率高，没有复杂的文件系统</li></ol></blockquote><p>当然要是有钱买个oss服务也是可以的，只是本着不花钱的原则嘛，就只能折腾了 </p><h4 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h4><p>比较简单</p><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p>-e “MINIO_ACCESS_KEY=TANG” 指定账号</p><p>-e “MINIO_SECRET_KEY=QWE123BNM” 指定密码</p><p>-v 指定挂载目录 minio上传的文件会在data目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9000:9000 --name minio -e "MINIO_ACCESS_KEY=TANG" -e "MINIO_SECRET_KEY=QWE123BNM" -v F:\minio\minio\data:/data -v F:\minio\minio\config:/root/.minio minio/minio server /data</span><br></pre></td></tr></table></figure><h5 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h5><p>运行得到下面的结果就行了：</p><p><img src="http://cdn.wutang.cc/image-20210401162012106.png" alt="image-20210401162012106"></p><h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><p>然后打开浏览器输入账号密码登录就行了</p><p><img src="http://cdn.wutang.cc/image-20210401162137851.png" alt="image-20210401162137851"></p><h5 id="新建bucket"><a href="#新建bucket" class="headerlink" title="新建bucket"></a>新建bucket</h5><p><img src="http://cdn.wutang.cc/image-20210401162402061.png" alt="image-20210401162402061"></p><p>这时候你就有储存空间了，接下来就是写代码了</p><p><strong>开启访问权限,这样才能通过路径访问</strong></p><p><img src="http://cdn.wutang.cc/image-20210401170103988.png" alt="image-20210401170103988"></p><p><img src="http://cdn.wutang.cc/image-20210401170113557.png" alt="image-20210401170113557"></p><h4 id="搭建项目"><a href="#搭建项目" class="headerlink" title="搭建项目"></a>搭建项目</h4><h5 id="引入maven依赖"><a href="#引入maven依赖" class="headerlink" title="引入maven依赖"></a>引入maven依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        minio对象存储--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="编写配置yaml"><a href="#编写配置yaml" class="headerlink" title="编写配置yaml"></a>编写配置yaml</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">minio:</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line"><span class="comment">#    访问地址</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://localhost:9000</span></span><br><span class="line"><span class="comment">#    账号</span></span><br><span class="line">    <span class="attr">access-key:</span> <span class="string">TANG</span></span><br><span class="line"><span class="comment">#    密码</span></span><br><span class="line">    <span class="attr">secret-key:</span> <span class="string">QWE123BNM</span></span><br><span class="line"><span class="comment">#    储存桶</span></span><br><span class="line">    <span class="attr">image-bucket:</span> <span class="string">images</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">200MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">200MB</span></span><br></pre></td></tr></table></figure><h5 id="自己的minioconfig-类"><a href="#自己的minioconfig-类" class="headerlink" title="自己的minioconfig 类"></a>自己的minioconfig 类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinIOConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;minio.config.url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;minio.config.access-key&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;minio.config.secret-key&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;minio.config.image-bucket&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String imageBucket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="util类"><a href="#util类" class="headerlink" title="util类"></a>util类</h5><p><strong>额外的方法自己看下api继续写就是的了</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinIOUtils</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinIOConfig minIOConfig;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MinioClient minioClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *初始化client</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            minioClient = <span class="keyword">new</span> MinioClient(minIOConfig.getUrl(), minIOConfig.getAccessKey(), minIOConfig.getSecretKey());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidEndpointException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidPortException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *上传文件返回路径</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> InvalidPortException, InvalidEndpointException, IOException, XmlPullParserException, NoSuchAlgorithmException, InvalidKeyException, InvalidArgumentException, InvalidResponseException, InternalException, NoResponseException, InvalidBucketNameException, InsufficientDataException, ErrorResponseException </span>&#123;</span><br><span class="line">        InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inputStream = file.getInputStream();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String substring = file.getOriginalFilename().substring(file.getOriginalFilename().lastIndexOf(<span class="string">"."</span>), file.getOriginalFilename().length());</span><br><span class="line">        String originalFilename = System.currentTimeMillis() + substring;</span><br><span class="line"><span class="comment">//        上传到minio</span></span><br><span class="line"></span><br><span class="line">        minioClient.putObject(minIOConfig.getImageBucket(), originalFilename, inputStream, file.getSize(), <span class="keyword">null</span>, <span class="keyword">null</span>, file.getContentType());</span><br><span class="line">        <span class="comment">//这边的桶要开启访问权限才能通过这个路径访问</span></span><br><span class="line">        String url = minioClient.getObjectUrl(minIOConfig.getImageBucket(), originalFilename);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    列出所有的bucket</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">listBuckets</span><span class="params">()</span> <span class="keyword">throws</span> InvalidPortException, InvalidEndpointException, IOException, InvalidKeyException, NoSuchAlgorithmException, InsufficientDataException, InvalidResponseException, InternalException, NoResponseException, InvalidBucketNameException, XmlPullParserException, ErrorResponseException </span>&#123;</span><br><span class="line">        List&lt;Bucket&gt; buckets = minioClient.listBuckets();</span><br><span class="line">        List&lt;String&gt; strings = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        buckets.forEach(m -&gt; &#123;</span><br><span class="line">            strings.add(m.name());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> strings;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">    根据文件名称删除</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String str)</span> <span class="keyword">throws</span> InvalidPortException, InvalidEndpointException, IOException, InvalidKeyException, NoSuchAlgorithmException, InsufficientDataException, InvalidArgumentException, InvalidResponseException, InternalException, NoResponseException, InvalidBucketNameException, XmlPullParserException, ErrorResponseException </span>&#123;</span><br><span class="line">        minioClient.removeObject(minIOConfig.getImageBucket(), str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>api还是比较简单</p><p><img src="http://cdn.wutang.cc/image-20210401162950729.png" alt="image-20210401162950729"></p><p>postman测试</p><p><img src="http://cdn.wutang.cc/image-20210401170221837.png" alt="image-20210401170221837"></p><p>打开刚刚docker 启动映射的路径可以看到上传的图片</p><p><img src="http://cdn.wutang.cc/image-20210401170305093.png" alt="image-20210401170305093"></p><h5 id="api-详细文档Java-Client-API参考文档-Minio中文文档"><a href="#api-详细文档Java-Client-API参考文档-Minio中文文档" class="headerlink" title="api 详细文档Java Client API参考文档 | Minio中文文档"></a>api 详细文档<a href="http://docs.minio.org.cn/docs/master/java-client-api-reference" target="_blank" rel="noopener">Java Client API参考文档 | Minio中文文档</a></h5>]]></content>
    
    
    <summary type="html">windows使用docker搭建minio</summary>
    
    
    
    <category term="java" scheme="https://floatinghua.github.io/categories/java/"/>
    
    
    <category term="maven" scheme="https://floatinghua.github.io/tags/maven/"/>
    
    <category term="docker" scheme="https://floatinghua.github.io/tags/docker/"/>
    
    <category term="minio" scheme="https://floatinghua.github.io/tags/minio/"/>
    
  </entry>
  
  <entry>
    <title>win10使用docker搭建jenkins实现gitee自动化部署</title>
    <link href="https://floatinghua.github.io/2021/03/23/win10%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAjenkins%E5%AE%9E%E7%8E%B0gitee%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/"/>
    <id>https://floatinghua.github.io/2021/03/23/win10%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAjenkins%E5%AE%9E%E7%8E%B0gitee%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/</id>
    <published>2021-03-23T02:57:22.000Z</published>
    <updated>2021-03-23T07:19:39.448Z</updated>
    
    <content type="html"><![CDATA[<h4 id="环境准备："><a href="#环境准备：" class="headerlink" title="环境准备："></a>环境准备：</h4><blockquote><ol><li>win10</li><li>docker</li><li>gitee</li><li>一台服务器</li></ol></blockquote><h5 id="安装jenkins配置环境"><a href="#安装jenkins配置环境" class="headerlink" title="安装jenkins配置环境"></a>安装jenkins配置环境</h5><p>首先你自己的需要在电脑上搭建docker的环境，这边就不介绍docker了。</p><p>接下来就是搜索镜像，安装jenkins，直接看图吧</p><p><img src="http://cdn.wutang.cc/image-20210323110132481.png" alt="image-20210323110132481"></p><p>安装好后启动的时候需要指定下挂载目录，方便后续的修改和查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -u root -d -p 8080:8080 -p 50000:50000 -v F:\tmp\jenkins_data:/var/jenkins_home  -v /var/run/docker.sock:/var/run/docker.sock --name jenkins-test jenkinsci/blueocean</span><br></pre></td></tr></table></figure><p>等待一会，打开浏览器 localhost:8080就可以看到以下画面</p><p><img src="http://cdn.wutang.cc/image-20210323111450859.png" alt="image-20210323111450859"></p><p>然后去我们刚刚挂载的目录下找到secrets下的初始密码：</p><p><img src="http://cdn.wutang.cc/image-20210323111551321.png" alt="image-20210323111551321"></p><p>登录进去初始化一会，根据你的网络状况看是否能加载出来这个页面</p><p><img src="http://cdn.wutang.cc/image-20210323111706797.png" alt="image-20210323111706797"></p><p>安装推荐的插件就行，<code>要是没加载出来，就跳过等下去，手动安装插件</code>，默认安装的插件如图所示:</p><p><img src="http://cdn.wutang.cc/image-20210323111925779.png" alt="image-20210323111925779"></p><p>安装完成就会让你创建一个账户,创建完成会点击重启，等待几分钟就好,登录进去就行。</p><p><img src="http://cdn.wutang.cc/image-20210323112017754.png" alt="image-20210323112017754"></p><p><img src="http://cdn.wutang.cc/image-20210323112141242.png" alt="image-20210323112141242"></p><h5 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h5><h5 id="进来就先进去-系统管理-gt-插件管理-gt-高级"><a href="#进来就先进去-系统管理-gt-插件管理-gt-高级" class="headerlink" title="进来就先进去,系统管理-&gt;插件管理-&gt;高级"></a>进来就先进去,系统管理-&gt;插件管理-&gt;高级</h5><p>将<a href="http://updates.jenkins.io/update-center.json" target="_blank" rel="noopener">http://updates.jenkins.io/update-center.json</a> 改为http的，记得点击下面的立即获取，等待验证一下</p><p><img src="http://cdn.wutang.cc/image-20210323112412393.png" alt="image-20210323112412393"></p><h5 id="gitee插件"><a href="#gitee插件" class="headerlink" title="gitee插件"></a>gitee插件</h5><p>然后就是安装所需要的插件，这边我用的是<strong>gitee</strong>，所以需要下载gitee的，等待安装重启</p><p><img src="http://cdn.wutang.cc/image-20210323112628200.png" alt="image-20210323112628200"></p><h5 id="ssh插件"><a href="#ssh插件" class="headerlink" title="ssh插件"></a>ssh插件</h5><p><strong>安装ssh插件</strong>，需要上传到服务器运行项目</p><p><img src="http://cdn.wutang.cc/image-20210323113333145.png" alt="image-20210323113333145"></p><h5 id="maven任务插件"><a href="#maven任务插件" class="headerlink" title="maven任务插件"></a>maven任务插件</h5><p><strong>安装maven任务插件</strong></p><p><img src="http://cdn.wutang.cc/image-20210323115528920.png" alt="image-20210323115528920"></p><h5 id="maven外部配置插件"><a href="#maven外部配置插件" class="headerlink" title="maven外部配置插件"></a>maven外部配置插件</h5><p><strong>安装maven外部配置插件</strong></p><p><img src="http://cdn.wutang.cc/image-20210323113818613.png" alt="image-20210323113818613"></p><h4 id="jenkins配置"><a href="#jenkins配置" class="headerlink" title="jenkins配置"></a>jenkins配置</h4><h5 id="maven的配置"><a href="#maven的配置" class="headerlink" title="maven的配置"></a>maven的配置</h5><p>刚刚maven的插件下好后，在系统管理中就多了managed files</p><p><img src="http://cdn.wutang.cc/image-20210323114400773.png" alt="image-20210323114400773"></p><p><img src="http://cdn.wutang.cc/image-20210323114625830.png" alt="image-20210323114625830"></p><p>点进去后，左侧选择add 选择maven settings.xml 更改自己想要的配置就行。</p><h5 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h5><p>maven就选择刚刚新建的xml文件，这里的jdk，是选择的jenkins默认安装的，使用docker exec 进入jenkins的容器，使用which java</p><p>查看</p><p><img src="http://cdn.wutang.cc/image-20210323115157785.png" alt="image-20210323115157785"></p><p><img src="http://cdn.wutang.cc/image-20210323115051821.png" alt="image-20210323115051821"></p><h5 id="后续的git和maven我都是用的自动安装，安装完成重启jenkins"><a href="#后续的git和maven我都是用的自动安装，安装完成重启jenkins" class="headerlink" title="后续的git和maven我都是用的自动安装，安装完成重启jenkins"></a>后续的git和maven我都是用的自动安装，安装完成重启jenkins</h5><p><img src="http://cdn.wutang.cc/image-20210323115246088.png" alt="image-20210323115246088"></p><p><code>但是git的自动安装完成也要配置一次，进入jenkins容器 which git</code></p><p><img src="http://cdn.wutang.cc/image-20210323145610802.png" alt="image-20210323145610802"></p><p><img src="http://cdn.wutang.cc/image-20210323145627159.png" alt="image-20210323145627159"></p><h5 id="在全局设置中，需要添加一个gitee的令牌"><a href="#在全局设置中，需要添加一个gitee的令牌" class="headerlink" title="在全局设置中，需要添加一个gitee的令牌"></a>在全局设置中，需要添加一个gitee的令牌<img src="http://cdn.wutang.cc/image-20210323135722713.png" alt="image-20210323135722713"></h5><p><img src="http://cdn.wutang.cc/image-20210323134025140.png" alt="image-20210323134025140"></p><h5 id="ssh上传到服务器配置-在全局配置里面的选项"><a href="#ssh上传到服务器配置-在全局配置里面的选项" class="headerlink" title="ssh上传到服务器配置 ,在全局配置里面的选项"></a>ssh上传到服务器配置 ,在全局配置里面的选项</h5><p><img src="http://cdn.wutang.cc/image-20210323141012656.png" alt="image-20210323141012656"></p><h4 id="新增maven任务"><a href="#新增maven任务" class="headerlink" title="新增maven任务"></a>新增maven任务</h4><p><img src="http://cdn.wutang.cc/image-20210323120033469.png" alt="image-20210323120033469"></p><h5 id="选择刚刚配置的gitee地址-配置项目地址和登录gitee的账号密码"><a href="#选择刚刚配置的gitee地址-配置项目地址和登录gitee的账号密码" class="headerlink" title="选择刚刚配置的gitee地址,配置项目地址和登录gitee的账号密码"></a>选择刚刚配置的gitee地址,配置项目地址和登录gitee的账号密码</h5><p><img src="http://cdn.wutang.cc/image-20210323135940187.png" alt="image-20210323135940187"></p><h5 id="选择构建触发器"><a href="#选择构建触发器" class="headerlink" title="选择构建触发器"></a>选择构建触发器</h5><p>注意下面的gitee webhook填写的是localhost 但是我这边用了花生壳做了映射，所以我在gitee中的配置是外网的</p><p>花生壳的映射</p><p><img src="http://cdn.wutang.cc/image-20210323141722324.png" alt="image-20210323141722324"></p><h5 id="构建触发器的配置"><a href="#构建触发器的配置" class="headerlink" title="构建触发器的配置"></a>构建触发器的配置</h5><p><img src="http://cdn.wutang.cc/image-20210323140046691.png" alt="image-20210323140046691"></p><h5 id="仓库的webhook配置"><a href="#仓库的webhook配置" class="headerlink" title="仓库的webhook配置"></a>仓库的webhook配置</h5><p><img src="http://cdn.wutang.cc/image-20210323140213226.png" alt="image-20210323140213226"></p><h5 id="执行构建"><a href="#执行构建" class="headerlink" title="执行构建"></a>执行构建</h5><p><img src="http://cdn.wutang.cc/image-20210323145249767.png" alt="image-20210323145249767"></p><h5 id="构建后上传到服务器-执行停止和启动脚本"><a href="#构建后上传到服务器-执行停止和启动脚本" class="headerlink" title="构建后上传到服务器 执行停止和启动脚本"></a>构建后上传到服务器 执行停止和启动脚本</h5><p><img src="http://cdn.wutang.cc/image-20210323145303152.png" alt="image-20210323145303152"></p><p><img src="http://cdn.wutang.cc/image-20210323145343636.png" alt="image-20210323145343636"></p><p><img src="http://cdn.wutang.cc/image-20210323145404837.png" alt="image-20210323145404837"></p><p><code>脚本注意</code></p><p>start.sh 一定要加这个 不然你的脚本可能不会被执行，后台也会被杀掉</p><p>source /etc/profile<br>BUILD_ID=dontKillMe </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/home/tools/jdk1.8.0_251</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;JAVA_HOME&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Start the program : mall-0.0.1-SNAPSHOT.war'</span></span><br><span class="line">chmod 777 /root/tmp/mall-0.0.1-SNAPSHOT.war</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'-------Starting-------'</span></span><br><span class="line"><span class="built_in">cd</span> /root/tmp/</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">BUILD_ID=dontKillMe </span><br><span class="line">nohup /home/tools/jdk1.8.0_251/bin/java -Dhudson.util.ProcessTree.disable=<span class="literal">true</span> -jar mall-0.0.1-SNAPSHOT.war &gt; /dev/null 2&gt;&amp;1 &gt;&gt; test.log &amp;</span><br><span class="line">sleep 2</span><br><span class="line">pid=`ps -ef |grep java|grep mall-0.0.1-SNAPSHOT.war|awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'pid: '</span> <span class="variable">$pid</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'start success'</span></span><br></pre></td></tr></table></figure><p>stop.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Stop Procedure : mall-0.0.1-SNAPSHOT.war"</span></span><br><span class="line">pid=`ps -ef |grep java|grep mall-0.0.1-SNAPSHOT.war|awk <span class="string">'&#123;print $2&#125;'</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'old Procedure pid:'</span><span class="variable">$pid</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$pid</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">win10使用docker搭建jenkins实现gitee自动化部署到服务器</summary>
    
    
    
    <category term="运维" scheme="https://floatinghua.github.io/categories/%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="git" scheme="https://floatinghua.github.io/tags/git/"/>
    
    <category term="maven" scheme="https://floatinghua.github.io/tags/maven/"/>
    
    <category term="jenkins" scheme="https://floatinghua.github.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Java用ItextPdf7导出pdf</title>
    <link href="https://floatinghua.github.io/2021/01/12/Java%E7%94%A8ItextPdf7%E5%AF%BC%E5%87%BApdf/"/>
    <id>https://floatinghua.github.io/2021/01/12/Java%E7%94%A8ItextPdf7%E5%AF%BC%E5%87%BApdf/</id>
    <published>2021-01-12T08:06:44.000Z</published>
    <updated>2021-01-12T08:09:55.054Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Java使用ITEXT7导出pdf"><a href="#Java使用ITEXT7导出pdf" class="headerlink" title="Java使用ITEXT7导出pdf"></a>Java使用ITEXT7导出pdf</h4><h5 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h5><blockquote><p>需要导出以下的pdf模板出来，之前做的都用freemarker来导出word，现在更换成了pdf，所以临时整了个</p><p><img src="http://cdn.wutang.cc/20210112151959.png" alt="image-20210112151952011"></p></blockquote><h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><ol><li>maven依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itextpdf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>itext7-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.1.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>api</p><p>说到这个itextpdf的<a href="https://api.itextpdf.com/iText7/java/7.1.11/" target="_blank" rel="noopener">api</a>就不得不吐槽下，是写的真不太好</p><p><strong>还有各个版本之间差异也有很多</strong>，注意自己依赖的版本</p><p>大部分都是和html的方法差不多，例如什么margin padding border 都差不多，只是写起来麻烦，无法直观看见效果，需要每次都去生成一遍，再来调整，<strong>注意：本人不喜欢写html的东西，所以写出来的效果不是很好，可以有空自己琢磨怎么好看</strong></p></li><li><p>常用方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先你需要一个writer对象 </span></span><br><span class="line">PdfWriter writer = <span class="keyword">new</span> PdfWriter(导出路径);</span><br><span class="line"><span class="comment">//需要一个pdf的对象来操作pdf</span></span><br><span class="line">PdfDocument pdf = <span class="keyword">new</span> PdfDocument(writer);</span><br><span class="line"><span class="comment">//需要一个document的对象来操作数据 指定为A4大小</span></span><br><span class="line">Document document = <span class="keyword">new</span> Document(pdf, PageSize.A4);</span><br><span class="line"><span class="comment">//每次画完一部分的需要用document.add(table)添加到文档对象，才能有效果</span></span><br><span class="line"><span class="comment">//常用的几个实体类</span></span><br><span class="line"><span class="comment">//表格 本文采用的都是表格来布局</span></span><br><span class="line">Table table = <span class="keyword">new</span> Table(<span class="keyword">int</span>列数)</span><br><span class="line"><span class="comment">// 单元格 支持合并行 合并列</span></span><br><span class="line">Cell cell= <span class="keyword">new</span> Cell(行, 列)</span><br><span class="line"><span class="comment">// 段落</span></span><br><span class="line"><span class="keyword">new</span> Paragraph(可以直接放文本);</span><br><span class="line"></span><br><span class="line"><span class="comment">//黑色</span></span><br><span class="line">DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//灰色</span></span><br><span class="line">DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//灰色虚线边框</span></span><br><span class="line">DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line"><span class="comment">//黑色实体边框</span></span><br><span class="line">SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line"></span><br><span class="line">下面的多了一些setWidth setFontSize setFixedLeading setBold setHeight setTextAlignment setVerticalAlignment 这些名词稍微懂点html的都知道啥意思吧，就不需要多介绍了</span><br></pre></td></tr></table></figure></li><li><p>大致思路</p><p>因为要做分页，所以抽了几个方法出来，头部，尾部信息都是一样的，变化的只有中间的商品表格。</p><p><strong>所有的布局都是通过table来实现的，有更好的想法可以提出来修改</strong></p></li></ol><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><p>当一个table 你的列数超过了你设置的值后，就会往下一行排列，这跟html的规则是一样的，注意下</p><p><strong>中文字体是需要额外配置的，否则无法显示出来</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取中文字体</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> PdfFont <span class="title">getChineseFont</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> PdfFontFactory.createFont(<span class="string">"STSongStd-Light"</span>, <span class="string">"UniGB-UCS2-H"</span>, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"获取中文字体失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>头部信息的代码 思路就是用的一个table左边单元格是图片,右边的单元格是基本信息，<strong>这边的logo暂时是写死路径的，可以自己定义下</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头部固定位置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pdf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1.餐厅订单 2.供应商订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MalformedURLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawOrderTop</span><span class="params">(Document document, PdfDocument pdf, String type)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">5</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorder(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 2021/1/8 写死先</span></span><br><span class="line"><span class="comment">//        table.addCell(new Cell().add(new Image(ImageDataFactory.create(configUtil.getStaticUrl() + "/logo.png")).setWidth(25)).setBorder(Border.NO_BORDER));</span></span><br><span class="line">        <span class="comment">//左边的logo部分</span></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">5</span>, <span class="number">2</span>).add(<span class="keyword">new</span> Image(ImageDataFactory</span><br><span class="line">                .create(<span class="string">"E:\\Project\\xxxx\\src\\main\\resources\\static\\img\\logo.png"</span>))</span><br><span class="line">                .setWidth(<span class="number">160</span>))</span><br><span class="line">                .setBorder(Border.NO_BORDER));</span><br><span class="line">        <span class="comment">//右边的基本信息</span></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>).setMarginLeft(<span class="number">20</span>)</span><br><span class="line">                .add(<span class="keyword">new</span> Paragraph(<span class="string">"UNITY FRESH SUPPLY SDN. BHD"</span>)</span><br><span class="line">                        .setFontSize(<span class="number">10</span>)</span><br><span class="line">                        .setFontColor(black)</span><br><span class="line">                        .setFixedLeading(<span class="number">13</span>)</span><br><span class="line">                        .setBold().add(<span class="keyword">new</span> Text(<span class="string">".(1381196-H)"</span>).setFontSize(<span class="number">7</span>)))</span><br><span class="line">                .setWidth(<span class="number">500</span>)</span><br><span class="line">                .setHeight(<span class="number">13</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph(<span class="string">"Address:"</span>)</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"66, Jalan 5/116b, Kuchai Entrepreneurs Park, "</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph()</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"58200 Kuala Lumpur, Malaysia."</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph(<span class="string">"Email:"</span>)</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"newpower.my@gmail.com"</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph(<span class="string">"TEL:"</span>)</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"+60 10 280 2037"</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"1"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">5</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Paragraph(<span class="string">"ORDER"</span>).setFixedLeading(<span class="number">20</span>))</span><br><span class="line">                    .setFontSize(<span class="number">10</span>)</span><br><span class="line">                    .setHeight(<span class="number">20</span>)</span><br><span class="line">                    .setBold()</span><br><span class="line">                    .setTextAlignment(TextAlignment.RIGHT)</span><br><span class="line">                    .setBorder(<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"2"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">5</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Paragraph(<span class="string">"PURCHASE ORDER"</span>).setFixedLeading(<span class="number">20</span>))</span><br><span class="line">                    .setFontSize(<span class="number">10</span>)</span><br><span class="line">                    .setHeight(<span class="number">20</span>)</span><br><span class="line">                    .setBold()</span><br><span class="line">                    .setTextAlignment(TextAlignment.RIGHT)</span><br><span class="line">                    .setBorder(<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>基本信息的 </p><p>思路也是一样的 都是table 依次排列出来</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> billInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1.餐厅订单 2.供应商订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawOrderBaseInfo</span><span class="params">(Document document, BillInfoDto billInfo, <span class="keyword">int</span> i, <span class="keyword">int</span> count, String type)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">6</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorder(<span class="keyword">null</span>);</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">8</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                        <span class="keyword">new</span> Table(<span class="number">4</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">300</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                                                <span class="keyword">new</span> Table(<span class="number">4</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">228</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"Bill to:"</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">200</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"Delivery Address:"</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getBillName()).setFont(getChineseFont()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getDeliveryAddress()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getBillTo()).setFont(getChineseFont()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getArea()).setFont(getChineseFont()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                        )</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>).setHeight(<span class="number">10</span>))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                                                .setBorderRight(solidBorder)</span></span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"Attn:"</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getName()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setPaddingLeft(<span class="number">10</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"Attn:"</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getAgent()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                                                .setBorderRight(solidBorder)</span></span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"TEL:"</span>).setFontSize(<span class="number">10</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getTel()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"TEL:"</span>).setFontSize(<span class="number">10</span>).setPaddingLeft(<span class="number">10</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getAgentPhone()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setHeight(<span class="number">40</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"Email:"</span>).setFontSize(<span class="number">10</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getEmail()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setHeight(<span class="number">40</span>)</span><br><span class="line">                                )</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(<span class="string">"1"</span>, type)) &#123;</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">7</span>, <span class="number">2</span>)</span><br><span class="line">                            .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                            .setWidth(<span class="number">160</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).addCell(</span><br><span class="line">                                            <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                                    <span class="keyword">new</span> Paragraph(<span class="string">"Order No.:"</span>).setFontSize(<span class="number">9</span>))</span><br><span class="line">                                    ).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getInvoiceNo()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Area:"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getArea()).setFontSize(<span class="number">8</span>).setFont(getChineseFont())</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Agent:"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getAgent()).setFontSize(<span class="number">8</span>).setFont(getChineseFont())</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Date : "</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getDate()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Terms : "</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Cash"</span>).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Page :"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(i + <span class="string">"/"</span> + count).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    ))</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(<span class="string">"2"</span>, type)) &#123;</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">7</span>, <span class="number">2</span>)</span><br><span class="line">                            .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                            .setWidth(<span class="number">160</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).addCell(</span><br><span class="line">                                            <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                                    <span class="keyword">new</span> Paragraph(<span class="string">"Order No.:"</span>).setFontSize(<span class="number">9</span>))</span><br><span class="line">                                    ).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getInvoiceNo()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Area:"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getArea()).setFontSize(<span class="number">8</span>).setFont(getChineseFont())</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Date : "</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getDate()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Page :"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(i + <span class="string">"/"</span> + count).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>商品表格 因为我这边是做了分页效果的，思路也是一样的，先画表头，再循环添加每一条商品信息进去，下面的代码因为分了两个端，所以有两个方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 餐厅</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawMerchantGoodsInfo</span><span class="params">(Document document, List&lt;GoodInfoDto&gt; goods)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">7</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorderTop(solidBorder);</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Item."</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">300</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Description"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">70</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Qty"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder).setBorderBottom(solidBorder)</span><br><span class="line">                        .add(</span><br><span class="line">                                <span class="keyword">new</span> Table(<span class="number">1</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Discounted Price"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                        )</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder).setBorderBottom(solidBorder)</span><br><span class="line">                        .add(</span><br><span class="line">                                <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Unit Price"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Amount"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                        )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">//        商品</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; goods.size(); i++) &#123;</span><br><span class="line">            GoodInfoDto goodInfoDto = goods.get(i);</span><br><span class="line"><span class="comment">//            goodInfoDto.setDiscountedPrice(new BigDecimal("2123122.5"));</span></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(i + <span class="number">1</span>)).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(goodInfoDto.getDescription()).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getQty())).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">1</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getDiscountedPrice())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getPrice())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getAmount())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        document.add(table);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 供应商</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawSupplierGoodsInfo</span><span class="params">(Document document, List&lt;GoodInfoDto&gt; goods)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">6</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorderTop(solidBorder);</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Item."</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">300</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Description"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">70</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Qty"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder).setBorderBottom(solidBorder)</span><br><span class="line">                        .add(</span><br><span class="line">                                <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Unit Price"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Amount"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                        )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">//        商品</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; goods.size(); i++) &#123;</span><br><span class="line">            GoodInfoDto goodInfoDto = goods.get(i);</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(i + <span class="number">1</span>)))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(goodInfoDto.getDescription()).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getQty())).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getPrice())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getAmount())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>尾部信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> remark   订单备注</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1.餐厅订单 2.供应商订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawEnd</span><span class="params">(Document document, Map&lt;String, Object&gt; map, String remark, String type)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">6</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder);</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">300</span>).setTextAlignment(TextAlignment.LEFT).setFontSize(<span class="number">8</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"RINGGIT MALAYSIA: "</span> + parse(String.valueOf(map.get(<span class="string">"subTotal"</span>))))));</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"1"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">200</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>)</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"SUBTOTAL (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"subTotal"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"DELIVERY FEE (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"deliveryFee"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"TAX (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"tax"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"2"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">200</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>)</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"SUBTOTAL (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"subTotal"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"TAX (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"tax"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                <span class="keyword">new</span> Table(<span class="number">6</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder)</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">90</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">90</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">155</span>).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"E. &amp; O. E."</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">115</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"TOTAL (RM):"</span>)).setFontSize(<span class="number">8</span>))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">100</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"total"</span>))).setFontSize(<span class="number">8</span>)))</span><br><span class="line">        ).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        空一行</span></span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">6</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setMarginTop(<span class="number">10</span>).add(</span><br><span class="line">                <span class="keyword">new</span> Table(<span class="number">4</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>)</span><br><span class="line">                        .addCell(</span><br><span class="line">                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"Note:"</span>))</span><br><span class="line">                        )</span><br><span class="line">                        .addCell(</span><br><span class="line">                                <span class="keyword">new</span> Cell(<span class="number">5</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(remark).setFont(getChineseFont()))</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">6</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">175</span>).setPaddingLeft(-<span class="number">20</span>).add(<span class="keyword">new</span> Paragraph(StringUtils.equals(<span class="string">"1"</span>, type) ? <span class="string">"PAID AMOUNT (RM):"</span> : <span class="string">""</span>).setFontSize(<span class="number">8</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(StringUtils.equals(<span class="string">"1"</span>, type) ? String.valueOf(map.get(<span class="string">"paidAmount"</span>)) : <span class="string">""</span>).setFontSize(<span class="number">8</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setHeight(<span class="number">9</span>).setWidth(<span class="number">100</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setHeight(<span class="number">10</span>).setBorder(<span class="keyword">null</span>));</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.LEFT).add(</span><br><span class="line">                <span class="keyword">new</span> Paragraph(<span class="string">"Thank you for your support. We truly appreciate your business and look forward to serving you again"</span>).setFontSize(<span class="number">9</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        空一行</span></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setBorder(<span class="keyword">null</span>).setHeight(<span class="number">50</span>).setVerticalAlignment(VerticalAlignment.BOTTOM).add(<span class="keyword">new</span> Paragraph(<span class="string">"UNITY FRESH SUPPLY SDN. BH"</span>))).setTextAlignment(TextAlignment.RIGHT);</span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>完整代码</p><p>下面代码还有其他的逻辑，比如说数字金额转为英文的之类的，但是对功能没啥影响，不需要的可以删除</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tang.tool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itextpdf.io.font.FontConstants;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.io.font.PdfEncodings;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.io.image.ImageDataFactory;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.colors.Color;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.colors.DeviceRgb;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.font.PdfFont;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.font.PdfFontFactory;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.geom.PageSize;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.pdf.PdfDocument;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.pdf.PdfWriter;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.pdf.canvas.draw.SolidLine;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.Document;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.borders.Border;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.borders.DashedBorder;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.borders.SolidBorder;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.*;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.Cell;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.Image;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.Paragraph;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.Table;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.property.AreaBreakType;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.property.TextAlignment;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.property.VerticalAlignment;</span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.*;</span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.pdf.BaseFont;</span><br><span class="line"><span class="keyword">import</span> com.lowagie.text.pdf.PdfTable;</span><br><span class="line"><span class="keyword">import</span> com.yx.conf.MyException;</span><br><span class="line"><span class="keyword">import</span> com.yx.dto.BillInfoDto;</span><br><span class="line"><span class="keyword">import</span> com.yx.dto.GoodInfoDto;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Configuration;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.Template;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.TemplateException;</span><br><span class="line"><span class="keyword">import</span> freemarker.template.TemplateExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.xhtmlrenderer.pdf.ITextRenderer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilder;</span><br><span class="line"><span class="keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 账单工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BillUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ConfigUtil configUtil;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] SINGLE_NUM_ARR = <span class="keyword">new</span> String[]&#123;<span class="string">""</span>, <span class="string">"One"</span>, <span class="string">"Two"</span>, <span class="string">"Three"</span>, <span class="string">"Four"</span>, <span class="string">"Five"</span>, <span class="string">"Six"</span>, <span class="string">"Seven"</span>, <span class="string">"Eight"</span>, <span class="string">"Nine"</span>&#125;;</span><br><span class="line">    <span class="comment">//十几的数字</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] TEN_NUM_ARR = <span class="keyword">new</span> String[]&#123;<span class="string">"Ten"</span>, <span class="string">"Eleven"</span>, <span class="string">"Tweleve"</span>, <span class="string">"Thirteen"</span>, <span class="string">"Fourteen"</span>, <span class="string">"Fifteen"</span>, <span class="string">"Sixteen"</span>, <span class="string">"Seventeen"</span>, <span class="string">"Eighteen"</span>, <span class="string">"Nineteen"</span>&#125;;</span><br><span class="line">    <span class="comment">//整十的数字</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] TEN_INTEGER_ARR = <span class="keyword">new</span> String[]&#123;<span class="string">"Ten"</span>, <span class="string">"Twenty"</span>, <span class="string">"Thirty"</span>, <span class="string">"Forty"</span>, <span class="string">"Fifty"</span>, <span class="string">"Sixty"</span>, <span class="string">"Seventy"</span>, <span class="string">"Eighty"</span>, <span class="string">"Ninety"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载账单</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> billInfo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(BillInfoDto billInfo, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        downloadOrder(billInfo, response, <span class="string">"1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 餐厅订单</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> billInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">downloadOrder</span><span class="params">(BillInfoDto billInfo, HttpServletResponse response, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String fileName = <span class="string">"upload/"</span> + System.currentTimeMillis() + <span class="string">".pdf"</span>;</span><br><span class="line">            PdfWriter writer = <span class="keyword">new</span> PdfWriter(configUtil.getPath() + fileName);</span><br><span class="line">            PdfDocument pdf = <span class="keyword">new</span> PdfDocument(writer);</span><br><span class="line">            Document document = <span class="keyword">new</span> Document(pdf, PageSize.A4);</span><br><span class="line">            document.setBorderTop(<span class="keyword">new</span> DashedBorder(<span class="number">2</span>));</span><br><span class="line">            List&lt;GoodInfoDto&gt; goodInfo = billInfo.getGoodInfo();</span><br><span class="line">            <span class="keyword">if</span> (goodInfo == <span class="keyword">null</span> || goodInfo.size() &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"账单信息不存在"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> count = (goodInfo.size() + <span class="number">4</span>) / <span class="number">5</span>;</span><br><span class="line">            Map&lt;String, Object&gt; dataMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">            List&lt;Map&lt;String, Object&gt;&gt; pages = <span class="keyword">new</span> ArrayList&lt;&gt;(count);</span><br><span class="line">            dataMap.put(<span class="string">"pages"</span>, pages);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= count; i++) &#123;</span><br><span class="line">                List&lt;GoodInfoDto&gt; goods = goodInfo.stream()</span><br><span class="line">                        .skip(<span class="number">5</span> * (i - <span class="number">1</span>))</span><br><span class="line">                        .limit(<span class="number">5</span>).collect(Collectors.toList());</span><br><span class="line">                Map&lt;String, Object&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">8</span>);</span><br><span class="line">                map.put(<span class="string">"billTo"</span>, billInfo.getBillTo());</span><br><span class="line">                map.put(<span class="string">"deliveryAddress"</span>, billInfo.getDeliveryAddress());</span><br><span class="line">                map.put(<span class="string">"name"</span>, billInfo.getName());</span><br><span class="line">                map.put(<span class="string">"tel"</span>, billInfo.getTel());</span><br><span class="line">                map.put(<span class="string">"email"</span>, billInfo.getEmail());</span><br><span class="line">                map.put(<span class="string">"invoiceNo"</span>, billInfo.getInvoiceNo());</span><br><span class="line">                map.put(<span class="string">"area"</span>, billInfo.getArea());</span><br><span class="line">                map.put(<span class="string">"agent"</span>, billInfo.getAgent());</span><br><span class="line">                map.put(<span class="string">"date"</span>, billInfo.getDate());</span><br><span class="line">                map.put(<span class="string">"page"</span>, i);</span><br><span class="line">                map.put(<span class="string">"totalPages"</span>, count);</span><br><span class="line"><span class="comment">//              新增一页,画页眉</span></span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">                    pdf.addNewPage();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nextPage(document);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//              画头部</span></span><br><span class="line">                drawOrderTop(document, pdf, type);</span><br><span class="line"><span class="comment">//               基本信息</span></span><br><span class="line">                drawOrderBaseInfo(document, billInfo, i, count, type);</span><br><span class="line"></span><br><span class="line">                List&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(goods.size());</span><br><span class="line">                BigDecimal subTotal = BigDecimal.ZERO;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; goods.size(); j++) &#123;</span><br><span class="line">                    GoodInfoDto dto = goods.get(j);</span><br><span class="line">                    Map&lt;String, Object&gt; data = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">                    data.put(<span class="string">"qty"</span>, dto.getQty());</span><br><span class="line">                    data.put(<span class="string">"description"</span>, dto.getDescription());</span><br><span class="line">                    data.put(<span class="string">"price"</span>, dto.getPrice());</span><br><span class="line">                    data.put(<span class="string">"amount"</span>, dto.getAmount());</span><br><span class="line">                    data.put(<span class="string">"unit"</span>, dto.getUnit());</span><br><span class="line">                    data.put(<span class="string">"item"</span>, j + <span class="number">1</span>);</span><br><span class="line">                    list.add(data);</span><br><span class="line">                    subTotal = subTotal.add(dto.getAmount());</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                商品列表</span></span><br><span class="line">                <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"1"</span>)) &#123;</span><br><span class="line">                    drawMerchantGoodsInfo(document, goods);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"2"</span>)) &#123;</span><br><span class="line">                    drawSupplierGoodsInfo(document, goods);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                map.put(<span class="string">"subTotal"</span>, subTotal);</span><br><span class="line">                map.put(<span class="string">"deliveryFee"</span>, billInfo.getDeliveryFee());</span><br><span class="line">                map.put(<span class="string">"tax"</span>, billInfo.getTax());</span><br><span class="line">                BigDecimal total = subTotal.add(billInfo.getDeliveryFee()).add(billInfo.getTax());</span><br><span class="line">                map.put(<span class="string">"total"</span>, total);</span><br><span class="line">                map.put(<span class="string">"upperTotal"</span>, parse(total + <span class="string">""</span>));</span><br><span class="line">                map.put(<span class="string">"paidAmount"</span>, billInfo.getPaidAmount());</span><br><span class="line">                map.put(<span class="string">"goodsInfo"</span>, list);</span><br><span class="line">                pages.add(map);</span><br><span class="line">                <span class="comment">//            尾部</span></span><br><span class="line">                drawEnd(document, map, billInfo.getRemark(), type);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            document.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"获取模板失败"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"获取模板失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头部固定位置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pdf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1.餐厅订单 2.供应商订单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MalformedURLException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawOrderTop</span><span class="params">(Document document, PdfDocument pdf, String type)</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">5</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorder(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> 2021/1/8 写死先</span></span><br><span class="line"><span class="comment">//        table.addCell(new Cell().add(new Image(ImageDataFactory.create(configUtil.getStaticUrl() + "/logo.png")).setWidth(25)).setBorder(Border.NO_BORDER));</span></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">5</span>, <span class="number">2</span>).add(<span class="keyword">new</span> Image(ImageDataFactory</span><br><span class="line">                .create(<span class="string">"E:\\Project\\xxx_1.0\\src\\main\\resources\\static\\img\\logo.png"</span>))</span><br><span class="line">                .setWidth(<span class="number">160</span>))</span><br><span class="line">                .setBorder(Border.NO_BORDER));</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>).setMarginLeft(<span class="number">20</span>)</span><br><span class="line">                .add(<span class="keyword">new</span> Paragraph(<span class="string">"UNITY FRESH SUPPLY SDN. BHD"</span>)</span><br><span class="line">                        .setFontSize(<span class="number">10</span>)</span><br><span class="line">                        .setFontColor(black)</span><br><span class="line">                        .setFixedLeading(<span class="number">13</span>)</span><br><span class="line">                        .setBold().add(<span class="keyword">new</span> Text(<span class="string">".(1381196-H)"</span>).setFontSize(<span class="number">7</span>)))</span><br><span class="line">                .setWidth(<span class="number">500</span>)</span><br><span class="line">                .setHeight(<span class="number">13</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph(<span class="string">"Address:"</span>)</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"66, Jalan 5/116b, Kuchai Entrepreneurs Park, "</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph()</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"58200 Kuala Lumpur, Malaysia."</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph(<span class="string">"Email:"</span>)</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"newpower.my@gmail.com"</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">3</span>)</span><br><span class="line">                .add(</span><br><span class="line">                        <span class="keyword">new</span> Paragraph(<span class="string">"TEL:"</span>)</span><br><span class="line">                                .setFontSize(<span class="number">7</span>)</span><br><span class="line">                                .add(<span class="keyword">new</span> Text(<span class="string">"+60 10 280 2037"</span>).setFontSize(<span class="number">5</span>))</span><br><span class="line">                )</span><br><span class="line">                .setHeight(<span class="number">10</span>)</span><br><span class="line">                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                .setBorderLeft(grayBorder)</span></span><br><span class="line"><span class="comment">//                .setBorderBottom(grayBorder)</span></span><br><span class="line">                .setTextAlignment(TextAlignment.LEFT));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"1"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">5</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Paragraph(<span class="string">"ORDER"</span>).setFixedLeading(<span class="number">20</span>))</span><br><span class="line">                    .setFontSize(<span class="number">10</span>)</span><br><span class="line">                    .setHeight(<span class="number">20</span>)</span><br><span class="line">                    .setBold()</span><br><span class="line">                    .setTextAlignment(TextAlignment.RIGHT)</span><br><span class="line">                    .setBorder(<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"2"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">5</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Paragraph(<span class="string">"PURCHASE ORDER"</span>).setFixedLeading(<span class="number">20</span>))</span><br><span class="line">                    .setFontSize(<span class="number">10</span>)</span><br><span class="line">                    .setHeight(<span class="number">20</span>)</span><br><span class="line">                    .setBold()</span><br><span class="line">                    .setTextAlignment(TextAlignment.RIGHT)</span><br><span class="line">                    .setBorder(<span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> billInfo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1.餐厅订单 2.供应商订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawOrderBaseInfo</span><span class="params">(Document document, BillInfoDto billInfo, <span class="keyword">int</span> i, <span class="keyword">int</span> count, String type)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">6</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorder(<span class="keyword">null</span>);</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">8</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                        <span class="keyword">new</span> Table(<span class="number">4</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">300</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                                                <span class="keyword">new</span> Table(<span class="number">4</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">228</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"Bill to:"</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">200</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"Delivery Address:"</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getBillName()).setFont(getChineseFont()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getDeliveryAddress()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getBillTo()).setFont(getChineseFont()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                                        .addCell(</span><br><span class="line">                                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(billInfo.getArea()).setFont(getChineseFont()).setFontSize(<span class="number">8</span>).setHeight(<span class="number">20</span>))</span><br><span class="line">                                                        )</span><br><span class="line">                                        )</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>).setHeight(<span class="number">10</span>))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                                                .setBorderRight(solidBorder)</span></span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"Attn:"</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getName()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setPaddingLeft(<span class="number">10</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"Attn:"</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getAgent()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line"><span class="comment">//                                                .setBorderRight(solidBorder)</span></span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"TEL:"</span>).setFontSize(<span class="number">10</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getTel()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"TEL:"</span>).setFontSize(<span class="number">10</span>).setPaddingLeft(<span class="number">10</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getAgentPhone()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setHeight(<span class="number">40</span>)</span><br><span class="line">                                                .add(<span class="keyword">new</span> Paragraph(<span class="string">"Email:"</span>).setFontSize(<span class="number">10</span>)</span><br><span class="line">                                                        .add(<span class="keyword">new</span> Text(billInfo.getEmail()).setFont(getChineseFont()).setFontSize(<span class="number">9</span>)))</span><br><span class="line">                                )</span><br><span class="line">                                .addCell(</span><br><span class="line">                                        <span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                                .setHeight(<span class="number">40</span>)</span><br><span class="line">                                )</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(<span class="string">"1"</span>, type)) &#123;</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">7</span>, <span class="number">2</span>)</span><br><span class="line">                            .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                            .setWidth(<span class="number">160</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).addCell(</span><br><span class="line">                                            <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                                    <span class="keyword">new</span> Paragraph(<span class="string">"Order No.:"</span>).setFontSize(<span class="number">9</span>))</span><br><span class="line">                                    ).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getInvoiceNo()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Area:"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getArea()).setFontSize(<span class="number">8</span>).setFont(getChineseFont())</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Agent:"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getAgent()).setFontSize(<span class="number">8</span>).setFont(getChineseFont())</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Date : "</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getDate()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Terms : "</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Cash"</span>).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Page :"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(i + <span class="string">"/"</span> + count).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    ))</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(<span class="string">"2"</span>, type)) &#123;</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">7</span>, <span class="number">2</span>)</span><br><span class="line">                            .setBorder(<span class="keyword">null</span>)</span><br><span class="line">                            .setWidth(<span class="number">160</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).addCell(</span><br><span class="line">                                            <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                                    <span class="keyword">new</span> Paragraph(<span class="string">"Order No.:"</span>).setFontSize(<span class="number">9</span>))</span><br><span class="line">                                    ).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getInvoiceNo()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Area:"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getArea()).setFontSize(<span class="number">8</span>).setFont(getChineseFont())</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Date : "</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(billInfo.getDate()).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">"Page :"</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(i + <span class="string">"/"</span> + count).setFontSize(<span class="number">8</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">2</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                                            <span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">9</span>)</span><br><span class="line">                                    )).addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> remark   订单备注</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     1.餐厅订单 2.供应商订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawEnd</span><span class="params">(Document document, Map&lt;String, Object&gt; map, String remark, String type)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">6</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder);</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">300</span>).setTextAlignment(TextAlignment.LEFT).setFontSize(<span class="number">8</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"RINGGIT MALAYSIA: "</span> + parse(String.valueOf(map.get(<span class="string">"subTotal"</span>))))));</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"1"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">200</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>)</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"SUBTOTAL (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"subTotal"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"DELIVERY FEE (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"deliveryFee"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"TAX (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"tax"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(type, <span class="string">"2"</span>)) &#123;</span><br><span class="line">            table.addCell(<span class="keyword">new</span> Cell(<span class="number">3</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">200</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>).add(</span><br><span class="line">                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>)</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"SUBTOTAL (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"subTotal"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"TAX (RM):"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"tax"</span>))).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line">                            .addCell(</span><br><span class="line">                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                <span class="keyword">new</span> Table(<span class="number">6</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder)</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">90</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">90</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">155</span>).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"E. &amp; O. E."</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">115</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).setTextAlignment(TextAlignment.RIGHT).add(<span class="keyword">new</span> Paragraph(<span class="string">"TOTAL (RM):"</span>)).setFontSize(<span class="number">8</span>))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">100</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(map.get(<span class="string">"total"</span>))).setFontSize(<span class="number">8</span>)))</span><br><span class="line">        ).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        空一行</span></span><br><span class="line"></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">6</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).setMarginTop(<span class="number">10</span>).add(</span><br><span class="line">                <span class="keyword">new</span> Table(<span class="number">4</span>).setBorder(<span class="keyword">null</span>).setPadding(<span class="number">0</span>).setMargin(<span class="number">0</span>)</span><br><span class="line">                        .addCell(</span><br><span class="line">                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">"Note:"</span>))</span><br><span class="line">                        )</span><br><span class="line">                        .addCell(</span><br><span class="line">                                <span class="keyword">new</span> Cell(<span class="number">5</span>, <span class="number">4</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(remark).setFont(getChineseFont()))</span><br><span class="line">                        )</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">6</span>, <span class="number">2</span>).setBorder(<span class="keyword">null</span>).add(</span><br><span class="line">                <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">175</span>).setPaddingLeft(-<span class="number">20</span>).add(<span class="keyword">new</span> Paragraph(StringUtils.equals(<span class="string">"1"</span>, type) ? <span class="string">"PAID AMOUNT (RM):"</span> : <span class="string">""</span>).setFontSize(<span class="number">8</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">50</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(StringUtils.equals(<span class="string">"1"</span>, type) ? String.valueOf(map.get(<span class="string">"paidAmount"</span>)) : <span class="string">""</span>).setFontSize(<span class="number">8</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">100</span>).setHeight(<span class="number">9</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                        .addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setHeight(<span class="number">9</span>).setWidth(<span class="number">100</span>).add(<span class="keyword">new</span> Paragraph(<span class="string">""</span>)))</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setHeight(<span class="number">10</span>).setBorder(<span class="keyword">null</span>));</span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.LEFT).add(</span><br><span class="line">                <span class="keyword">new</span> Paragraph(<span class="string">"Thank you for your support. We truly appreciate your business and look forward to serving you again"</span>).setFontSize(<span class="number">9</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        空一行</span></span><br><span class="line">        table.addCell(<span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">6</span>).setBorder(<span class="keyword">null</span>).setHeight(<span class="number">50</span>).setVerticalAlignment(VerticalAlignment.BOTTOM).add(<span class="keyword">new</span> Paragraph(<span class="string">"UNITY FRESH SUPPLY SDN. BH"</span>))).setTextAlignment(TextAlignment.RIGHT);</span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 餐厅</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawMerchantGoodsInfo</span><span class="params">(Document document, List&lt;GoodInfoDto&gt; goods)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">7</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorderTop(solidBorder);</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Item."</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">300</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Description"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">70</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Qty"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder).setBorderBottom(solidBorder)</span><br><span class="line">                        .add(</span><br><span class="line">                                <span class="keyword">new</span> Table(<span class="number">1</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Discounted Price"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                        )</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder).setBorderBottom(solidBorder)</span><br><span class="line">                        .add(</span><br><span class="line">                                <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Unit Price"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Amount"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                        )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">//        商品</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; goods.size(); i++) &#123;</span><br><span class="line">            GoodInfoDto goodInfoDto = goods.get(i);</span><br><span class="line"><span class="comment">//            goodInfoDto.setDiscountedPrice(new BigDecimal("2123122.5"));</span></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(i + <span class="number">1</span>)).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(goodInfoDto.getDescription()).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getQty())).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">1</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getDiscountedPrice())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getPrice())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getAmount())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        document.add(table);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 供应商</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> goods</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawSupplierGoodsInfo</span><span class="params">(Document document, List&lt;GoodInfoDto&gt; goods)</span> </span>&#123;</span><br><span class="line">        DeviceRgb black = <span class="keyword">new</span> DeviceRgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        DeviceRgb gray = <span class="keyword">new</span> DeviceRgb(<span class="number">220</span>, <span class="number">220</span>, <span class="number">220</span>);</span><br><span class="line"><span class="comment">//        黑色虚线边框</span></span><br><span class="line">        DashedBorder grayBorder = <span class="keyword">new</span> DashedBorder(gray, <span class="number">0.5F</span>);</span><br><span class="line">        SolidBorder solidBorder = <span class="keyword">new</span> SolidBorder(black, <span class="number">0.5F</span>);</span><br><span class="line">        Table table = <span class="keyword">new</span> Table(<span class="number">6</span>).setMarginLeft(<span class="number">10</span>).setMarginRight(<span class="number">10</span>);</span><br><span class="line">        table.setBorderTop(solidBorder);</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Item."</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">300</span>).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Description"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setWidth(<span class="number">70</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).setBorderBottom(solidBorder).add(<span class="keyword">new</span> Paragraph(<span class="string">"Qty"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        table.addCell(</span><br><span class="line">                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setBorderTop(solidBorder).setBorderBottom(solidBorder)</span><br><span class="line">                        .add(</span><br><span class="line">                                <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>)</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Unit Price"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"Amount"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                                        .addCell(</span><br><span class="line">                                                <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(<span class="string">"RM"</span>).setFontSize(<span class="number">8</span>))</span><br><span class="line">                                        )</span><br><span class="line">                        )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"><span class="comment">//        商品</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; goods.size(); i++) &#123;</span><br><span class="line">            GoodInfoDto goodInfoDto = goods.get(i);</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setWidth(<span class="number">50</span>).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(i + <span class="number">1</span>)))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(goodInfoDto.getDescription()).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setVerticalAlignment(VerticalAlignment.MIDDLE).setTextAlignment(TextAlignment.CENTER).setBorder(<span class="keyword">null</span>).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getQty())).setFont(getChineseFont()))</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            table.addCell(</span><br><span class="line">                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">2</span>).setWidth(<span class="number">165</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                            .add(</span><br><span class="line">                                    <span class="keyword">new</span> Table(<span class="number">2</span>).setBorder(<span class="keyword">null</span>).setMargin(<span class="number">0</span>).setPadding(<span class="number">0</span>)</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getPrice())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line">                                            .addCell(</span><br><span class="line">                                                    <span class="keyword">new</span> Cell(<span class="number">1</span>, <span class="number">1</span>).setBorder(<span class="keyword">null</span>).setWidth(<span class="number">87</span>).setTextAlignment(TextAlignment.CENTER).add(<span class="keyword">new</span> Paragraph(String.valueOf(goodInfoDto.getAmount())).setFont(getChineseFont()))</span><br><span class="line">                                            )</span><br><span class="line"></span><br><span class="line">                            )</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        document.add(table);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 金额转英文</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">parse</span><span class="params">(String x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Double.parseDouble(x) &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Zero Cents only"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> z = x.indexOf(<span class="string">"."</span>); <span class="comment">// 取小数点位置</span></span><br><span class="line">        String lstr = <span class="string">""</span>, rstr = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (z &gt; -<span class="number">1</span>) &#123; <span class="comment">// 看是否有小数，如果有，则分别取左边和右边</span></span><br><span class="line">            lstr = x.substring(<span class="number">0</span>, z);</span><br><span class="line">            rstr = x.substring(z + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="comment">// 否则就是全部</span></span><br><span class="line">        &#123;</span><br><span class="line">            lstr = x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String lstrrev = reverse(lstr); <span class="comment">// 对左边的字串取反</span></span><br><span class="line">        String[] a = <span class="keyword">new</span> String[<span class="number">5</span>]; <span class="comment">// 定义5个字串变量来存放解析出来的叁位一组的字串</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (lstrrev.length() % <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                lstrrev += <span class="string">"00"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                lstrrev += <span class="string">"0"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String lm = <span class="string">""</span>; <span class="comment">// 用来存放转换後的整数部分</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lstrrev.length() / <span class="number">3</span>; i++) &#123;</span><br><span class="line">            a[i] = reverse(lstrrev.substring(<span class="number">3</span> * i, <span class="number">3</span> * i + <span class="number">3</span>)); <span class="comment">// 截取第一个叁位</span></span><br><span class="line">            <span class="keyword">if</span> (!a[i].equals(<span class="string">"000"</span>)) &#123; <span class="comment">// 用来避免这种情况：1000000 = one million</span></span><br><span class="line">                <span class="keyword">if</span> (i != <span class="number">0</span>) &#123;</span><br><span class="line">                    lm = transThree(a[i]) + <span class="string">" "</span> + parseMore(String.valueOf(i)) + <span class="string">" "</span> + lm; <span class="comment">// 加:</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// thousand、million、billion</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    lm = transThree(a[i]); <span class="comment">// 防止i=0时， 在多加两个空格.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                lm += transThree(a[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String xs = <span class="string">""</span>; <span class="comment">// 用来存放转换後小数部分</span></span><br><span class="line">        <span class="keyword">if</span> (z &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            String transTwo = transTwo(rstr);</span><br><span class="line">            <span class="keyword">if</span> (transTwo == <span class="keyword">null</span> || <span class="string">""</span>.equals(transTwo)) &#123;</span><br><span class="line">                xs = <span class="string">""</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                xs = <span class="string">"and "</span> + transTwo + <span class="string">" Cents "</span>; <span class="comment">// 小数部分存在时转换小数</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lm.trim() + <span class="string">" "</span> + xs + <span class="string">"only"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseFirst</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String[] a = new String[] &#123; "", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine" &#125;;</span></span><br><span class="line">        <span class="keyword">return</span> SINGLE_NUM_ARR[Integer.parseInt(s.substring(s.length() - <span class="number">1</span>))];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseTeen</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String[] a = new String[] &#123; "Ten", "Eleven", "Tweleve", "Thirteen", "Fourteen", "Fifteen", "Sixteen","Seventeen", "Eighteen", "Nineteen" &#125;;</span></span><br><span class="line">        <span class="keyword">return</span> TEN_NUM_ARR[Integer.parseInt(s) - <span class="number">10</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseTen</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String[] a = new String[] &#123; "Ten", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety" &#125;;</span></span><br><span class="line">        <span class="keyword">return</span> TEN_INTEGER_ARR[Integer.parseInt(s.substring(<span class="number">0</span>, <span class="number">1</span>)) - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 两位</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">transTwo</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String value = <span class="string">""</span>;</span><br><span class="line">        <span class="comment">// 判断位数</span></span><br><span class="line">        <span class="keyword">if</span> (s.length() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            s = s.substring(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.length() &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            s = s + <span class="string">"0"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s.startsWith(<span class="string">"0"</span>)) <span class="comment">// 07 - seven 是否小於10</span></span><br><span class="line">        &#123;</span><br><span class="line">            value = parseFirst(s);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.startsWith(<span class="string">"1"</span>)) <span class="comment">// 17 seventeen 是否在10和20之间</span></span><br><span class="line">        &#123;</span><br><span class="line">            value = parseTeen(s);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.endsWith(<span class="string">"0"</span>)) <span class="comment">// 是否在10与100之间的能被10整除的数</span></span><br><span class="line">        &#123;</span><br><span class="line">            value = parseTen(s);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            value = parseTen(s) + <span class="string">" "</span> + parseFirst(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">parseMore</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String[] a = <span class="keyword">new</span> String[]&#123;<span class="string">""</span>, <span class="string">"Thousand"</span>, <span class="string">"Million"</span>, <span class="string">"Billion"</span>&#125;;</span><br><span class="line">        <span class="keyword">return</span> a[Integer.parseInt(s)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 制作叁位的数</span></span><br><span class="line">    <span class="comment">// s.length = 3</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">transThree</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        String value = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.startsWith(<span class="string">"0"</span>)) <span class="comment">// 是否小於100</span></span><br><span class="line">        &#123;</span><br><span class="line">            value = transTwo(s.substring(<span class="number">1</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (s.substring(<span class="number">1</span>).equals(<span class="string">"00"</span>)) <span class="comment">// 是否被100整除</span></span><br><span class="line">        &#123;</span><br><span class="line">            value = parseFirst(s.substring(<span class="number">0</span>, <span class="number">1</span>)) + <span class="string">" Hundred"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            value = parseFirst(s.substring(<span class="number">0</span>, <span class="number">1</span>)) + <span class="string">" Hundred and "</span> + transTwo(s.substring(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">reverse</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] aChr = s.toCharArray();</span><br><span class="line">        StringBuffer tmp = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = aChr.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            tmp.append(aChr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tmp.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取中文字体</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> PdfFont <span class="title">getChineseFont</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> PdfFontFactory.createFont(<span class="string">"STSongStd-Light"</span>, <span class="string">"UniGB-UCS2-H"</span>, <span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"获取中文字体失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增一页</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> document</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">nextPage</span><span class="params">(Document document)</span> </span>&#123;</span><br><span class="line">        document.add(<span class="keyword">new</span> AreaBreak(AreaBreakType.NEXT_PAGE));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol><pre><code>dto<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tang.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BillInfoDto</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"公司地址"</span>)</span><br><span class="line">    <span class="keyword">private</span> String billTo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"公司名称——餐厅订单使用"</span>)</span><br><span class="line">    <span class="keyword">private</span> String billName = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"餐厅名称及餐厅地址"</span>)</span><br><span class="line">    <span class="keyword">private</span> String deliveryAddress</span><br><span class="line">        </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"联系人姓名"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"联系人电话"</span>)</span><br><span class="line">    <span class="keyword">private</span> String tel;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"邮件"</span>)</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"发票号码"</span>)</span><br><span class="line">    <span class="keyword">private</span> String invoiceNo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"配送地址"</span>)</span><br><span class="line">    <span class="keyword">private</span> String area;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"配送人"</span>)</span><br><span class="line">    <span class="keyword">private</span> String agent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"配送人联系方式——餐厅订单使用"</span>)</span><br><span class="line">    <span class="keyword">private</span> String agentPhone = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"日期"</span>)</span><br><span class="line">    <span class="meta">@JsonFormat</span>(pattern = <span class="string">"dd/MM/yyyy"</span>)</span><br><span class="line">    <span class="keyword">private</span> String date;</span><br><span class="line">    <span class="comment">//    @ApiModelProperty(value = "金额英文大写")</span></span><br><span class="line"><span class="comment">//    private BigDecimal upperTotal;</span></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"小计"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal subTotal;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"配送费"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal deliveryFee;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"税费"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal tax;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"总计"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal total;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"实际支付费用"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal paidAmount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"订单备注"</span>)</span><br><span class="line">    <span class="keyword">private</span> String remark = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"商品信息"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;GoodInfoDto&gt; goodInfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>dto<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tang.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModelProperty;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodInfoDto</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"Description"</span>)</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"Qty（数量）"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer qty;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"Qty（单位）"</span>)</span><br><span class="line">    <span class="keyword">private</span> String unit;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"Price/Unit"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"Amount"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal amount;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(value = <span class="string">"折后价（供应商订单使用）"</span>)</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discountedPrice = BigDecimal.ZERO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h5 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h5><p>写到最后才发现有个pdftable的类，操作起来更方便，以后有机会再修改。欢迎各位一起学习。</p><p>贴张分页的效果图</p><p><img src="http://cdn.wutang.cc/20210112160333.png" alt="image-20210112160333162"></p>]]></content>
    
    
    <summary type="html">使用java itexpdf7 pdf导出</summary>
    
    
    
    <category term="java" scheme="https://floatinghua.github.io/categories/java/"/>
    
    
    <category term="工具" scheme="https://floatinghua.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="api" scheme="https://floatinghua.github.io/tags/api/"/>
    
    <category term="itextpdf" scheme="https://floatinghua.github.io/tags/itextpdf/"/>
    
  </entry>
  
  <entry>
    <title>python导出git每天提交记录</title>
    <link href="https://floatinghua.github.io/2020/11/16/python%E5%AF%BC%E5%87%BAgit%E6%AF%8F%E5%A4%A9%E6%8F%90%E4%BA%A4%E8%AE%B0%E5%BD%95/"/>
    <id>https://floatinghua.github.io/2020/11/16/python%E5%AF%BC%E5%87%BAgit%E6%AF%8F%E5%A4%A9%E6%8F%90%E4%BA%A4%E8%AE%B0%E5%BD%95/</id>
    <published>2020-11-16T02:37:06.000Z</published>
    <updated>2020-11-16T03:00:25.166Z</updated>
    
    <content type="html"><![CDATA[<h5 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h5><blockquote><p>和前面的文章是一样的，程序员是最懒的人</p><p>之前写了一个爬虫导出每天的禅道bug，现在写的这个是导出每天git的提交记录，因为懒</p></blockquote><p>还是很简单</p><h5 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h5><ol><li><p>python3</p></li><li><p>git</p></li></ol><p><font color='cornflowerblue'>首先需要将git添加到环境变量path中</font></p><p><img src="http://cdn.wutang.cc/20201116105447.png" alt="image-20201116105447347"></p><p>然后你需要了解<a href="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%9F%A5%E7%9C%8B%E6%8F%90%E4%BA%A4%E5%8E%86%E5%8F%B2" target="_blank" rel="noopener">git</a>的命令，用到了下面的这些选项</p><p><img src="http://cdn.wutang.cc/20201116105628.png" alt=""></p><p>然后看下代码就行了：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> easyxlsx <span class="keyword">import</span> SimpleWriter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 切换git的目录</span></span><br><span class="line">    os.chdir(<span class="string">"E:\\Project\\xxx"</span>)</span><br><span class="line">    cur = str(datetime.date.today())</span><br><span class="line">    path = <span class="string">'C:\\Users\\Administrator\\Desktop\\公司项目\\bugs\\'</span> + cur + <span class="string">'.log'</span></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        os.remove(path)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">'git log --pretty=format:"%s。"  --author tangfan --after=\'2020-11-15\' &gt;&gt; C:\\Users\\Administrator\\Desktop\\公司项目\\bugs\\'</span> + cur + <span class="string">'.log'</span>)</span><br><span class="line">    <span class="comment"># 读取file文件</span></span><br><span class="line">    log = open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    content = log.read()</span><br><span class="line">    li = content.split(<span class="string">"。"</span>)</span><br><span class="line">    wri = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> li:</span><br><span class="line">        <span class="keyword">if</span> len(i) &gt; <span class="number">0</span>:</span><br><span class="line">            li = []</span><br><span class="line">            li.append(<span class="string">'项目名称'</span>)</span><br><span class="line">            li.append(i)</span><br><span class="line">            li.append(<span class="string">"1"</span>)</span><br><span class="line">            li.append(<span class="string">"唐帆"</span>)</span><br><span class="line">            li.append(cur)</span><br><span class="line">            li.append(cur)</span><br><span class="line">            wri.append(li)</span><br><span class="line">    <span class="keyword">if</span> len(wri) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># 导出</span></span><br><span class="line">        SimpleWriter(wri, headers=(<span class="string">'项目名称'</span>, <span class="string">'任务名称'</span>, <span class="string">'权重'</span>, <span class="string">'研发人员'</span>, <span class="string">"预计时间"</span>, <span class="string">"完成时间"</span>),</span><br><span class="line">                     bookname=<span class="string">"C:\\Users\\Administrator\\Desktop\\公司项目\\bugs\\daily.xlsx"</span>).export()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">利用python导出每天的git提交日志为excel</summary>
    
    
    
    <category term="python" scheme="https://floatinghua.github.io/categories/python/"/>
    
    
    <category term="python" scheme="https://floatinghua.github.io/tags/python/"/>
    
    <category term="git" scheme="https://floatinghua.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>微信公众号指定openid发送文本信息</title>
    <link href="https://floatinghua.github.io/2020/10/21/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8C%87%E5%AE%9Aopenid%E5%8F%91%E9%80%81%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF/"/>
    <id>https://floatinghua.github.io/2020/10/21/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8C%87%E5%AE%9Aopenid%E5%8F%91%E9%80%81%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF/</id>
    <published>2020-10-21T06:39:49.000Z</published>
    <updated>2020-10-21T06:43:37.765Z</updated>
    
    <content type="html"><![CDATA[<h5 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h5><p>公司需要给指定用户发送文本信息，<a href="http://caibaojian.com/wxwiki/d475b3690426f2a7231ca605ab24d485ac9c623e.html" target="_blank" rel="noopener">微信官方文档</a>写的是用户主动操作后，客户才能回复消息，所以摸索了下。</p><h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><ol><li>用户需要关注当前公众号</li><li>公众号配置</li><li>获取当前公众号的access_token</li><li>通过客服接口发送信息</li></ol><h5 id="公众号配置"><a href="#公众号配置" class="headerlink" title="公众号配置"></a>公众号配置</h5><p>登录到公众号后台，进入到开发的基本配置，<font color=red>记录下AppId和AppSecret,并且将服务器（接口调用）的ip地址配置到IP白名单。</font></p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20201021140811.png" alt="image-20201021140805395"></p><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><ol><li>获得access_token</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取access_token 后续发送请求会需要这个access_token作为参数传入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultObject&lt;Void&gt; <span class="title">getAccessToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//我这边是存入redis当中的</span></span><br><span class="line">        Object o = redisUtil.get(CataLogEnum.WX_AUTH.getValue());</span><br><span class="line">        <span class="comment">//通过appId和appSercret获取access_token</span></span><br><span class="line">        String url = <span class="string">"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid="</span> + wxPayConfig.getAppID() +</span><br><span class="line">                <span class="string">"&amp;secret="</span> + wxPayConfig.getAppSecret();</span><br><span class="line">        String content = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        log.info(<span class="string">"获取access:&#123;&#125;"</span>, o);</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                count++;</span><br><span class="line"><span class="comment">//                这需要吗？</span></span><br><span class="line">                <span class="keyword">if</span> (count &gt; <span class="number">7</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ResultObject.error(<span class="string">"获取微信access_token超时,请稍后重试"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//构建一个Client</span></span><br><span class="line">                    HttpClient client = HttpClientBuilder.create().build();</span><br><span class="line">                    <span class="comment">//构建一个GET请求</span></span><br><span class="line">                    HttpGet get = <span class="keyword">new</span> HttpGet(url.toString());</span><br><span class="line">                    <span class="comment">//提交GET请求</span></span><br><span class="line">                    HttpResponse response = client.execute(get);</span><br><span class="line">                    <span class="comment">//拿到返回的HttpResponse的"实体"</span></span><br><span class="line">                    HttpEntity result = response.getEntity();</span><br><span class="line">                    content = EntityUtils.toString(result);</span><br><span class="line">                    JSONObject json = JSON.parseObject(content);</span><br><span class="line">                    log.info(<span class="string">"或者access的json:&#123;&#125;"</span> + json);</span><br><span class="line">                    <span class="keyword">if</span> (json.getString(<span class="string">"errcode"</span>) != <span class="keyword">null</span> &amp;&amp; !<span class="string">"0"</span>.equals(json.getString(<span class="string">"errcode"</span>))) &#123;</span><br><span class="line"><span class="comment">//                    发送失败</span></span><br><span class="line">                        <span class="keyword">return</span> ResultObject.error(<span class="string">"获取微信access_token错误:["</span> + json.getString(<span class="string">"errcode"</span>) + <span class="string">"]"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    WxAutuDto wxAutuDto = JSONObject.parseObject(content, WxAutuDto<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                    log.info(<span class="string">"wxAutuDto:&#123;&#125;"</span>, wxAutuDto);</span><br><span class="line"><span class="comment">//                    存入redis</span></span><br><span class="line">                    <span class="keyword">boolean</span> set = redisUtil.set(CataLogEnum.WX_AUTH.getValue(), content, wxAutuDto.getExpires_in());</span><br><span class="line">                    log.info(<span class="string">"access存入redis:&#123;&#125;"</span>, set);</span><br><span class="line">                    <span class="keyword">if</span> (set) &#123;</span><br><span class="line">                        <span class="keyword">return</span> ResultObject.ok(<span class="string">"获取成功"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultObject.ok(<span class="string">"获取成功"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>发送信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultObject&lt;Void&gt; <span class="title">sendMessage</span><span class="params">(ReqSendWxMessageDto dto)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line"><span class="comment">//        获得token</span></span><br><span class="line">        String o = (String) redisUtil.get(CataLogEnum.WX_AUTH.getValue());</span><br><span class="line">        WxAutuDto wxAutuDto = JSONObject.parseObject(o, WxAutuDto<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//        发送的url 需要获得token传入</span></span><br><span class="line">        String sendUrl = <span class="string">"https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token="</span> + wxAutuDto.getAccess_token();</span><br><span class="line"><span class="comment">//        发送实体类</span></span><br><span class="line">        List&lt;String&gt; openIds = dto.getOpenIds();</span><br><span class="line"><span class="comment">//        发送的消息</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"content"</span>, dto.getContent());</span><br><span class="line"><span class="comment">//        循环</span></span><br><span class="line">        <span class="keyword">for</span> (String m : openIds) &#123;</span><br><span class="line">            WxMessageDto testMessage = <span class="keyword">new</span> WxMessageDto();</span><br><span class="line">            <span class="comment">//        暂时是text类型,需要其他的自己扩展</span></span><br><span class="line">            testMessage.setMsgtype(<span class="string">"text"</span>);</span><br><span class="line">            testMessage.setTouser(m);</span><br><span class="line">            testMessage.setText(map);</span><br><span class="line">            String jsonTestMessage = JSONObject.toJSONString(testMessage);</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//                发送post请求</span></span><br><span class="line">                    log.info(<span class="string">"开始发送请求"</span>);</span><br><span class="line">                    result = WxMessageUtils.sendPost(sendUrl, jsonTestMessage);</span><br><span class="line">                    JSONObject json = JSON.parseObject(result);</span><br><span class="line">                    log.info(<span class="string">"返回:&#123;&#125;"</span>, json);</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="string">"0"</span>.equals(json.getString(<span class="string">"errcode"</span>))) &#123;</span><br><span class="line"><span class="comment">//                    发送失败</span></span><br><span class="line">                        <span class="keyword">return</span> ResultObject.error(<span class="string">"发送失败"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (count &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> ResultObject.error(<span class="string">"发送失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultObject.ok(<span class="string">"发送成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * post 请求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sendPost</span><span class="params">(String url, String param)</span> </span>&#123;</span><br><span class="line">        PrintWriter out = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader in = <span class="keyword">null</span>;</span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL realUrl = <span class="keyword">new</span> URL(url);</span><br><span class="line">            <span class="comment">// 打开和URL之间的连接</span></span><br><span class="line">            URLConnection conn = realUrl.openConnection();</span><br><span class="line">            <span class="comment">//设置通用的请求属性</span></span><br><span class="line">            conn.setRequestProperty(<span class="string">"user-agent"</span>, <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:21.0) Gecko/20100101 Firefox/21.0)"</span>);</span><br><span class="line">            <span class="comment">// 发送POST请求必须设置如下两行</span></span><br><span class="line">            conn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">            conn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// 获取URLConnection对象对应的输出流</span></span><br><span class="line">            OutputStreamWriter outWriter = <span class="keyword">new</span> OutputStreamWriter(conn.getOutputStream(), <span class="string">"utf-8"</span>);</span><br><span class="line">            out = <span class="keyword">new</span> PrintWriter(outWriter);</span><br><span class="line">            <span class="comment">// 发送请求参数</span></span><br><span class="line">            out.print(param);</span><br><span class="line">            <span class="comment">// flush输出流的缓冲</span></span><br><span class="line">            out.flush();</span><br><span class="line">            <span class="comment">// 定义BufferedReader输入流来读取URL的响应</span></span><br><span class="line">            in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(conn.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(conn.getInputStream()));</span><br><span class="line">                result += line;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">"发送 POST 请求出现异常:&#123;&#125;"</span> + e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//使用finally块来关闭输出流、输入流</span></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol><p>如果有报错，请查看对应的<a href="http://caibaojian.com/wxwiki/c69a3e39afca9a7285a83ebc9cbd44d940e7f916.html" target="_blank" rel="noopener">状态码地址</a></p><p>完整的代码</p><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.controller.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yx.tool.ResultObject;</span><br><span class="line"><span class="keyword">import</span> com.yx.tool.wxMessage.ReqSendWxMessageDto;</span><br><span class="line"><span class="keyword">import</span> com.yx.tool.wxMessage.WxMessageUtils;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.Api;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：tangfan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2020/10/21 10:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api</span>(tags = <span class="string">"微信消息"</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/wxMessage"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxMessageController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WxMessageUtils wxMessageUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/getAuth"</span>)</span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"首先获取微信公众号的token，有过期时间的"</span>, notes = <span class="string">"tf"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultObject&lt;Void&gt; <span class="title">getAuth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> wxMessageUtils.getAccessToken();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/sendMessage"</span>)</span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"通过用户openId发送微信消息"</span>, notes = <span class="string">"tf"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultObject <span class="title">send</span><span class="params">(@RequestBody ReqSendWxMessageDto dto)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> wxMessageUtils.sendMessage(dto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获得access_token和发送消息的工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.tool.wxMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.yx.tool.CataLogEnum;</span><br><span class="line"><span class="keyword">import</span> com.yx.tool.RedisUtil;</span><br><span class="line"><span class="keyword">import</span> com.yx.tool.ResultObject;</span><br><span class="line"><span class="keyword">import</span> com.yx.tool.wx.wxPay.WXPayConfig;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.HttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：tangfan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2020/10/21 8:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>： 公众号发送消息工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxMessageUtils</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WXPayConfig wxPayConfig;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisUtil redisUtil;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * post 请求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sendPost</span><span class="params">(String url, String param)</span> </span>&#123;</span><br><span class="line">        PrintWriter out = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader in = <span class="keyword">null</span>;</span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            URL realUrl = <span class="keyword">new</span> URL(url);</span><br><span class="line">            <span class="comment">// 打开和URL之间的连接</span></span><br><span class="line">            URLConnection conn = realUrl.openConnection();</span><br><span class="line">            <span class="comment">//设置通用的请求属性</span></span><br><span class="line">            conn.setRequestProperty(<span class="string">"user-agent"</span>, <span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:21.0) Gecko/20100101 Firefox/21.0)"</span>);</span><br><span class="line">            <span class="comment">// 发送POST请求必须设置如下两行</span></span><br><span class="line">            conn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">            conn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// 获取URLConnection对象对应的输出流</span></span><br><span class="line">            OutputStreamWriter outWriter = <span class="keyword">new</span> OutputStreamWriter(conn.getOutputStream(), <span class="string">"utf-8"</span>);</span><br><span class="line">            out = <span class="keyword">new</span> PrintWriter(outWriter);</span><br><span class="line">            <span class="comment">// 发送请求参数</span></span><br><span class="line">            out.print(param);</span><br><span class="line">            <span class="comment">// flush输出流的缓冲</span></span><br><span class="line">            out.flush();</span><br><span class="line">            <span class="comment">// 定义BufferedReader输入流来读取URL的响应</span></span><br><span class="line">            in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(conn.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = in.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(conn.getInputStream()));</span><br><span class="line">                result += line;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.info(<span class="string">"发送 POST 请求出现异常:&#123;&#125;"</span> + e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//使用finally块来关闭输出流、输入流</span></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                ex.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取access_token 后续发送请求会需要这个access_token作为参数传入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultObject&lt;Void&gt; <span class="title">getAccessToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Object o = redisUtil.get(CataLogEnum.WX_AUTH.getValue());</span><br><span class="line">        String url = <span class="string">"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid="</span> + wxPayConfig.getAppID() +</span><br><span class="line">                <span class="string">"&amp;secret="</span> + wxPayConfig.getAppSecret();</span><br><span class="line">        String content = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        log.info(<span class="string">"获取access:&#123;&#125;"</span>, o);</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                count++;</span><br><span class="line"><span class="comment">//                这需要吗？</span></span><br><span class="line">                <span class="keyword">if</span> (count &gt; <span class="number">7</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> ResultObject.error(<span class="string">"获取微信access_token超时,请稍后重试"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//构建一个Client</span></span><br><span class="line">                    HttpClient client = HttpClientBuilder.create().build();</span><br><span class="line">                    <span class="comment">//构建一个GET请求</span></span><br><span class="line">                    HttpGet get = <span class="keyword">new</span> HttpGet(url.toString());</span><br><span class="line">                    <span class="comment">//提交GET请求</span></span><br><span class="line">                    HttpResponse response = client.execute(get);</span><br><span class="line">                    <span class="comment">//拿到返回的HttpResponse的"实体"</span></span><br><span class="line">                    HttpEntity result = response.getEntity();</span><br><span class="line">                    content = EntityUtils.toString(result);</span><br><span class="line">                    JSONObject json = JSON.parseObject(content);</span><br><span class="line">                    log.info(<span class="string">"或者access的json:&#123;&#125;"</span> + json);</span><br><span class="line">                    <span class="keyword">if</span> (json.getString(<span class="string">"errcode"</span>) != <span class="keyword">null</span> &amp;&amp; !<span class="string">"0"</span>.equals(json.getString(<span class="string">"errcode"</span>))) &#123;</span><br><span class="line"><span class="comment">//                    发送失败</span></span><br><span class="line">                        <span class="keyword">return</span> ResultObject.error(<span class="string">"获取微信access_token错误:["</span> + json.getString(<span class="string">"errcode"</span>) + <span class="string">"]"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    WxAutuDto wxAutuDto = JSONObject.parseObject(content, WxAutuDto<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                    log.info(<span class="string">"wxAutuDto:&#123;&#125;"</span>, wxAutuDto);</span><br><span class="line"><span class="comment">//                    存入redis</span></span><br><span class="line">                    <span class="keyword">boolean</span> set = redisUtil.set(CataLogEnum.WX_AUTH.getValue(), content, wxAutuDto.getExpires_in());</span><br><span class="line">                    log.info(<span class="string">"access存入redis:&#123;&#125;"</span>, set);</span><br><span class="line">                    <span class="keyword">if</span> (set) &#123;</span><br><span class="line">                        <span class="keyword">return</span> ResultObject.ok(<span class="string">"获取成功"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultObject.ok(<span class="string">"获取成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultObject&lt;Void&gt; <span class="title">sendMessage</span><span class="params">(ReqSendWxMessageDto dto)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String result = <span class="string">""</span>;</span><br><span class="line"><span class="comment">//        获得token</span></span><br><span class="line">        String o = (String) redisUtil.get(CataLogEnum.WX_AUTH.getValue());</span><br><span class="line">        WxAutuDto wxAutuDto = JSONObject.parseObject(o, WxAutuDto<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="comment">//        发送的url</span></span><br><span class="line">        String sendUrl = <span class="string">"https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token="</span> + wxAutuDto.getAccess_token();</span><br><span class="line"><span class="comment">//        发送实体类</span></span><br><span class="line">        List&lt;String&gt; openIds = dto.getOpenIds();</span><br><span class="line"><span class="comment">//        发送的消息</span></span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"content"</span>, dto.getContent());</span><br><span class="line"><span class="comment">//        循环</span></span><br><span class="line">        <span class="keyword">for</span> (String m : openIds) &#123;</span><br><span class="line">            WxMessageDto testMessage = <span class="keyword">new</span> WxMessageDto();</span><br><span class="line">            <span class="comment">//        暂时是text类型,需要其他的自己扩展</span></span><br><span class="line">            testMessage.setMsgtype(<span class="string">"text"</span>);</span><br><span class="line">            testMessage.setTouser(m);</span><br><span class="line">            testMessage.setText(map);</span><br><span class="line">            String jsonTestMessage = JSONObject.toJSONString(testMessage);</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//                发送post请求</span></span><br><span class="line">                    log.info(<span class="string">"开始发送请求"</span>);</span><br><span class="line">                    result = WxMessageUtils.sendPost(sendUrl, jsonTestMessage);</span><br><span class="line">                    JSONObject json = JSON.parseObject(result);</span><br><span class="line">                    log.info(<span class="string">"返回:&#123;&#125;"</span>, json);</span><br><span class="line">                    <span class="keyword">if</span> (!<span class="string">"0"</span>.equals(json.getString(<span class="string">"errcode"</span>))) &#123;</span><br><span class="line"><span class="comment">//                    发送失败</span></span><br><span class="line">                        <span class="keyword">return</span> ResultObject.error(<span class="string">"发送失败"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (count &gt;= <span class="number">5</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> ResultObject.error(<span class="string">"发送失败"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResultObject.ok(<span class="string">"发送成功"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>dto</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.tool.wxMessage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：tangfan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2020/10/21 8:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>： 客户接口消息发送实体</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxMessageDto</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//openid</span></span><br><span class="line">    <span class="keyword">private</span> String touser;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消息类型</span></span><br><span class="line">    <span class="keyword">private</span> String msgtype;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消息内容</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; text;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后在方便测试的时候，你可以在公众号的用户管理直接找到用户的openId</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20201021142922.png" alt="image-20201021142922334"></p><p>测试成功，可以指定多个用户</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20201021143044.png" alt="image-20201021143044809"></p>]]></content>
    
    
    <summary type="html">微信公众号通过客服接口，给指定openid发送文本消息</summary>
    
    
    
    <category term="整合" scheme="https://floatinghua.github.io/categories/%E6%95%B4%E5%90%88/"/>
    
    
    <category term="微信公众号" scheme="https://floatinghua.github.io/tags/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7/"/>
    
  </entry>
  
  <entry>
    <title>python导出禅道每天的bug</title>
    <link href="https://floatinghua.github.io/2020/09/14/python%20%E7%88%AC%E8%99%AB%E5%AF%BC%E5%87%BA%E7%A6%85%E9%81%93%E6%AF%8F%E5%A4%A9%E7%9A%84bug/"/>
    <id>https://floatinghua.github.io/2020/09/14/python%20%E7%88%AC%E8%99%AB%E5%AF%BC%E5%87%BA%E7%A6%85%E9%81%93%E6%AF%8F%E5%A4%A9%E7%9A%84bug/</id>
    <published>2020-09-14T02:36:31.000Z</published>
    <updated>2021-03-18T00:56:02.590Z</updated>
    
    <content type="html"><![CDATA[<h5 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h5><blockquote><p>有一句话是程序员是最懒的人</p><p>因为公司每天都要写日报，所以自己懒得去禅道复制粘贴，就学了下python 写了个小小的爬虫，用于每天导出bug列表</p><p>当然大手子就看看就好，因为python也是现学现用，所以很多不熟悉</p></blockquote><p>因为很简单，所以我就简单介绍下</p><h5 id="准备工作："><a href="#准备工作：" class="headerlink" title="准备工作："></a>准备工作：</h5><ol><li><a href="https://docs.python.org/zh-cn/3.8/tutorial/index.html" target="_blank" rel="noopener">python3</a></li><li><a href="https://www.telerik.com/download/fiddler" target="_blank" rel="noopener">fiddler</a> 抓包必备</li><li><a href="https://www.runoob.com/xpath/xpath-syntax.html" target="_blank" rel="noopener">xpath</a>语法，用来获取感兴趣的节点信息的</li></ol><h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><ol><li>首先是通过抓包工具获得登录的消息</li></ol><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200914104759.png" alt=""></p><p>我是直接用的verifyRand加密字符串就没去自己再加密了（因为懒）</p><ol start="2"><li>代码</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> http.cookiejar <span class="keyword">as</span> cookielib</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree <span class="comment">#XPATH获取节点</span></span><br><span class="line"><span class="keyword">from</span> easyxlsx <span class="keyword">import</span> SimpleWriter <span class="comment">#导出excel</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取session</span></span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="comment"># 因为原始的session.cookies 没有save()方法，所以需要用到cookielib中的方法LWPCookieJar，这个类实例化的cookie对象，就可以直接调用save方法。</span></span><br><span class="line">session.cookies = cookielib.LWPCookieJar(filename=<span class="string">"huihuCookies.txt"</span>)</span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36"</span>,</span><br><span class="line">    <span class="string">"referer"</span>: <span class="string">"/zentao/"</span></span><br><span class="line">&#125;</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"account"</span>: <span class="string">"tangfan"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">"明文密码"</span>,</span><br><span class="line">    <span class="string">"passwordStrength"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"keepLogin"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"verifyRand"</span>: <span class="string">"加密的字符串，就直接用抓包工具获得"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">resp = session.post(<span class="string">"http://49.4.71.9:30000/zentao/user-login.html"</span>, data=data, headers=header)</span><br><span class="line"><span class="comment"># print(resp.status_code)</span></span><br><span class="line"><span class="comment"># 导出的集合</span></span><br><span class="line">l = []</span><br><span class="line">now = time.strftime(<span class="string">"%Y/%m/%d"</span>, time.localtime())</span><br><span class="line"><span class="comment"># 是否登录成功</span></span><br><span class="line"><span class="keyword">if</span> resp.status_code == <span class="number">200</span>:</span><br><span class="line">    session.cookies.save()</span><br><span class="line">    <span class="comment"># 访问个人主页测试</span></span><br><span class="line">    <span class="comment"># my_profile = session.get("http://49.4.71.9:30000/zentao/my-profile.html")</span></span><br><span class="line">    <span class="comment"># 获取每天解决的bug</span></span><br><span class="line">    today_bugs = session.get(<span class="string">"http://49.4.71.9:30000/zentao/my-dynamic.html"</span>)</span><br><span class="line">    <span class="comment"># xpath语法取得今天所有的bug</span></span><br><span class="line">    today_bugs_html = etree.HTML(today_bugs.text)</span><br><span class="line">    content = today_bugs_html.xpath(<span class="string">"//span[@class='timeline-text']/a"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> content:</span><br><span class="line">        li = []</span><br><span class="line">        li.append(<span class="string">"1"</span>)</span><br><span class="line">        li.append(<span class="string">"name"</span>)</span><br><span class="line">        li.append(now)</span><br><span class="line">        li.append(now)</span><br><span class="line">        li.insert(<span class="number">0</span>, i.text)</span><br><span class="line">        l.append(li)</span><br><span class="line">    <span class="keyword">if</span> len(l) &gt; <span class="number">0</span>:</span><br><span class="line">        SimpleWriter(l, headers=(<span class="string">'任务名称'</span>, <span class="string">'权重'</span>, <span class="string">'研发人员'</span>, <span class="string">"预计时间"</span>, <span class="string">"完成时间"</span>),</span><br><span class="line">                     bookname=<span class="string">"C:\\Users\\Administrator\\Desktop\\公司项目\\bugs\\bugs.xlsx"</span>).export()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">只是我简单的一个爬虫用来获取每天的bug导出而已</summary>
    
    
    
    <category term="python" scheme="https://floatinghua.github.io/categories/python/"/>
    
    
    <category term="python" scheme="https://floatinghua.github.io/tags/python/"/>
    
    <category term="爬虫" scheme="https://floatinghua.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>picgo处理hexo博客图片问题</title>
    <link href="https://floatinghua.github.io/2020/08/28/picgo%E5%A4%84%E7%90%86%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/"/>
    <id>https://floatinghua.github.io/2020/08/28/picgo%E5%A4%84%E7%90%86%E5%8D%9A%E5%AE%A2%E5%9B%BE%E7%89%87%E9%97%AE%E9%A2%98/</id>
    <published>2020-08-28T08:52:09.000Z</published>
    <updated>2020-09-08T06:08:59.813Z</updated>
    
    <content type="html"><![CDATA[<h4 id="picgo处理hexo博客图片问题"><a href="#picgo处理hexo博客图片问题" class="headerlink" title="picgo处理hexo博客图片问题"></a>picgo处理hexo博客图片问题</h4><blockquote><p>免费！速度快！简单！</p><p>前提之前写博客都是先写好，发表到csdn，然后再发表到自己的博客地址，因为csdn大家都懂，所以今天解决下一直没处理的图片存储问题。</p></blockquote><h5 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h5><p>技术上因为用的是hexo，所以盯上了picgo，typor自己就支持所以配置起来很方便</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828165506.png" alt="image-20200828165505909"></p><p><strong>可以看到下图粘贴图片的一瞬间就上传图片完成了，速度极快</strong></p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828165549.png" alt="image-20200828165549692"></p><h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><p>首先需要你下载 <a href="https://github.com/Molunerfinn/PicGo/releases" target="_blank" rel="noopener">picgo</a> ， <a href="https://www.typora.io/" target="_blank" rel="noopener">typora</a>  应该做开发的都知道吧，一款很好用的md编辑器,然后需要你建一个码云仓库，当然你可以选择github（速度慢，容易加载失败），或者七牛云，因为我的七牛云拿去做其他事情了，所以就演示码云。</p><h6 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h6><p>安装好 先下载一个插件 搜索gitee就行</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828170010.png" alt="image-20200828170010029"></p><p>建好码云仓库，要是开源的，master分支可选，等下配置到master就行</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828170153.png" alt="image-20200828170153136"></p><p><strong>然后生成自己的令牌一定要记住令牌，因为点击了就不会再次展示了</strong></p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828170303.png" alt="image-20200828170303361"></p><p>然后打开picgo选到gitee 填入自己的仓库地址（<strong>注意仓库地址是你选择克隆下载的那个地址后面的部分</strong>），token信息</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828170400.png" alt="image-20200828170400477"></p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828170514.png" alt="image-20200828170514110"></p><p>然后打开typora 偏好设置，配置好就行了</p><p><img src="https://gitee.com/float97/wutang-imgs/raw/master/20200828165506.png" alt="image-20200828165505909"></p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>总体来说，很简单，也很便宜，当然你可以选择其他方式，多动脑子。</p>]]></content>
    
    
    <summary type="html">免费用picgo处理hexo的图片问题</summary>
    
    
    
    <category term="工具" scheme="https://floatinghua.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="工具" scheme="https://floatinghua.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>设计模式——单例模式</title>
    <link href="https://floatinghua.github.io/2020/08/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <id>https://floatinghua.github.io/2020/08/10/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</id>
    <published>2020-08-10T05:49:17.000Z</published>
    <updated>2020-09-08T06:09:22.574Z</updated>
    
    <content type="html"><![CDATA[<h3 id="设计模式——单例模式"><a href="#设计模式——单例模式" class="headerlink" title="设计模式——单例模式"></a>设计模式——单例模式</h3><h4 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h4><p>单例模式是设计模式中很常见的一种模式，各种框架，系统中都有应用。</p><p><strong>其定义</strong>是单例对象的类只能允许一个实例存在。在许多时候整个系统只需要拥有一个全局对象，这样有利于我们系统系统整体的行为。</p><p>实现主要是以下两个步骤:</p><blockquote><ol><li>将该类的构造方法定义为私有方法，这样其他处的代码就无法通过调用该类的构造方法来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例；</li><li>在该类内提供一个静态方法，当我们调用这个方法时，如果该类的引用不为空，就返回该类的引用，如果该类的引用为空，就创建该类的实例，并赋值给该类的引用。</li><li>单例模式可分为有状态的和无状态的。有状态的单例对象一般也是可变的单例对象，多 个单态对象在一起就可以作为一个状态仓库一样向外提供服务。没有状态的单例对象也就是 不变单例对象，仅用做提供工具函数。</li></ol></blockquote><p>适用场景：</p><blockquote><ol><li>需要频繁实例化然后销毁;</li><li>需要生成唯一序列的环境；</li><li>实例化耗时过多，但是又经常用到；</li><li>资源互相通信的环境</li></ol></blockquote><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><h5 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a>饿汉式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HungryMod</span> </span>&#123;</span><br><span class="line">    <span class="comment">//私有化构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">HungryMod</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 指向自己实例的私有静态引用</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HungryMod mod = <span class="keyword">new</span> HungryMod();</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态工厂方法，提供给外部调用获得实例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HungryMod <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>类的加载是按需加载，且加载一次。因此，在上述类被加载时，就是实例化一个对象指向自己的引用；而且类在整个生命周期只会被加载一次，因此只会创建一个实例。</strong></p><h6 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h6><p>​    <strong>优点：</strong></p><blockquote><p>​    写法简单，在类加载时就完成了实例化，避免线程同步问题</p></blockquote><p>​    <strong>缺点：</strong></p><blockquote><p>没有延迟加载，因为这个实例是在类的加载时就创建了，如果没使用就造成了内存浪费</p></blockquote><h5 id="懒汉式"><a href="#懒汉式" class="headerlink" title="懒汉式"></a>懒汉式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LazyMod</span> </span>&#123;</span><br><span class="line"><span class="comment">//    私有化构造方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazyMod</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//  指向自己的静态实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> LazyMod mod=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    提供给外部访问的静态方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  LazyMod <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mod==<span class="keyword">null</span>)&#123;</span><br><span class="line">            mod=<span class="keyword">new</span> LazyMod();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>懒汉式就是延迟加载的，在真正使用的时候才会去创建一个新的实例，指向自己的引用</strong></p><h6 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h6><p>​    <strong>优点：</strong></p><blockquote><p>延迟加载，避免内存的浪费</p></blockquote><p>​    <strong>缺点：</strong></p><blockquote><p>if语句在多线程下，就可能出现多个实例的问题，所以多线程不适用</p></blockquote><p><strong>所以可以在懒汉模式下的静态方法上加一个锁</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span>  LazyMod <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (mod==<span class="keyword">null</span>)&#123;</span><br><span class="line">           mod=<span class="keyword">new</span> LazyMod();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> mod;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>线程安全的懒汉模式——这样虽然解决了线程安全问题，但是synchronized效率低。</p></blockquote><h5 id="双重加锁机制"><a href="#双重加锁机制" class="headerlink" title="双重加锁机制"></a>双重加锁机制</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleLockMod</span> </span>&#123;</span><br><span class="line">    <span class="comment">//    空指向</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DoubleLockMod mod = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    私有化构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DoubleLockMod</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DoubleLockMod <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 第一次检查instance是否被实例化出来，如果没有进入if块</span></span><br><span class="line">        <span class="keyword">if</span> (mod == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//            类锁</span></span><br><span class="line">            <span class="keyword">synchronized</span> (DoubleLockMod<span class="class">.<span class="keyword">class</span>) </span>&#123;</span><br><span class="line"><span class="comment">//              某个线程取得了类锁，实例化对象前第二次检查instance是否已经被实例化出来，如果没有，才最终实例出对象</span></span><br><span class="line">                <span class="keyword">if</span> (mod == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mod = <span class="keyword">new</span> DoubleLockMod();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就解决了懒汉式下的线程问题，也解决了效率问题，这是最优秀的方案</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>单例模式在框架，系统中都很常见，也是简单的一种设计模式。当然单例模式还有个邪恶论，单例模式在java系统中存在很多陷阱和假象……</p><p><em>参考</em><br><em>1、高洪岩，Java多线程编程核心技术，机械工业出版社</em></p><p><em>2、<a href="https://www.cnblogs.com/xuwendong/p/9633985.html" target="_blank" rel="noopener">https://www.cnblogs.com/xuwendong/p/9633985.html</a></em></p>]]></content>
    
    
    <summary type="html">设计模式中的工厂模式详解</summary>
    
    
    
    <category term="设计模式" scheme="https://floatinghua.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://floatinghua.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>&#39;设计模式——工厂模式&#39;</title>
    <link href="https://floatinghua.github.io/2020/08/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
    <id>https://floatinghua.github.io/2020/08/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E2%80%94%E2%80%94%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</id>
    <published>2020-08-05T07:54:33.000Z</published>
    <updated>2020-09-08T06:08:02.355Z</updated>
    
    <content type="html"><![CDATA[<h4 id="设计模式——工厂模式"><a href="#设计模式——工厂模式" class="headerlink" title="设计模式——工厂模式"></a>设计模式——工厂模式</h4><p>首先不是写给萌新看的，观看前需要有javaSE的基础。文采、绘画水平不佳，还请担待。</p><h5 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h5><p>   主要是为创建对象提供过渡接口，以便将创建对象的具体过程屏蔽隔离起来，达到提供灵活性的目的。</p><h6 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h6><ol><li><p>主要角色：</p><ol><li><p>工厂类角色：本模式的核心，在java中往往由一个具体类实现</p></li><li><p>抽象产品角色：一般是具体产品继承或者实现的接口，在java中由接口或者抽象类来实现</p></li><li><p>具体产品：工厂类所创建的对象就是此角色的实例</p></li></ol></li></ol><ol start="2"><li>逻辑如下：<br><img src="https://img-blog.csdnimg.cn/20200805160058349.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li></ol><pre><code>简单工厂模式又称静态工厂方法模式。重命名上就可以看出这个模式一定很简单。</code></pre><p>   <strong>目的</strong>：它存 在的目的很简单：定义一个用于创建对象的接口。</p><ol start="3"><li><p>代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *工厂类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleFactor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Phone phone = makePhone();</span><br><span class="line">        phone.describe();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Phone <span class="title">makePhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        <span class="keyword">int</span> i = random.nextInt();</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> MiPhone();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> IPhone();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品角色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">describe</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiPhone</span> <span class="keyword">implements</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">describe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"小米手机进击高端市场了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IPhone</span> <span class="keyword">implements</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">describe</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"苹果手机信号不好"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>优缺点</p><p><strong>优点：</strong></p><ul><li><p>将创建实例的工作与使用实例的工作分开，使用者不必关心类对象如何创建，实现了解耦；</p></li><li><p>把初始化实例时的工作放到工厂里进行，使代码更容易维护。 更符合面向对象的原则 &amp; 面向接口编程，而不是面向实现编程。</p></li></ul><p><strong>缺点：</strong></p><ul><li><p>工厂类集中了所有实例（产品）的创建逻辑，一旦这个工厂不能正常工作，整个系统都会受到影响；</p></li><li><p>违背“开放 - 关闭原则”，一旦添加新产品就不得不修改工厂类的逻辑，这样就会造成工厂逻辑过于复杂。</p></li><li><p>简单工厂模式由于使用了静态工厂方法，静态方法不能被继承和重写，会造成工厂角色无法形成基于继承的等级结构。</p></li></ul></li></ul><h6 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h6><ol><li><p>主要角色</p><ol><li>抽象工厂：提供创建产品的接口，调用者通过它访问具体工厂的工厂方法</li><li>具体工厂：实现抽象工厂的方法，完整自己具体产品的创建</li><li>抽象产品：定义产品的规范</li><li>具体产品：实现抽象产品的方法，由具体工程来创建对应的产品</li></ol></li></ol><ol start="2"><li>逻辑如下：<br><img src="https://img-blog.csdnimg.cn/20200805160139541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li></ol><p>   和简单工厂模式（工厂负责生产所有的产品）相比，工厂方式模式将具体产品的任务分发给具体的产品工厂。</p><p>   <strong>目的：也就是说定义了一个抽象工厂，其定义了产品的生产接口，但是不负责具体的产品，将具体任务分给具体的工厂</strong></p><ol start="3"><li><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MakeCar</span> </span>&#123;</span><br><span class="line">    <span class="function">Car <span class="title">make</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">descar</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体工厂1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BenzMake</span> <span class="keyword">implements</span> <span class="title">MakeCar</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始制造奔驰"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BenzCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体工厂2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BmwMake</span> <span class="keyword">implements</span> <span class="title">MakeCar</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">make</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始制造宝马"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BMWCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BenzCar</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">descar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"奔驰大标好"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BMWCar</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">descar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"宝马操控性好"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 调用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</span><br><span class="line">        MakeCar make = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//指定具体的工厂来制造</span></span><br><span class="line">            make = <span class="keyword">new</span> BenzMake();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//指定具体的工厂来制造</span></span><br><span class="line">            make = <span class="keyword">new</span> BmwMake();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//得到具体的产品</span></span><br><span class="line">        Car car = make.make();</span><br><span class="line">        <span class="comment">//产品的特点</span></span><br><span class="line">        car.descar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>优缺点</p><p><strong>优点：</strong></p><ul><li><p>更符合开-闭原则<br>新增一种产品时，只需要增加相应的具体产品类和相应的工厂子类即可</p><blockquote><p>简单工厂模式需要修改工厂类的判断逻辑</p></blockquote></li><li><p>符合单一职责原则<br>每个具体工厂类只负责创建对应的产品</p><blockquote><p>简单工厂中的工厂类存在复杂的switch逻辑判断</p></blockquote></li><li><p>不使用静态工厂方法，可以形成基于继承的等级结构。</p><blockquote><p>简单工厂模式的工厂类使用静态工厂方法</p></blockquote></li></ul><p>总结：工厂模式可以说是简单工厂模式的进一步抽象和拓展，在保留了简单工厂的封装优点的同时，让扩展变得简单，让继承变得可行，增加了多态性的体现。</p><p><strong>缺点：</strong></p><ul><li><p>添加新产品时，除了增加新产品类外，还要提供与之对应的具体工厂类，系统类的个数将成对增加，在一定程度上增加了系统的复杂度；同时，有更多的类需要编译和运行，会给系统带来一些额外的开销；</p></li><li><p>由于考虑到系统的可扩展性，需要引入抽象层，在客户端代码中均使用抽象层进行定义，增加了系统的抽象性和理解难度，且在实现时可能需要用到DOM、反射等技术，增加了系统的实现难度。</p></li><li><p>虽然保证了工厂方法内的对修改关闭，但对于使用工厂方法的类，如果要更换另外一种产品，仍然需要修改实例化的具体工厂类；</p></li><li><p>一个具体工厂只能创建一种具体产品</p></li></ul></li></ol><h6 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h6><hr><p>   上面两种模式不管工厂怎么拆分抽象，都只是针对一类产品，如果要生产另外一种产品，该怎么办？</p><p>   先来认识下产品族：</p><p>   宝马的跑车，奔驰的跑车，都可以归类到跑车产品，而这个跑车产品就是一个产品族。</p><hr><p>   <strong>抽象工厂模式和工厂方法模式的区别就在于需要创建对象的复杂程度上。而且抽象工厂模式是最为抽象，最具一般性的</strong></p><p>   <strong>目的</strong>：给客户提供一个接口，可以创建多个产品族中的产品对象，而且使用抽象工厂还要满足以下条件：</p><ul><li>系统中有多个产品族，而系统一次只可能消费其中一族产品。</li><li>同属于一个产品族的产品以其使用。</li></ul><ol><li><p>主要角色</p><ol><li>抽象工厂角色：这是工厂方法模式的核心，与应用程序无关。是具体工厂角色必须实现的接口或者必须继承的父类</li><li>具体工厂角色：它含有和具体业务逻辑有关的代码。由应用程序调用以创建对应的具体产品的对象。</li><li>抽象产品角色：它是由具体产品继承的父类或者实现的接口。</li><li>具体产品角色：具体工厂角色所创建的对象就是此角色的实例。</li></ol></li><li><p>逻辑如下</p><p><img src="https://img-blog.csdnimg.cn/20200805160221453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li></ol><pre><code>抽象产品A、抽象产品B 表示一个产品族（比如下面例子中的手表、随身听），具体工厂1、具体工厂2 就表示一个厂牌的工厂（比如下面例子的小米工厂、sony工厂），那么就简单了，小米工厂生产手表，随身听；sony工厂也可以生产手表，随身听</code></pre><ol start="3"><li><p>代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.design_mod.factory.simple;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FactoryUnionAll</span> </span>&#123;</span><br><span class="line">    <span class="function">Watch <span class="title">makeWatch</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Walkman <span class="title">makeWalkMan</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Watch</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showTime</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象产品2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Walkman</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">playMusic</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体工厂1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MibranFactory</span> <span class="keyword">implements</span> <span class="title">FactoryUnionAll</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Watch <span class="title">makeWatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始制造小米手表"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MiWatch();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Walkman <span class="title">makeWalkMan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始制造小米随身听"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MiWalkman();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 具体工厂2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SonyFactory</span> <span class="keyword">implements</span> <span class="title">FactoryUnionAll</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Watch <span class="title">makeWatch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始制造sony手表"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SonyWatch();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Walkman <span class="title">makeWalkMan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始制造sony随身听"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SonyWalkMan();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiWatch</span> <span class="keyword">implements</span> <span class="title">Watch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"小米滴滴滴"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体产品2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SonyWatch</span> <span class="keyword">implements</span> <span class="title">Watch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"sony 哒哒哒"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiWalkman</span> <span class="keyword">implements</span> <span class="title">Walkman</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMusic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"小米音乐卡卡卡"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SonyWalkMan</span> <span class="keyword">implements</span> <span class="title">Walkman</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">playMusic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"sony nb"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：tangfan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2020/8/5 15:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FactoryUnionAll mibranFactory = <span class="keyword">new</span> MibranFactory();</span><br><span class="line">        FactoryUnionAll sonyFactory = <span class="keyword">new</span> SonyFactory();</span><br><span class="line"></span><br><span class="line">        mibranFactory.makeWalkMan().playMusic();</span><br><span class="line">        mibranFactory.makeWatch().showTime();</span><br><span class="line"></span><br><span class="line">        sonyFactory.makeWatch().showTime();</span><br><span class="line">        sonyFactory.makeWalkMan().playMusic();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>优缺点</p><p><strong>优点：</strong></p><ul><li><p>降低耦合<br>抽象工厂模式将具体产品的创建延迟到具体工厂的子类中，这样将对象的创建封装起来，可以减少客户端与具体产品类之间的依赖，从而使系统耦合度低，这样更有利于后期的维护和扩展；</p></li><li><p>更符合开-闭原则<br>新增一种产品类时，只需要增加相应的具体产品类和相应的工厂子类即可</p><blockquote><p>简单工厂模式需要修改工厂类的判断逻辑</p></blockquote></li><li><p>符合单一职责原则<br>每个具体工厂类只负责创建对应的产品</p><blockquote><p>简单工厂中的工厂类存在复杂的switch逻辑判断</p></blockquote></li><li><p>不使用静态工厂方法，可以形成基于继承的等级结构。</p><blockquote><p>简单工厂模式的工厂类使用静态工厂方法</p></blockquote></li></ul><p><strong>缺点：</strong></p><p>抽象工厂模式很难支持新种类产品的变化。<br> 这是因为抽象工厂接口中已经确定了可以被创建的产品集合，如果需要添加新产品，此时就必须去修改抽象工厂的接口，这样就涉及到抽象工厂类的以及所有子类的改变，这样也就违背了“开发——封闭”原则。</p></li></ol>]]></content>
    
    
    <summary type="html">设计模式中的工厂模式详解</summary>
    
    
    
    <category term="设计模式" scheme="https://floatinghua.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="设计模式" scheme="https://floatinghua.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>使用java-POI导出自定义表格</title>
    <link href="https://floatinghua.github.io/2020/07/01/%E4%BD%BF%E7%94%A8java-POI%E5%AF%BC%E5%87%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E6%A0%BC/"/>
    <id>https://floatinghua.github.io/2020/07/01/%E4%BD%BF%E7%94%A8java-POI%E5%AF%BC%E5%87%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E6%A0%BC/</id>
    <published>2020-07-01T03:39:26.000Z</published>
    <updated>2020-09-08T06:07:18.810Z</updated>
    
    <content type="html"><![CDATA[<p>首先看效果图<br><img src="https://img-blog.csdnimg.cn/20200615115725389.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>问题</strong>：之前用的是hutool导出excel，可是hutool只能导出稍微简单一点得，复杂的只好自己手动来画了。所以去看了下poi的api学习了下，做了个简单的demo，其中api在这里查看<a href="https://blog.csdn.net/qq_42651904/article/details/88221392" target="_blank" rel="noopener">poi中文文档</a></p><p>依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>如果你用的是hutool的poi-ooxml 版本是4.12,那请自己替换对应方法，就是居中和字体加粗，因为在4.12中没有这些方法，自行更换就行</strong></p><h4 id="本次用到的poi常用的方法："><a href="#本次用到的poi常用的方法：" class="headerlink" title="本次用到的poi常用的方法："></a>本次用到的poi常用的方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">创建excel工作簿对象 </span><br><span class="line">    HSSFWorkbook workbook=<span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">创建工作表对象</span><br><span class="line">    HSSFSheet sheet=workbook.createSheet(<span class="string">"这里可写名字 可不写"</span>);</span><br><span class="line">创建单元格样式</span><br><span class="line">    HSSFCellStyle style=workbook.createCellStyle();</span><br><span class="line">单元格设置颜色</span><br><span class="line">    style.setFillForegroundColor(IndexedColors.YELLOW.getIndex());</span><br><span class="line">style.setFillPattern(CellStyle.SOLID_FOREGROUND);</span><br><span class="line">设置字体才能生效</span><br><span class="line">       style.setFont(font);</span><br><span class="line">    设置水平居中</span><br><span class="line">        <span class="comment">//        左右居中2 居右3 默认居左</span></span><br><span class="line">        style.setAlignment((<span class="keyword">short</span>) align);</span><br><span class="line">    设置上下居中</span><br><span class="line">        <span class="comment">//        上下居中1</span></span><br><span class="line">        style.setVerticalAlignment(HSSFCellStyle.VERTICAL_CENTER);</span><br><span class="line">设置边框</span><br><span class="line">         style.setBorderRight((<span class="keyword">short</span>) <span class="number">2</span>);</span><br><span class="line"> style.setLocked(<span class="keyword">true</span>);</span><br><span class="line">创建字体</span><br><span class="line">    HSSFFont font=workbook.createFont();</span><br><span class="line">指定字体</span><br><span class="line">        font.setFontName(<span class="string">"宋体"</span>；</span><br><span class="line">    设置字体大小</span><br><span class="line">        font.setFontHeightInPoints((<span class="keyword">short</span>) fontSize);</span><br><span class="line">    设置字体加粗</span><br><span class="line">        font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);</span><br><span class="line">    </span><br><span class="line">创建一行</span><br><span class="line">    HSSFRow row=sheet.createRow(rowNumber);</span><br><span class="line">创建单元格</span><br><span class="line">    HSSFCell cell=row.createCell(cellNumber);</span><br><span class="line">    设置单元格的样式</span><br><span class="line">   cell.setCellStyle(style);</span><br><span class="line">合并列</span><br><span class="line">    sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="string">"合并开始行"</span>,<span class="string">"合并结束行"</span>,<span class="string">"合并开始列"</span>,<span class="string">"合并结束列"</span>))</span><br></pre></td></tr></table></figure><h4 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h4><p>其实总体上就是几个对象的操作而已,下面就是根据api写的工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.excel_export_self;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.CellStyle;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.IndexedColors;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.util.CellRangeAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：tangfan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2020/6/11 10:36</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExcel</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HSSFWorkbook workbook;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> HSSFSheet sheet;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//        根据你传入的字段合并表头</span></span><br><span class="line">        String[] headNames = <span class="keyword">new</span> String[]&#123;<span class="string">"微信昵称"</span>, <span class="string">"姓名"</span>, <span class="string">"性别"</span>,</span><br><span class="line">                <span class="string">"年龄"</span>, <span class="string">"客户身份"</span>, <span class="string">"营养师"</span>, <span class="string">"健康管理师"</span></span><br><span class="line">                , <span class="string">"销售人员"</span>, <span class="string">"服务名称"</span>, <span class="string">"购买时间"</span>, <span class="string">"生效日期"</span>,</span><br><span class="line">                <span class="string">"结束日期"</span>, <span class="string">"注册时间"</span>, <span class="string">"渠道来源"</span>, <span class="string">"勋章"</span>, <span class="string">"预约时间"</span>, <span class="string">"哪里听说"</span>&#125;;</span><br><span class="line">                <span class="comment">//单元格的宽度</span></span><br><span class="line">        <span class="keyword">int</span> colWidths[] = &#123;<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>&#125;;</span><br><span class="line">        <span class="comment">//          创建Excel工作簿对象</span></span><br><span class="line">        workbook = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line"><span class="comment">//          创Excel工作表对象 可以传参自定义名称</span></span><br><span class="line">        sheet = workbook.createSheet(<span class="string">"客户资料导出"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//          创建表头</span></span><br><span class="line">        <span class="keyword">int</span> headCell = createHeadCell(headNames, colWidths);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        workbook.write(baos);</span><br><span class="line">        <span class="keyword">byte</span>[] ba = baos.toByteArray();</span><br><span class="line">        ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(ba);</span><br><span class="line"></span><br><span class="line">        File f = <span class="keyword">new</span> File(<span class="string">"d:\\excel.xls"</span>);</span><br><span class="line">        <span class="keyword">if</span> (f.exists())</span><br><span class="line">            f.delete();</span><br><span class="line">        f.createNewFile();</span><br><span class="line">        FileOutputStream out = <span class="keyword">new</span> FileOutputStream(f);</span><br><span class="line">        HSSFWorkbook book = <span class="keyword">new</span> HSSFWorkbook(bais);</span><br><span class="line">        book.write(out);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建样式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fontSize 字体大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> align    水平位置  左右居中2 居右3 默认居左 垂直均为居中</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bold     是否加粗</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> HSSFCellStyle <span class="title">getStyle</span><span class="params">(<span class="keyword">int</span> fontSize, <span class="keyword">int</span> align, <span class="keyword">boolean</span> bold, <span class="keyword">boolean</span> border)</span> </span>&#123;</span><br><span class="line">        HSSFFont font = workbook.createFont();</span><br><span class="line"><span class="comment">//        字体</span></span><br><span class="line">        font.setFontName(<span class="string">"宋体"</span>);</span><br><span class="line"><span class="comment">//        字体大小</span></span><br><span class="line">        font.setFontHeightInPoints((<span class="keyword">short</span>) fontSize);</span><br><span class="line">        <span class="keyword">if</span> (bold) &#123;</span><br><span class="line">            font.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);</span><br><span class="line">        &#125;</span><br><span class="line">        HSSFCellStyle style = workbook.createCellStyle();</span><br><span class="line"><span class="comment">//        设置字体</span></span><br><span class="line">        style.setFont(font);</span><br><span class="line"><span class="comment">//        左右居中2 居右3 默认居左</span></span><br><span class="line">        style.setAlignment((<span class="keyword">short</span>) align);</span><br><span class="line"><span class="comment">//        上下居中1</span></span><br><span class="line">        style.setVerticalAlignment(HSSFCellStyle.VERTICAL_CENTER);</span><br><span class="line">        <span class="keyword">if</span> (border) &#123;</span><br><span class="line">            style.setBorderRight((<span class="keyword">short</span>) <span class="number">2</span>);</span><br><span class="line">            style.setBorderLeft((<span class="keyword">short</span>) <span class="number">2</span>);</span><br><span class="line">            style.setBorderBottom((<span class="keyword">short</span>) <span class="number">2</span>);</span><br><span class="line">            style.setBorderTop((<span class="keyword">short</span>) <span class="number">2</span>);</span><br><span class="line">            style.setLocked(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> style;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建行元素</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> style  样式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height 行高</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value  行显示的内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> row1   起始行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> row2   结束行</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> col1   起始列</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> col2   结束列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createRow</span><span class="params">(HSSFCellStyle style, <span class="keyword">int</span> height, String value, <span class="keyword">int</span> row1, <span class="keyword">int</span> row2, <span class="keyword">int</span> col1, <span class="keyword">int</span> col2)</span> </span>&#123;</span><br><span class="line">        sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(row1, row2, col1, col2));  <span class="comment">//设置从第row1行合并到第row2行，第col1列合并到col2列</span></span><br><span class="line">        HSSFRow rows = sheet.createRow(row1);        <span class="comment">//设置第几行</span></span><br><span class="line">        rows.setHeight((<span class="keyword">short</span>) height);              <span class="comment">//设置行高</span></span><br><span class="line">        HSSFCell cell = rows.createCell(col1);       <span class="comment">//设置内容开始的列</span></span><br><span class="line">        cell.setCellStyle(style);                    <span class="comment">//设置样式</span></span><br><span class="line">        cell.setCellValue(value);                    <span class="comment">//设置该行的值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建表头</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headNames</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> colWidths</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">createHeadCell</span><span class="params">(String[] headNames, <span class="keyword">int</span> colWidths[])</span> </span>&#123;</span><br><span class="line"><span class="comment">//         表头标题开始</span></span><br><span class="line"><span class="comment">//        样式</span></span><br><span class="line">        HSSFCellStyle titleStyle = getStyle(<span class="number">15</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//        设置颜色</span></span><br><span class="line">        titleStyle.setFillForegroundColor(IndexedColors.YELLOW.getIndex());</span><br><span class="line">        titleStyle.setFillPattern(CellStyle.SOLID_FOREGROUND);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        创建第一行</span></span><br><span class="line">        createRow(titleStyle, <span class="number">500</span>, <span class="string">"基础信息"</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, headNames.length - <span class="number">1</span>);</span><br><span class="line"><span class="comment">//        表头标题结束</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        第二行表头开始</span></span><br><span class="line">        <span class="keyword">boolean</span> b = (headNames != <span class="keyword">null</span> &amp;&amp; headNames.length &gt; <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (b) &#123;</span><br><span class="line">            HSSFRow row2 = sheet.createRow(<span class="number">1</span>);</span><br><span class="line">            row2.setHeight((<span class="keyword">short</span>) <span class="number">0x289</span>);</span><br><span class="line">            HSSFCell fcell = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//          建立新的cell样式</span></span><br><span class="line">            HSSFCellStyle cellStyle = getStyle(<span class="number">10</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; headNames.length; i++) &#123;</span><br><span class="line">                fcell = row2.createCell(i);</span><br><span class="line">                fcell.setCellStyle(cellStyle);</span><br><span class="line">                fcell.setCellValue(headNames[i]);</span><br><span class="line">                <span class="keyword">if</span> (colWidths != <span class="keyword">null</span> &amp;&amp; i &lt; colWidths.length) &#123;</span><br><span class="line">                    sheet.setColumnWidth(i, <span class="number">32</span> * colWidths[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        //      空一行</span></span><br><span class="line"></span><br><span class="line">        HSSFCellStyle blankStyle = getStyle(<span class="number">20</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">        createRow(blankStyle, <span class="number">400</span>, <span class="string">""</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>, headNames.length - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        问卷信息</span></span><br><span class="line">        HSSFRow queryTitleRow = sheet.createRow(<span class="number">4</span>);</span><br><span class="line">        HSSFCell cell = queryTitleRow.createCell(<span class="number">0</span>);</span><br><span class="line">        cell.setCellStyle(getStyle(<span class="number">10</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>));</span><br><span class="line">        cell.setCellValue(<span class="string">"问卷信息"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//      开始问卷信息详情</span></span><br><span class="line">        HSSFRow queryContentRow = sheet.createRow(<span class="number">5</span>);</span><br><span class="line">        HSSFCellStyle queryContentStyle = getStyle(<span class="number">10</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">        HSSFCellStyle blankCellStyle = getStyle(<span class="number">10</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">        queryContentRow.setRowStyle(queryContentStyle);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">22</span>; i++) &#123;</span><br><span class="line">            HSSFCell contentCell = queryContentRow.createCell(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        HSSFCellStyle style = getStyle(<span class="number">10</span>, <span class="number">2</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//        设置颜色</span></span><br><span class="line">        style.setFillForegroundColor(IndexedColors.YELLOW.getIndex());</span><br><span class="line">        style.setFillPattern(CellStyle.SOLID_FOREGROUND);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        合并问卷详情的标题</span></span><br><span class="line"><span class="comment">//        健康目标</span></span><br><span class="line">        sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">        HSSFCell cell1 = queryContentRow.getCell(<span class="number">0</span>);</span><br><span class="line">        cell1.setCellValue(<span class="string">"健康目标"</span>);</span><br><span class="line">        cell1.setCellStyle(style);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        生活习惯</span></span><br><span class="line">        sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>));</span><br><span class="line">        HSSFCell cell2 = queryContentRow.getCell(<span class="number">4</span>);</span><br><span class="line">        cell2.setCellValue(<span class="string">"生活习惯"</span>);</span><br><span class="line">        cell2.setCellStyle(style);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        身体状况，亲属疾病</span></span><br><span class="line">        sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="number">5</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>));</span><br><span class="line">        HSSFCell cell3 = queryContentRow.getCell(<span class="number">8</span>);</span><br><span class="line">        cell3.setCellValue(<span class="string">"身体状况-亲属疾病"</span>);</span><br><span class="line">        cell3.setCellStyle(style);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        体检指标</span></span><br><span class="line">        sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="number">5</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">15</span>));</span><br><span class="line">        HSSFCell cell4 = queryContentRow.getCell(<span class="number">12</span>);</span><br><span class="line">        cell4.setCellValue(<span class="string">"体检指标"</span>);</span><br><span class="line">        cell4.setCellStyle(style);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        用药信息</span></span><br><span class="line">        sheet.addMergedRegion(<span class="keyword">new</span> CellRangeAddress(<span class="number">5</span>, <span class="number">5</span>, <span class="number">17</span>, <span class="number">22</span>));</span><br><span class="line">        HSSFCell cell5 = queryContentRow.getCell(<span class="number">17</span>);</span><br><span class="line">        cell5.setCellValue(<span class="string">"用药信息"</span>);</span><br><span class="line">        cell5.setCellStyle(style);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        每个目标分类下的小标题</span></span><br><span class="line">        HSSFRow queryContentSmallTitle = sheet.createRow(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">23</span>; i++) &#123;</span><br><span class="line">            HSSFCell contentCell = queryContentSmallTitle.createCell(i);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        健康目标</span></span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">0</span>).setCellValue(<span class="string">"序号"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">1</span>).setCellValue(<span class="string">"问题"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">2</span>).setCellValue(<span class="string">"内容"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//      生活习惯</span></span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">4</span>).setCellValue(<span class="string">"序号"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">5</span>).setCellValue(<span class="string">"问题"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">6</span>).setCellValue(<span class="string">"内容"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        身体状况-亲属疾病</span></span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">8</span>).setCellValue(<span class="string">"序号"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">9</span>).setCellValue(<span class="string">"问题"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">10</span>).setCellValue(<span class="string">"内容"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        体检指标</span></span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">12</span>).setCellValue(<span class="string">"序号"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">13</span>).setCellValue(<span class="string">"类型"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">14</span>).setCellValue(<span class="string">"值"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">15</span>).setCellValue(<span class="string">"参考范围"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        用药信息</span></span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">17</span>).setCellValue(<span class="string">"序号"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">18</span>).setCellValue(<span class="string">"药物名称"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">19</span>).setCellValue(<span class="string">"使用剂量"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">20</span>).setCellValue(<span class="string">"用药频次"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">21</span>).setCellValue(<span class="string">"用药时长"</span>);</span><br><span class="line">        queryContentSmallTitle.getCell(<span class="number">22</span>).setCellValue(<span class="string">"用途"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">8</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">23</span>; j++) &#123;</span><br><span class="line">                sheet.createRow(i).createCell(j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从哪一行开始渲染表体</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上就是全部内容，poi的api还有很多没学习到，Stay hungry,Stay foolish!</p>]]></content>
    
    
    <summary type="html">使用java poi导出复杂的excel</summary>
    
    
    
    <category term="java" scheme="https://floatinghua.github.io/categories/java/"/>
    
    
    <category term="工具" scheme="https://floatinghua.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="poi" scheme="https://floatinghua.github.io/tags/poi/"/>
    
    <category term="api" scheme="https://floatinghua.github.io/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>Linux和Windows下集成海康摄像头(特别解决linux加载不到库)</title>
    <link href="https://floatinghua.github.io/2020/07/01/Linux%E5%92%8CWindows%E4%B8%8B%E9%9B%86%E6%88%90%E6%B5%B7%E5%BA%B7%E6%91%84%E5%83%8F%E5%A4%B4-%E7%89%B9%E5%88%AB%E8%A7%A3%E5%86%B3linux%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%88%B0%E5%BA%93/"/>
    <id>https://floatinghua.github.io/2020/07/01/Linux%E5%92%8CWindows%E4%B8%8B%E9%9B%86%E6%88%90%E6%B5%B7%E5%BA%B7%E6%91%84%E5%83%8F%E5%A4%B4-%E7%89%B9%E5%88%AB%E8%A7%A3%E5%86%B3linux%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%88%B0%E5%BA%93/</id>
    <published>2020-07-01T03:38:55.000Z</published>
    <updated>2020-09-08T06:09:10.670Z</updated>
    
    <content type="html"><![CDATA[<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>最近要集成海康摄像头部署到linux服务器，但是一直调用不到so文件，所以记录下解决过程，<br>由于自己不熟悉jna，所以请轻喷，<strong>Stay Hungry,Stay Foolish.</strong></p><p><a href="https://www.hikvision.com/cn/download_61.html" target="_blank" rel="noopener">海康sdk官方下载地址</a></p><h4 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h4><p><strong><strong>至于为什么先讲linux等下就知道了</strong></strong>，linux的sdk下载下来目录如下：<br><img src="https://img-blog.csdnimg.cn/20200528173418663.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="\[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Ra7VlK6d-1590658348978)(C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200528163929984.png)\]"></p><p>开发文档有自己的业务需求就看对应的开放文档</p><p><strong>我们直接看LinuxJavaDemo文件夹</strong></p><p><img src="https://img-blog.csdnimg.cn/20200528173443515.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><strong>这边我选择的是方法一，但是不是在系统的/usr/lib文件下，自己新建的文件夹</strong></p><h4 id="linux准备工作"><a href="#linux准备工作" class="headerlink" title="linux准备工作"></a>linux准备工作</h4><ol><li><p>linux下搭配jdk1.8，我这边linux服务器新建了一个目录（<strong>/home/opt/hcnet</strong>）来存放下面的so文件</p></li><li><p>上传文件到linux目录下  就是图中的lib文件,<strong>所有的都上传到你的linux目录</strong> </p><p><img src="https://img-blog.csdnimg.cn/20200528173517359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>创建lib文件夹引入sdk包中的examples.jar和jna.jar<br><img src="https://img-blog.csdnimg.cn/20200528173551673.png" alt="在这里插入图片描述"><br>在pom中添加 不然会报错</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.jna<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/lib/jna.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.jna.examples<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>yx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/lib/examples.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>打包添加如下配置<br><img src="https://img-blog.csdnimg.cn/20200528173624768.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>开始集成</p><p><strong>将linux中的HCNetSDK.java放到项目中，修改代码，将他初始化的地方注释掉，我们自己初始化</strong></p></li></ol><p><img src="https://img-blog.csdnimg.cn/20200528173635709.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>下面就是自己的初始化代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.hkdemo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.jna.Native;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.NativeLong;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.Platform;</span><br><span class="line"><span class="keyword">import</span> com.yx.hkdemo.HCNetSDK;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ：tangfan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> ：Created in 2020/5/25 17:36</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>：</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@modified</span> By：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetHCNetSdk</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HCNetSDK hcNetSDK = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//windows下的路径</span></span><br><span class="line">    String PATH_WIN = System.getProperty(<span class="string">"user.dir"</span>) + File.separator + <span class="string">"hkwinlib"</span> + File.separator + <span class="string">"HCNetSDK"</span>;</span><br><span class="line">    String PATH_LINUX = <span class="string">"/home/opt/hcnet/libhcnetsdk.so"</span>;</span><br><span class="line">    <span class="keyword">private</span> HCNetSDK.NET_DVR_DEVICEINFO_V30 deviceInfo;<span class="comment">//设备信息</span></span><br><span class="line">    <span class="keyword">private</span> NativeLong lUserID;<span class="comment">//用户句柄</span></span><br><span class="line">    <span class="keyword">private</span> NativeLong lAlarmHandle;<span class="comment">//报警布防句柄</span></span><br><span class="line">    <span class="comment">//    private HCNetSDK.FMSGCallBack_V31 fMSFCallBack_V31;//报警回调函数实现</span></span><br><span class="line">    <span class="keyword">private</span> HCNetSDK.FMSGCallBack fMSFCallBack;<span class="comment">//报警回调函数实现</span></span><br><span class="line">    <span class="keyword">private</span> String deviceIP;<span class="comment">//已登录设备的IP地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> devicePort;<span class="comment">//设备端口号</span></span><br><span class="line">    <span class="keyword">private</span> String username;<span class="comment">//设备用户名</span></span><br><span class="line">    <span class="keyword">private</span> String password;<span class="comment">//设备登陆密码</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> init_flag;<span class="comment">//初始化识别标志</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> reg_flag;<span class="comment">//设备注册识别标志</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GetHCNetSdk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        install();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">install</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Platform.isWindows()) &#123;</span><br><span class="line">            hcNetSDK = (HCNetSDK) Native.loadLibrary(PATH_WIN, HCNetSDK<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Platform.isLinux()) &#123;</span><br><span class="line">            hcNetSDK = (HCNetSDK) Native.loadLibrary(PATH_LINUX, HCNetSDK<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>如果在linux上运行报错，请在linux下的hcNetSDK = (HCNetSDK) Native.loadLibrary(PATH_LINUX, HCNetSDK.class);后面加入官方的这段代码，并且修改成自己的路径，我的是/home/opt/hcnet</strong><br><img src="https://img-blog.csdnimg.cn/20200528173704738.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>代码在下面：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//设置HCNetSDKCom组件库所在路径</span></span><br><span class="line"><span class="comment">//        /home/opt/hcnet/libhcnetsdk.so</span></span><br><span class="line"><span class="comment">//        /home/opt/hcnet</span></span><br><span class="line">            String strPathCom = <span class="string">"/home/opt/hcnet"</span>;</span><br><span class="line">            HCNetSDK.NET_DVR_LOCAL_SDK_PATH struComPath = <span class="keyword">new</span> HCNetSDK.NET_DVR_LOCAL_SDK_PATH();</span><br><span class="line">            System.arraycopy(strPathCom.getBytes(), <span class="number">0</span>, struComPath.sPath, <span class="number">0</span>, strPathCom.length());</span><br><span class="line">            struComPath.write();</span><br><span class="line">            hcNetSDK.NET_DVR_SetSDKInitCfg(<span class="number">2</span>, struComPath.getPointer());</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置libcrypto.so所在路径</span></span><br><span class="line">            HCNetSDK.BYTE_ARRAY ptrByteArrayCrypto = <span class="keyword">new</span> HCNetSDK.BYTE_ARRAY(<span class="number">256</span>);</span><br><span class="line">            String strPathCrypto = <span class="string">"/home/opt/hcnet/libcrypto.so"</span>;</span><br><span class="line">            System.arraycopy(strPathCrypto.getBytes(), <span class="number">0</span>, ptrByteArrayCrypto.byValue, <span class="number">0</span>, strPathCrypto.length());</span><br><span class="line">            ptrByteArrayCrypto.write();</span><br><span class="line">            hcNetSDK.NET_DVR_SetSDKInitCfg(<span class="number">3</span>, ptrByteArrayCrypto.getPointer());</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置libssl.so所在路径</span></span><br><span class="line">            HCNetSDK.BYTE_ARRAY ptrByteArraySsl = <span class="keyword">new</span> HCNetSDK.BYTE_ARRAY(<span class="number">256</span>);</span><br><span class="line">            String strPathSsl = <span class="string">"/home/opt/hcnet/libssl.so"</span>;</span><br><span class="line">            System.arraycopy(strPathSsl.getBytes(), <span class="number">0</span>, ptrByteArraySsl.byValue, <span class="number">0</span>, strPathSsl.length());</span><br><span class="line">            ptrByteArraySsl.write();</span><br><span class="line">            hcNetSDK.NET_DVR_SetSDKInitCfg(<span class="number">4</span>, ptrByteArraySsl.getPointer());</span><br></pre></td></tr></table></figure><ol start="5"><li>编写工具类，自己写方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yx.hkdemo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.jna.NativeLong;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.Pointer;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.ptr.IntByReference;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.ptr.NativeLongByReference;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import org.apache.commons.lang.StringUtils;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//import cc.eguid.FFmpegCommandManager.FFmpegManager;</span></span><br><span class="line"><span class="comment">//import cc.eguid.FFmpegCommandManager.FFmpegManagerImpl;</span></span><br><span class="line"><span class="comment">//import com.dfzx.common.util.CommonKit;</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HCNetTools</span> </span>&#123;</span><br><span class="line">    HCNetSDK hCNetSDK = <span class="keyword">null</span>;</span><br><span class="line">    HCNetSDK.NET_DVR_DEVICEINFO_V30 m_strDeviceInfo;<span class="comment">//设备信息</span></span><br><span class="line">    HCNetSDK.NET_DVR_IPPARACFG m_strIpparaCfg;<span class="comment">//IP参数</span></span><br><span class="line">    HCNetSDK.NET_DVR_CLIENTINFO m_strClientInfo;<span class="comment">//用户参数</span></span><br><span class="line">    <span class="keyword">boolean</span> bRealPlay;<span class="comment">//是否在预览.</span></span><br><span class="line">    String m_sDeviceIP;<span class="comment">//已登录设备的IP地址</span></span><br><span class="line">    NativeLong lUserID;<span class="comment">//用户句柄</span></span><br><span class="line">    NativeLong lPreviewHandle;<span class="comment">//预览句柄</span></span><br><span class="line">    NativeLongByReference m_lPort;<span class="comment">//回调预览时播放库端口指针</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HCNetTools</span><span class="params">(HCNetSDK sdk)</span> </span>&#123;</span><br><span class="line">        JPopupMenu.setDefaultLightWeightPopupEnabled(<span class="keyword">false</span>);<span class="comment">//防止被播放窗口(AWT组件)覆盖</span></span><br><span class="line">        lUserID = <span class="keyword">new</span> NativeLong(-<span class="number">1</span>);</span><br><span class="line">        lPreviewHandle = <span class="keyword">new</span> NativeLong(-<span class="number">1</span>);</span><br><span class="line">        m_lPort = <span class="keyword">new</span> NativeLongByReference(<span class="keyword">new</span> NativeLong(-<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">this</span>.hCNetSDK = sdk;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//    FFmpegManager manager;//rstp转rmtp工具</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//FRealDataCallBack fRealDataCallBack;//预览回调函数实现</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HCNetTools</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        JPopupMenu.setDefaultLightWeightPopupEnabled(<span class="keyword">false</span>);<span class="comment">//防止被播放窗口(AWT组件)覆盖</span></span><br><span class="line">        lUserID = <span class="keyword">new</span> NativeLong(-<span class="number">1</span>);</span><br><span class="line">        lPreviewHandle = <span class="keyword">new</span> NativeLong(-<span class="number">1</span>);</span><br><span class="line">        m_lPort = <span class="keyword">new</span> NativeLongByReference(<span class="keyword">new</span> NativeLong(-<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//fRealDataCallBack= new FRealDataCallBack();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化资源配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">initDevices</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!hCNetSDK.NET_DVR_Init()) <span class="keyword">return</span> <span class="number">1</span>;<span class="comment">//初始化失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设备注册</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name     设备用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 设备登录密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ip       IP地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port     端口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deviceRegist</span><span class="params">(String name, String password, String ip, String port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (bRealPlay) &#123;<span class="comment">//判断当前是否在预览</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;<span class="comment">//"注册新用户请先停止当前预览";</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (lUserID.longValue() &gt; -<span class="number">1</span>) &#123;<span class="comment">//先注销,在登录</span></span><br><span class="line">            hCNetSDK.NET_DVR_Logout_V30(lUserID);</span><br><span class="line">            lUserID = <span class="keyword">new</span> NativeLong(-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"注册里面:lUserId:"</span>+lUserID);</span><br><span class="line">        <span class="comment">//注册(既登录设备)开始</span></span><br><span class="line">        m_sDeviceIP = ip;</span><br><span class="line">        m_strDeviceInfo = <span class="keyword">new</span> HCNetSDK.NET_DVR_DEVICEINFO_V30();<span class="comment">//获取设备参数结构</span></span><br><span class="line">        System.out.println(<span class="string">"注册里面：ip:"</span>+m_sDeviceIP+<span class="string">"     info:"</span>+m_strDeviceInfo);</span><br><span class="line">        lUserID = hCNetSDK.NET_DVR_Login_V30(m_sDeviceIP, (<span class="keyword">short</span>) Integer.parseInt(<span class="string">"8000"</span>), name, password, m_strDeviceInfo);<span class="comment">//登录设备</span></span><br><span class="line"><span class="comment">//        NativeLong lUserID, int dwCommand, NativeLong lChannel, Pointer lpInBuffer, int dwInBufferSize</span></span><br><span class="line">        System.out.println(<span class="string">"登录后的id"</span>+lUserID);</span><br><span class="line">        <span class="keyword">int</span> i = hCNetSDK.NET_DVR_GetLastError();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"登录错误代码："</span>+i);</span><br><span class="line">        m_strIpparaCfg = <span class="keyword">new</span> HCNetSDK.NET_DVR_IPPARACFG();</span><br><span class="line">        Pointer lpIpParaConfig = m_strIpparaCfg.getPointer();</span><br><span class="line">        <span class="keyword">boolean</span> b = hCNetSDK.NET_DVR_SetDVRConfig(lUserID, HCNetSDK.NET_DVR_GET_IPPARACFG, <span class="keyword">new</span> NativeLong(<span class="number">0</span>), lpIpParaConfig, m_strIpparaCfg.size());</span><br><span class="line">        <span class="keyword">int</span> seti = hCNetSDK.NET_DVR_GetLastError();</span><br><span class="line">        System.out.println(<span class="string">"setConfig"</span>+seti);</span><br><span class="line">        System.out.println(<span class="string">"b:"</span>+b);</span><br><span class="line">        <span class="keyword">long</span> userID = lUserID.longValue();</span><br><span class="line">        System.out.println(<span class="string">"注册里面：userId:"</span>+userID);</span><br><span class="line">        <span class="keyword">if</span> (userID == -<span class="number">1</span>) &#123;</span><br><span class="line">            m_sDeviceIP = <span class="string">""</span>;<span class="comment">//登录未成功,IP置为空</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">3</span>;<span class="comment">//"注册失败";</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取设备通道</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getChannelNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        IntByReference ibrBytesReturned = <span class="keyword">new</span> IntByReference(<span class="number">0</span>);<span class="comment">//获取IP接入配置参数</span></span><br><span class="line">        <span class="keyword">boolean</span> bRet = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">int</span> iChannelNum = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        m_strIpparaCfg = <span class="keyword">new</span> HCNetSDK.NET_DVR_IPPARACFG();</span><br><span class="line">        m_strIpparaCfg.write();</span><br><span class="line">        Pointer lpIpParaConfig = m_strIpparaCfg.getPointer();</span><br><span class="line"></span><br><span class="line">        bRet = hCNetSDK.NET_DVR_GetDVRConfig(lUserID, HCNetSDK.NET_DVR_GET_IPPARACFG, <span class="keyword">new</span> NativeLong(<span class="number">0</span>), lpIpParaConfig, m_strIpparaCfg.size(), ibrBytesReturned);</span><br><span class="line">        <span class="keyword">int</span> geti = hCNetSDK.NET_DVR_GetLastError();</span><br><span class="line">        System.out.println(<span class="string">"geti:"</span>+geti);</span><br><span class="line">        m_strIpparaCfg.read();</span><br><span class="line"></span><br><span class="line">        String devices = <span class="string">""</span>;</span><br><span class="line">        System.out.println(<span class="string">"bRet:"</span>+bRet);</span><br><span class="line">        <span class="keyword">if</span> (!bRet) &#123;</span><br><span class="line">            <span class="comment">//设备不支持,则表示没有IP通道</span></span><br><span class="line">            System.out.println(<span class="string">"C:"</span>+m_strDeviceInfo.byChanNum);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> iChannum = <span class="number">0</span>; iChannum &lt; m_strDeviceInfo.byChanNum; iChannum++) &#123;</span><br><span class="line">                devices = <span class="string">"Camera"</span> + (iChannum + m_strDeviceInfo.byStartChan);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"IP"</span>+HCNetSDK.MAX_IP_CHANNEL);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> iChannum = <span class="number">0</span>; iChannum &lt; HCNetSDK.MAX_IP_CHANNEL; iChannum++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_strIpparaCfg.struIPChanInfo[iChannum].byEnable == <span class="number">1</span>) &#123;</span><br><span class="line">                    devices = <span class="string">"IPCamera"</span> + (iChannum + m_strDeviceInfo.byStartChan);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"通道："</span>+devices);</span><br><span class="line">        <span class="keyword">if</span> (devices != <span class="keyword">null</span> &amp;&amp; devices != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (devices.charAt(<span class="number">0</span>) == <span class="string">'C'</span>) &#123;<span class="comment">//Camara开头表示模拟通道</span></span><br><span class="line">                <span class="comment">//子字符串中获取通道号</span></span><br><span class="line">                System.out.println(<span class="string">"C"</span>);</span><br><span class="line">                iChannelNum = Integer.parseInt(devices.substring(<span class="number">6</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (devices.charAt(<span class="number">0</span>) == <span class="string">'I'</span>) &#123;<span class="comment">//IPCamara开头表示IP通道</span></span><br><span class="line">                    System.out.println(<span class="string">"I"</span>);</span><br><span class="line">                    <span class="comment">//子字符创中获取通道号,IP通道号要加32</span></span><br><span class="line">                    iChannelNum = Integer.parseInt(devices.substring(<span class="number">8</span>)) + <span class="number">32</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> iChannelNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取通道信号状态</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSignalStatus</span><span class="params">(<span class="keyword">int</span> channum)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取设备状态</span></span><br><span class="line">        HCNetSDK.NET_DVR_WORKSTATE_V30 devwork = <span class="keyword">new</span> HCNetSDK.NET_DVR_WORKSTATE_V30();</span><br><span class="line">        <span class="keyword">if</span> (!hCNetSDK.NET_DVR_GetDVRWorkState_V30(lUserID, devwork)) &#123;</span><br><span class="line">            <span class="comment">//返回Boolean值，判断是否获取设备能力</span></span><br><span class="line">            System.out.println(<span class="string">"返回设备状态失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> devwork.struChanStatic[channum].bySignalStatic;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拍照</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">takePic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//拍照</span></span><br><span class="line">        HCNetSDK.NET_DVR_JPEGPARA strJpeg = <span class="keyword">new</span> HCNetSDK.NET_DVR_JPEGPARA();</span><br><span class="line">        strJpeg.wPicQuality = <span class="number">1</span>; <span class="comment">//图像参数</span></span><br><span class="line">        strJpeg.wPicSize = <span class="number">2</span>;</span><br><span class="line">        String filePath = <span class="string">"E:\\123q.jpg"</span>;</span><br><span class="line">        lPreviewHandle.setValue(m_strDeviceInfo.byStartChan + <span class="number">32</span>);</span><br><span class="line">        <span class="keyword">boolean</span> b = hCNetSDK.NET_DVR_CaptureJPEGPicture(lUserID, lPreviewHandle, strJpeg, filePath);<span class="comment">//尝试用NET_DVR_CaptureJPEGPicture_NEW方法，但不是报43就是JDK崩溃....</span></span><br><span class="line">        <span class="keyword">if</span> (!b) &#123;<span class="comment">//单帧数据捕获图片</span></span><br><span class="line">            System.out.println(<span class="string">"抓拍失败!"</span> + <span class="string">" err: "</span> + hCNetSDK.NET_DVR_GetLastError());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"抓拍成功"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放SDK</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shutDownDev</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果已经注册,注销</span></span><br><span class="line">        <span class="keyword">if</span> (lUserID.longValue() &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">            hCNetSDK.NET_DVR_Logout_V30(lUserID);</span><br><span class="line">        &#125;</span><br><span class="line">        hCNetSDK.NET_DVR_Cleanup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   分别调用就行了</p><p>   Linux下运行成功的截图<br><img src="https://img-blog.csdnimg.cn/2020052817405633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="win准备和集成"><a href="#win准备和集成" class="headerlink" title="win准备和集成"></a>win准备和集成</h4><p>上面linux都集成好了，windows就只是需要修改一点东西就好了</p><p>因为我下载的是最新的linux SDK所以HCNetSDK.java就不需要做更改</p><ol><li><p>继续新建文件夹 引入win下面的dll文件 全部引入</p><p><img src="https://img-blog.csdnimg.cn/20200528174109430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li></ol><ol start="2"><li>因为上面的初始化类判断了linux和windows系统的，所以直接调用就可以了，因为linux下的sdk中的方法和win的方法基本一致，所以直接用就行了<br><img src="https://img-blog.csdnimg.cn/20200528174502106.png" alt="在这里插入图片描述"></li></ol><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><strong>集成linux出现的问题就是加载不到库，在摸索官方的sdk后，终于成功，还是自己太年轻，sdk看得不够多</strong></p>]]></content>
    
    
    <summary type="html">Linux和Windows下集成海康摄像头(特别解决linux加载不到库)</summary>
    
    
    
    <category term="linux" scheme="https://floatinghua.github.io/categories/linux/"/>
    
    
    <category term="springboot" scheme="https://floatinghua.github.io/tags/springboot/"/>
    
    <category term="集成" scheme="https://floatinghua.github.io/tags/%E9%9B%86%E6%88%90/"/>
    
    <category term="工具" scheme="https://floatinghua.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
    <category term="海康" scheme="https://floatinghua.github.io/tags/%E6%B5%B7%E5%BA%B7/"/>
    
  </entry>
  
  <entry>
    <title>springboot2.1.5 整合es6.3.0</title>
    <link href="https://floatinghua.github.io/2020/07/01/springboot2-1-5-%E6%95%B4%E5%90%88es6-3-0/"/>
    <id>https://floatinghua.github.io/2020/07/01/springboot2-1-5-%E6%95%B4%E5%90%88es6-3-0/</id>
    <published>2020-07-01T03:37:21.000Z</published>
    <updated>2020-10-21T09:06:16.145Z</updated>
    
    <content type="html"><![CDATA[<p>搭建环境如下：</p><ol><li>springboot 2.1.5  </li><li>elasticsearch 版本6.3.0</li><li>kibana 版本6.3.0</li><li>IK Analyzer for Elasticsearch 版本 6.3.0</li><li>如需设置账户密码登录要购买es的商业版</li><li>jdk1.8</li></ol><h4 id="安装elasticsearch6-3-0"><a href="#安装elasticsearch6-3-0" class="headerlink" title="安装elasticsearch6.3.0"></a>安装elasticsearch6.3.0</h4><p>下载地址：<a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener">es6.3.0</a></p><p>下载安装解压后就可以</p><p><strong>启动es 进入安装目录下的bin 运行elasticsearch.bat</strong> 出现如下表示启动成功<br><img src="https://img-blog.csdnimg.cn/20200520100918460.png" alt="在这里插入图片描述"><br>在浏览器中访问默认的端口号 9200 </p><p><img src="https://img-blog.csdnimg.cn/20200520100937208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>以下步骤根据<strong>个人需求</strong> 可以将es安装成windows的服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">安装服务</span><br><span class="line">elasticsearch-service.bat install</span><br><span class="line"></span><br><span class="line">删除已安装的es服务</span><br><span class="line">elasticsearch-service.bat remove</span><br><span class="line"></span><br><span class="line">启动es服务</span><br><span class="line">elasticsearch-service.bat start</span><br><span class="line"></span><br><span class="line">停止服务</span><br><span class="line">elasticsearch-service.bat stop</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520100958669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="安装kibana6-3-0"><a href="#安装kibana6-3-0" class="headerlink" title="安装kibana6.3.0"></a>安装kibana6.3.0</h4><p>下载地址:<a href="https://www.elastic.co/cn/downloads/past-releases#kibana" target="_blank" rel="noopener">kibana下载</a></p><p>下载安装解压</p><p><strong>由于是6.X版本不支持修改配置文件来汉化，而且汉化过程不可逆，所以根据个人需求进行汉化</strong></p><p><strong>汉化地址：<a href="https://github.com/anbai-inc/Kibana_Hanization" target="_blank" rel="noopener">https://github.com/anbai-inc/Kibana_Hanization</a></strong></p><p><strong>启动kibana 前提是es已经是启动状态，否则会报错，进入安装目录下的bin 运行kibana .bat</strong>  如下启动成功<br><img src="https://img-blog.csdnimg.cn/20200520101022542.png" alt="在这里插入图片描述"></p><p>访问默认端口5601 成功</p><p><img src="https://img-blog.csdnimg.cn/20200520101035153.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="安装ik分词器"><a href="#安装ik分词器" class="headerlink" title="安装ik分词器"></a>安装ik分词器</h4><p><strong>下载地址：<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases" target="_blank" rel="noopener">ik分词器下载</a> 版本选择6.3.0</strong></p><p>下载解压到es安装目录下的plugins 新建一个ik文件夹</p><p>重新启动es kibana </p><p>es启动过程中出现 表示插件加载成功</p><p><img src="https://img-blog.csdnimg.cn/20200520101049775.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="springboot-整合es"><a href="#springboot-整合es" class="headerlink" title="springboot 整合es"></a>springboot 整合es</h4><pre><code>springboot版本2.1.5</code></pre><p>注意版本冲突 springboot2.1.5 支持的es版本es和kibana版本不对连接不上</p><p><img src="https://img-blog.csdnimg.cn/20200520101108212.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><ol><li>es依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>版本如下</li></ol><p><img src="https://img-blog.csdnimg.cn/20200520101124229.png" alt="在这里插入图片描述"></p><ol start="3"><li><p>配置类</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定默认集群名和ip端口</span></span><br><span class="line"><span class="meta">spring.data.elasticsearch.cluster-name</span>=<span class="string">elasticsearch</span></span><br><span class="line"><span class="meta">spring.data.elasticsearch.cluster-nodes</span>=<span class="string">127.0.0.1:9300</span></span><br></pre></td></tr></table></figure></li><li><p>新建实体类</p><p>@Doucument 进行数据存储的基本单元 以json格式存储的记录，indexName 指定创建存储的索引名</p><p>@Mapping 指定resources下面的json文件 来定义分词规则</p><p>@Id 一定要加在主键上</p><p>@Field 指定分词器的名称，只配置了ik分词器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Document</span>(indexName = <span class="string">"testmapping"</span>)</span><br><span class="line"><span class="meta">@Mapping</span>(mappingPath = <span class="string">"course_mapping.json"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"课程id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"课程名"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//analyzer：分词器名称</span></span><br><span class="line">    <span class="comment">//ik_max_word：会将文本做最细粒度的拆分</span></span><br><span class="line">    <span class="comment">//ik_smart：会将文本做最粗粒度的拆分</span></span><br><span class="line">    <span class="meta">@Field</span>(analyzer = <span class="string">"ik_max_word"</span>, searchAnalyzer = <span class="string">"ik_max_word"</span>, type = FieldType.Text)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"教师id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer teacherId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在resources下面建立指定的json文件</p><p>在需要分词的属性下加上 analyzer和search_analyzer 并指定分词格式</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"demo"</span>: &#123;</span><br><span class="line">    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">      <span class="attr">"cid"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"name"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">        <span class="attr">"search_analyzer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"teacherId"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>存储优化分词</strong>，就是将ElasticSearch文档中字段值按照一定的切分规则分为多个待匹配靶点，只有搜索关键词命中其中的靶点才会将该字段值对应的文档放在返回结果中。</p></li></ol><p>   <strong>检索优化分词</strong>，就是将用户输入的搜索关键词按照一定的切分规则分为多个靶点，然后根据这些靶点去匹配ElasticSearch中的所有待匹配靶点。根据这些靶点的匹配程度，ElasticSearch会计算得分，根据匹配度即得分情况从高到底返回搜索结果。如果一个靶点都没有匹配上，得分为0即不返回任何结果。</p><p>   <strong>以”中华人民共和国国歌”为例，ik分词的两种分词规则的效果如下：</strong></p><ul><li><code>ik_max_word</code>分词效果：“中华”，“中华人民”，“中华人民共和国”，“人民”，“人民共和国”，“共和”，“共和国”，“华人”，“国”，“国歌”。</li><li><code>ik_smart</code>分词效果：“中华人民共和国”，“国歌”。</li></ul><p>   <strong>上面的具体分词效果可以在kibana中查看</strong></p>   <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST testmapping/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"field"</span>: <span class="string">"name"</span>,</span><br><span class="line">  <span class="attr">"text"</span>: <span class="string">"中华人民共和国国歌"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520101151801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><ol start="6"><li><p>编写接口继承ElasticsearchRepository&lt;T, T&gt;传入实体类、主键类型，就可以调用封装的方法</p></li><li><p>编写自己的测试类</p><ol><li><p>第一步创建索引</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ElasticsearchTemplate template;</span><br><span class="line"><span class="comment">//通过template</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// createIndex 创建索引</span></span><br><span class="line">template.createIndex(T<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置索引对应字段的分词规则(根据***.json中的设置开始生效)</span></span><br><span class="line">template.putMapping(T<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure></li><li><p>增</p><p>通过刚刚的继承了ElasticsearchRepository的接口调用方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span>.<span class="title">saveAll</span>(<span class="title">Iterable</span>&lt;? <span class="keyword">extends</span> <span class="title">T</span>&gt; <span class="title">entities</span>)</span></span><br><span class="line"><span class="class"><span class="title">interface</span>.<span class="title">save</span>(<span class="title">S</span> <span class="title">entity</span>)</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520101224886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li></ol></li></ol><ol start="3"><li><p>删</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">deleteById(ID id)</span><br><span class="line">delete(T entity)</span><br><span class="line">deleteAll(Iterable&lt;? extends T&gt; entities)</span><br><span class="line">deleteAll()</span><br><span class="line">    </span><br><span class="line"><span class="comment">//删除索引</span></span><br><span class="line"> template.deleteIndex(T<span class="class">.<span class="keyword">class</span>)</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520101209408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>查</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">findById(Id id)</span><br><span class="line"></span><br><span class="line">existsById(ID id);</span><br><span class="line"></span><br><span class="line">findAll();</span><br><span class="line"></span><br><span class="line">findAllById(Iterable&lt;ID&gt; ids);</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>混合分页排序查询<br>混合搜索指模糊，单个字段查询，匹配所有的，多个字段匹配某一个值，可以设置权重<br>权重官方解释：<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/query-time-boosting.html" target="_blank" rel="noopener">权重解释</a></p><pre><code>权重就影响上面提到的匹配度，分数：查询时的权重提升 是可以用来影响相关度的主要工具，任意类型的查询都能接受 boost 参数。将 boost 设置为 2 ，并不代表最终的评分 _score 是原值的两倍；实际的权重值会经过归一化和一些其他内部优化过程。尽管如此，它确实想要表明一个提升值为 2 的句子的重要性是提升值为 1 语句的两倍。</code></pre><p>在实际应用中，无法通过简单的公式得出某个特定查询语句的 “正确” 权重提升值，只能通过不断尝试获得。需要记住的是 boost 只是影响相关度评分的其中一个因子；它还需要与其他因子相互竞争。选择权重，检查结果，如此反复。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//混合查询使用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* matchQuery       : 单个字段查询</span></span><br><span class="line"><span class="comment">* matchAllQuery    : 匹配所有</span></span><br><span class="line"><span class="comment">* multiMatchQuery  : 多个字段匹配某一个值</span></span><br><span class="line"><span class="comment">* wildcardQuery    : 模糊查询</span></span><br><span class="line"><span class="comment">* boost            : 设置权重,数值越大权重越大</span></span><br><span class="line"><span class="comment">**/</span>  </span><br><span class="line"><span class="comment">//        下面可以多个选择</span></span><br><span class="line">        DisMaxQueryBuilder disMaxQueryBuilder = QueryBuilders.disMaxQuery();</span><br><span class="line"><span class="comment">//        单个字段查询</span></span><br><span class="line">        QueryBuilder matchQueryBuilder = QueryBuilders.matchQuery(<span class="string">"cname"</span>,reqQueryDto.getCname().toLowerCase());</span><br><span class="line"><span class="comment">//         wildcardQuery    : 模糊查询</span></span><br><span class="line">        QueryBuilder wildcardCodeQuery = QueryBuilders.wildcardQuery(<span class="string">"cname"</span>, reqQueryDto.getCname().toLowerCase());</span><br><span class="line"></span><br><span class="line">        disMaxQueryBuilder.add(wildcardCodeQuery).add(matchQueryBuilder);</span><br><span class="line">        SearchQuery searchQuery = <span class="keyword">new</span> NativeSearchQueryBuilder()</span><br><span class="line"><span class="comment">//                指定查询方式</span></span><br><span class="line">                .withQuery(disMaxQueryBuilder)</span><br><span class="line"><span class="comment">//                分页</span></span><br><span class="line">                .withPageable(PageRequest.of(reqQueryDto.getPage(), reqQueryDto.getSize()))</span><br><span class="line"><span class="comment">//                排序规则</span></span><br><span class="line">                .withSort(SortBuilders.fieldSort(<span class="string">"cid"</span>).order(SortOrder.DESC))</span><br><span class="line">                .build();</span><br><span class="line">        Page&lt;Course&gt; search = courseInterface.search(searchQuery);</span><br></pre></td></tr></table></figure></li></ol><!-- toc --><p>搭建环境如下：</p><ol><li>springboot 2.1.5  </li><li>elasticsearch 版本6.3.0</li><li>kibana 版本6.3.0</li><li>IK Analyzer for Elasticsearch 版本 6.3.0</li><li>如需设置账户密码登录要购买es的商业版</li><li>jdk1.8</li></ol><h4 id="安装elasticsearch6-3-0-1"><a href="#安装elasticsearch6-3-0-1" class="headerlink" title="安装elasticsearch6.3.0"></a>安装elasticsearch6.3.0</h4><p>下载地址：<a href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch" target="_blank" rel="noopener">es6.3.0</a></p><p>下载安装解压后就可以</p><p><strong>启动es 进入安装目录下的bin 运行elasticsearch.bat</strong> 出现如下表示启动成功<br><img src="https://img-blog.csdnimg.cn/20200520100918460.png" alt="在这里插入图片描述"><br>在浏览器中访问默认的端口号 9200 </p><p><img src="https://img-blog.csdnimg.cn/20200520100937208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>以下步骤根据<strong>个人需求</strong> 可以将es安装成windows的服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">安装服务</span><br><span class="line">elasticsearch-service.bat install</span><br><span class="line"></span><br><span class="line">删除已安装的es服务</span><br><span class="line">elasticsearch-service.bat remove</span><br><span class="line"></span><br><span class="line">启动es服务</span><br><span class="line">elasticsearch-service.bat start</span><br><span class="line"></span><br><span class="line">停止服务</span><br><span class="line">elasticsearch-service.bat stop</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520100958669.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="安装kibana6-3-0-1"><a href="#安装kibana6-3-0-1" class="headerlink" title="安装kibana6.3.0"></a>安装kibana6.3.0</h4><p>下载地址:<a href="https://www.elastic.co/cn/downloads/past-releases#kibana" target="_blank" rel="noopener">kibana下载</a></p><p>下载安装解压</p><p><strong>由于是6.X版本不支持修改配置文件来汉化，而且汉化过程不可逆，所以根据个人需求进行汉化</strong></p><p><strong>汉化地址：<a href="https://github.com/anbai-inc/Kibana_Hanization" target="_blank" rel="noopener">https://github.com/anbai-inc/Kibana_Hanization</a></strong></p><p><strong>启动kibana 前提是es已经是启动状态，否则会报错，进入安装目录下的bin 运行kibana .bat</strong>  如下启动成功<br><img src="https://img-blog.csdnimg.cn/20200520101022542.png" alt="在这里插入图片描述"></p><p>访问默认端口5601 成功</p><p><img src="https://img-blog.csdnimg.cn/20200520101035153.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h4 id="安装ik分词器-1"><a href="#安装ik分词器-1" class="headerlink" title="安装ik分词器"></a>安装ik分词器</h4><p><strong>下载地址：<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases" target="_blank" rel="noopener">ik分词器下载</a> 版本选择6.3.0</strong></p><p>下载解压到es安装目录下的plugins 新建一个ik文件夹</p><p>重新启动es kibana </p><p>es启动过程中出现 表示插件加载成功</p><p><img src="https://img-blog.csdnimg.cn/20200520101049775.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt=""></p><h4 id="springboot-整合es-1"><a href="#springboot-整合es-1" class="headerlink" title="springboot 整合es"></a>springboot 整合es</h4><pre><code>springboot版本2.1.5</code></pre><p>注意版本冲突 springboot2.1.5 支持的es版本es和kibana版本不对连接不上</p><p><img src="https://img-blog.csdnimg.cn/20200520101108212.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt=""></p><ol><li>es依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>版本如下</li></ol><p><img src="https://img-blog.csdnimg.cn/20200520101124229.png" alt="在这里插入图片描述"></p><ol start="3"><li><p>配置类</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定默认集群名和ip端口</span></span><br><span class="line"><span class="meta">spring.data.elasticsearch.cluster-name</span>=<span class="string">elasticsearch</span></span><br><span class="line"><span class="meta">spring.data.elasticsearch.cluster-nodes</span>=<span class="string">127.0.0.1:9300</span></span><br></pre></td></tr></table></figure></li><li><p>新建实体类</p><p>@Doucument 进行数据存储的基本单元 以json格式存储的记录，indexName 指定创建存储的索引名</p><p>@Mapping 指定resources下面的json文件 来定义分词规则</p><p>@Id 一定要加在主键上</p><p>@Field 指定分词器的名称，只配置了ik分词器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Document</span>(indexName = <span class="string">"testmapping"</span>)</span><br><span class="line"><span class="meta">@Mapping</span>(mappingPath = <span class="string">"course_mapping.json"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"课程id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer cid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"课程名"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//analyzer：分词器名称</span></span><br><span class="line">    <span class="comment">//ik_max_word：会将文本做最细粒度的拆分</span></span><br><span class="line">    <span class="comment">//ik_smart：会将文本做最粗粒度的拆分</span></span><br><span class="line">    <span class="meta">@Field</span>(analyzer = <span class="string">"ik_max_word"</span>, searchAnalyzer = <span class="string">"ik_max_word"</span>, type = FieldType.Text)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty</span>(<span class="string">"教师id"</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer teacherId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在resources下面建立指定的json文件</p><p>在需要分词的属性下加上 analyzer和search_analyzer 并指定分词格式</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"demo"</span>: &#123;</span><br><span class="line">    <span class="attr">"properties"</span>: &#123;</span><br><span class="line">      <span class="attr">"cid"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"name"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"text"</span>,</span><br><span class="line">        <span class="attr">"analyzer"</span>: <span class="string">"ik_max_word"</span>,</span><br><span class="line">        <span class="attr">"search_analyzer"</span>: <span class="string">"ik_max_word"</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"teacherId"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"long"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>存储优化分词</strong>，就是将ElasticSearch文档中字段值按照一定的切分规则分为多个待匹配靶点，只有搜索关键词命中其中的靶点才会将该字段值对应的文档放在返回结果中。</p></li></ol><p>   <strong>检索优化分词</strong>，就是将用户输入的搜索关键词按照一定的切分规则分为多个靶点，然后根据这些靶点去匹配ElasticSearch中的所有待匹配靶点。根据这些靶点的匹配程度，ElasticSearch会计算得分，根据匹配度即得分情况从高到底返回搜索结果。如果一个靶点都没有匹配上，得分为0即不返回任何结果。</p><p>   <strong>以”中华人民共和国国歌”为例，ik分词的两种分词规则的效果如下：</strong></p><ul><li><code>ik_max_word</code>分词效果：“中华”，“中华人民”，“中华人民共和国”，“人民”，“人民共和国”，“共和”，“共和国”，“华人”，“国”，“国歌”。</li><li><code>ik_smart</code>分词效果：“中华人民共和国”，“国歌”。</li></ul><p>   <strong>上面的具体分词效果可以在kibana中查看</strong></p>   <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST testmapping/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"field"</span>: <span class="string">"name"</span>,</span><br><span class="line">  <span class="attr">"text"</span>: <span class="string">"中华人民共和国国歌"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520101151801.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt=""></p><ol start="6"><li><p>编写接口继承ElasticsearchRepository&lt;T, T&gt;传入实体类、主键类型，就可以调用封装的方法</p></li><li><p>编写自己的测试类</p><ol><li><p>第一步创建索引</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ElasticsearchTemplate template;</span><br><span class="line"><span class="comment">//通过template</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// createIndex 创建索引</span></span><br><span class="line">template.createIndex(T<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置索引对应字段的分词规则(根据***.json中的设置开始生效)</span></span><br><span class="line">template.putMapping(T<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure></li><li><p>增</p><p>通过刚刚的继承了ElasticsearchRepository的接口调用方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span>.<span class="title">saveAll</span>(<span class="title">Iterable</span>&lt;? <span class="keyword">extends</span> <span class="title">T</span>&gt; <span class="title">entities</span>)</span></span><br><span class="line"><span class="class"><span class="title">interface</span>.<span class="title">save</span>(<span class="title">S</span> <span class="title">entity</span>)</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520101224886.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li></ol></li></ol><ol start="3"><li><p>删</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">deleteById(ID id)</span><br><span class="line">delete(T entity)</span><br><span class="line">deleteAll(Iterable&lt;? extends T&gt; entities)</span><br><span class="line">deleteAll()</span><br><span class="line">    </span><br><span class="line"><span class="comment">//删除索引</span></span><br><span class="line"> template.deleteIndex(T<span class="class">.<span class="keyword">class</span>)</span></span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20200520101209408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p></li><li><p>查</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">findById(Id id)</span><br><span class="line"></span><br><span class="line">existsById(ID id);</span><br><span class="line"></span><br><span class="line">findAll();</span><br><span class="line"></span><br><span class="line">findAllById(Iterable&lt;ID&gt; ids);</span><br></pre></td></tr></table></figure></li></ol><ol start="5"><li><p>混合分页排序查询<br>混合搜索指模糊，单个字段查询，匹配所有的，多个字段匹配某一个值，可以设置权重<br>权重官方解释：<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/query-time-boosting.html" target="_blank" rel="noopener">权重解释</a></p><pre><code>权重就影响上面提到的匹配度，分数：查询时的权重提升 是可以用来影响相关度的主要工具，任意类型的查询都能接受 boost 参数。将 boost 设置为 2 ，并不代表最终的评分 _score 是原值的两倍；实际的权重值会经过归一化和一些其他内部优化过程。尽管如此，它确实想要表明一个提升值为 2 的句子的重要性是提升值为 1 语句的两倍。</code></pre><p>在实际应用中，无法通过简单的公式得出某个特定查询语句的 “正确” 权重提升值，只能通过不断尝试获得。需要记住的是 boost 只是影响相关度评分的其中一个因子；它还需要与其他因子相互竞争。选择权重，检查结果，如此反复。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//混合查询使用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* matchQuery       : 单个字段查询</span></span><br><span class="line"><span class="comment">* matchAllQuery    : 匹配所有</span></span><br><span class="line"><span class="comment">* multiMatchQuery  : 多个字段匹配某一个值</span></span><br><span class="line"><span class="comment">* wildcardQuery    : 模糊查询</span></span><br><span class="line"><span class="comment">* boost            : 设置权重,数值越大权重越大</span></span><br><span class="line"><span class="comment">**/</span>  </span><br><span class="line"><span class="comment">//        下面可以多个选择</span></span><br><span class="line">        DisMaxQueryBuilder disMaxQueryBuilder = QueryBuilders.disMaxQuery();</span><br><span class="line"><span class="comment">//        单个字段查询</span></span><br><span class="line">        QueryBuilder matchQueryBuilder = QueryBuilders.matchQuery(<span class="string">"cname"</span>,reqQueryDto.getCname().toLowerCase());</span><br><span class="line"><span class="comment">//         wildcardQuery    : 模糊查询</span></span><br><span class="line">        QueryBuilder wildcardCodeQuery = QueryBuilders.wildcardQuery(<span class="string">"cname"</span>, reqQueryDto.getCname().toLowerCase());</span><br><span class="line"></span><br><span class="line">        disMaxQueryBuilder.add(wildcardCodeQuery).add(matchQueryBuilder);</span><br><span class="line">        SearchQuery searchQuery = <span class="keyword">new</span> NativeSearchQueryBuilder()</span><br><span class="line"><span class="comment">//                指定查询方式</span></span><br><span class="line">                .withQuery(disMaxQueryBuilder)</span><br><span class="line"><span class="comment">//                分页</span></span><br><span class="line">                .withPageable(PageRequest.of(reqQueryDto.getPage(), reqQueryDto.getSize()))</span><br><span class="line"><span class="comment">//                排序规则</span></span><br><span class="line">                .withSort(SortBuilders.fieldSort(<span class="string">"cid"</span>).order(SortOrder.DESC))</span><br><span class="line">                .build();</span><br><span class="line">        Page&lt;Course&gt; search = courseInterface.search(searchQuery);</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">springboot 2.1.5 整合es6.3.0</summary>
    
    
    
    <category term="elasticsearch" scheme="https://floatinghua.github.io/categories/elasticsearch/"/>
    
    
    <category term="整合" scheme="https://floatinghua.github.io/tags/%E6%95%B4%E5%90%88/"/>
    
    <category term="elasticsearch" scheme="https://floatinghua.github.io/tags/elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>初识spring</title>
    <link href="https://floatinghua.github.io/2020/07/01/%E5%88%9D%E8%AF%86spring/"/>
    <id>https://floatinghua.github.io/2020/07/01/%E5%88%9D%E8%AF%86spring/</id>
    <published>2020-07-01T03:35:38.000Z</published>
    <updated>2020-09-08T06:39:44.744Z</updated>
    
    <content type="html"><![CDATA[<h2 id="什么是框架"><a href="#什么是框架" class="headerlink" title="什么是框架?"></a>什么是框架?</h2><p>在特定的领域将总结的最佳实践编写成固定流程，帮助我们更加高效，更为健壮的编写。</p><ol><li><strong>总结的最佳实践</strong> ，这就表明框架已经是完成了一些特定的功能，自己已经实现了一些功能，不同的框架完成了不同的功能；</li><li><strong>固定流程</strong>，说明框架本身是有一套流程，需要实现的功能按照其流程来，就能达到效果。</li><li><strong>帮助我们</strong>，框架本身是不会运行点，在框架的帮助下，配合其他的程序，框架就能有效的帮助我们省去很多步骤，直接调用其本身，来达到功能的实现。<br><img src="https://img-blog.csdnimg.cn/20191102104307835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="框架与程序员的关系"></li></ol><h2 id="Spring概诉"><a href="#Spring概诉" class="headerlink" title="Spring概诉"></a>Spring概诉</h2><p>Spring 是最受欢迎的企业级 Java 应用程序开发框架，数以百万的来自世界各地的开发人员使用 Spring 框架来创建性能好、易于测试、可重用的代码。</p><p>Spring 框架是一个开源的 Java 平台，它最初是由 Rod Johnson 编写的，并且于 2003 年 6 月首次在 Apache 2.0 许可下发布。</p><p>Spring 是轻量级的框架，其基础版本只有 2 MB 左右的大小。</p><p>Spring 框架的核心特性是可以用于开发任何 Java 应用程序，但是在 Java EE 平台上构建 web 应用程序是需要扩展的。 Spring 框架的目标是使 J2EE 开发变得更容易使用，通过启用基于 POJO 编程模型来促进良好的编程实践。</p><p><strong>Spring的核心是控制反转（IoC）和面向切面（AOP）。</strong><br><strong>简单来说，Spring是一个分层的JavaSE/EEfull-stack（一站式）轻量级开源框架。</strong></p><p><del>上面的干货是不是很枯燥，那我们看下Spring</del>   ==集成的模块==</p><h2 id="Spring集成的模块"><a href="#Spring集成的模块" class="headerlink" title="Spring集成的模块"></a>Spring集成的模块</h2><p><img src="https://img-blog.csdnimg.cn/20191102105609500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="Spring集成模块"><br>1 <strong>核心容器</strong></p><ul><li>Spring-beans:IoC的实现，配置文件的访问、创建和管理；</li><li>Spring-core：核心工具包；</li><li>Spring-context：封装IoC容器，提供扩展功能；</li><li>SpEL:Spring的表达式支持</li></ul><p>2.<strong>基础服务</strong></p><ul><li>AOP：面向切面编程的支持；</li><li>Aspect：模块提供了与 AspectJ 的集成，这是一个功能强大且成熟的面向切面编程（AOP）框架；</li><li>Instrumentation：字节码操作；</li><li>Messaging：对消息服务的支持</li></ul><p>3.<strong>功能</strong></p><ul><li>transactions:对事务的支持；</li><li>JDBC:Spring对JDBC的封装；</li><li>ORM：Spring对ORM的封装</li></ul><p>4.<strong>WEB</strong></p><ul><li><p>Web 模块提供面向web的基本功能和面向web的应用上下文，比如多部分（multipart）文件上传功能、使用Servlet监听器初始化IoC容器等。它还包括HTTP客户端以及Spring远程调用中与web相关的部分。。</p></li><li><p>Web-MVC 模块为web应用提供了模型视图控制（MVC）和REST Web服务的实现。Spring的MVC框架可以使领域模型代码和web表单完全地分离，且可以与Spring框架的其它所有功能进行集成。</p></li><li><p>Web-Socket 模块为 WebSocket-based 提供了支持，而且在 web 应用程序中提供了客户端和服务器端之间通信的两种方式。</p></li><li><p>Web-Portlet 模块提供了用于Portlet环境的MVC实现，并反映了spring-webmvc模块的功能。</p></li></ul><h2 id="Spring的核心理念——IoC容器"><a href="#Spring的核心理念——IoC容器" class="headerlink" title="Spring的核心理念——IoC容器"></a>Spring的核心理念——IoC容器</h2><p>在讲解IoC的时候我们先来回想，之前写MVC三层的时候<br><img src="https://img-blog.csdnimg.cn/20191102113512328.png" alt="之前的MVC三层控制权"><br>IoC:Inversion of Control 控制反转，通俗一点就是控制权由调用的类，转为Spring容器，由Spring容器来==创建实例以及依赖注入==。<br><img src="https://img-blog.csdnimg.cn/20191103104511324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="控制反转"></p><h3 id="Bean的四种实例化"><a href="#Bean的四种实例化" class="headerlink" title="Bean的四种实例化"></a>Bean的四种实例化</h3><p>首先你需要在xml中来，配置bean。</p><ol><li>默认使用的bean就是用的无参构造<br>其中id就表示这个bean的名字，class就是你要创建这个实例的class<br>– <code>&lt;bean id=&quot;userDao&quot; class=&quot;com.demo.dao.UserDaoImpl&quot;/&gt;</code></li><li>静态工厂方法实例化<br>这就运用到一个类中的一个静态方法，这个静态方法get就是用来返回bean的实例<br>– <code>&lt;bean id=&quot;userDao&quot; factory-method=&quot;get&quot;class=&quot;com.UserDaoFactory/&gt;</code></li><li>工厂bean的实例化<br>这个方法就用到了工厂模式，这个工厂的方法get用来生产这个bean的实例<br>– <code>&lt;bean id=&quot;userDaoFactory&quot; class=&quot;com.factory.user.UserDaoFactory&quot;/&gt;    &lt;bean id=&quot;userDao&quot; factory-bean=&quot;userDaoFactory&quot; factory-method=&quot;get&quot;/&gt;</code></li><li>Spring的factorybean接口<br>使用这种方式就是要类已经实现了FactoryBean的接口，然后重写了方法<br><img src="https://img-blog.csdnimg.cn/20191103110313725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>– <code>&lt;bean id=&quot;car&quot; class=&quot;com.demo.dao.CarFactory&quot;/&gt;</code></li></ol><h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>依赖注入Spring也给我提供了两种方式</p><ol><li>setter注入<br>– 这个方式就是说，你要实例化的对象，必须要有setter方法来设置，然后才能才bean中进行依赖注入</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.demo.service.UserServiceImpl/&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;bean id="</span><span class="attr">userController</span>" <span class="attr">class</span>=<span class="string">"com.demo.controller.UserController"</span>&gt;</span></span><br><span class="line">//这里的name其实就是调用的setter方法</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userService"</span> <span class="attr">ref</span>=<span class="string">"userService"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//当然你想注入其他类型的时候也是可以的</span><br><span class="line">//value 注入基本类型</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">"12"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//list 存放基本类型注入list </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//map集合</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>构造器注入<br><img src="https://img-blog.csdnimg.cn/20191103111839165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="构造器注入"><br>==看完了这些实例化和依赖注入，再来看看怎么使用吧==<br><img src="https://img-blog.csdnimg.cn/201911031120165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="容器的使用"><br><strong>其中一般来说全局就一个spring容器</strong></li></ol><h3 id="bean的作用域范围"><a href="#bean的作用域范围" class="headerlink" title="bean的作用域范围"></a>bean的作用域范围</h3><p>prototype    原 型 =&gt; 每次创建一个实例<br>singleton     单 例 =&gt;一个bean的定义，只有一个实例，不是之前那种单例 一个类只有一个<br>request        一个请求一个实例<br>session        一个会话一个实例<br>websocket    一次websocket链接一个实例</p><h3 id="bean的生命周期"><a href="#bean的生命周期" class="headerlink" title="bean的生命周期"></a>bean的生命周期</h3><p>声明周期两种方式：==只有单例有效果==</p><ol><li><p>自己写开始结束的方法<br>在bean的配置中，添加init-method=“初始化的方法”，destroy-method=“销毁的方法”</p></li><li><p>实现开始结束的接口 重写方法<br>在类上实现InitializingBean,DisposableBean 方法</p></li></ol><h2 id="IoC的配置"><a href="#IoC的配置" class="headerlink" title="IoC的配置"></a>IoC的配置</h2><h3 id="1-通过注解来配置IoC"><a href="#1-通过注解来配置IoC" class="headerlink" title="1. 通过注解来配置IoC"></a>1. 通过注解来配置IoC</h3><p>在XML中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"要扫描的注解的包路径“/&gt;</span></span></span><br></pre></td></tr></table></figure><p>==注解有==<br>@Controller<br>@Service<br>@Repository 这是dao的<br>@Autowired 自动依赖注入 就可以不用setter<br>@Component 不是上面三层的就统一用这个<br>@Value 注入基本数据类型 可以注入配置的值</p><p>作用域用：<br>@Scope（“propertype”）<br>生命周期<br>@PostConstruct  初始化的方法上加<br>@PreDestroy    摧毁的方法上加</p><p>==<strong>当你加了注解的时候，Spring会自动将类名第一个首字母小写作为bean的id，因为是加在类上，所以class也省略配置了</strong>==</p><h3 id="2-Java类配置IoC"><a href="#2-Java类配置IoC" class="headerlink" title="2.Java类配置IoC"></a>2.Java类配置IoC</h3><p><em>使用java类来代替XML</em></p><p><strong>@Configuration 用于标记一个类为配置类<br>@Bean  标记某个方法返回值为spring的bean<br>@ComponentScan（要扫描的包） 打开扫描包的注解</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserService <span class="title">userService</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        第一种推荐 @Bean就是来获得对象的 要注入信息就调用方法</span></span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserService();</span><br><span class="line">        userService.setUserDao(userDao());</span><br><span class="line">        <span class="keyword">return</span> userService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserDao();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserController <span class="title">userController</span><span class="params">(UserService userService)</span></span>&#123;</span><br><span class="line"><span class="comment">//        第二种 通过传入参数 spring自己找对应的bean</span></span><br><span class="line">        UserController userController=<span class="keyword">new</span> UserController();</span><br><span class="line">        userController.setUserService(userService);</span><br><span class="line">        <span class="keyword">return</span> userController;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//   获得DruidDataSource</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">druidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DruidDataSource dds = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line"><span class="comment">//        设置每个属性</span></span><br><span class="line">        dds.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        dds.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dds.setPassword(<span class="string">"root123"</span>);</span><br><span class="line">        dds.setUrl(<span class="string">"jdbc:mysql://localhost:3306/demo);</span></span><br><span class="line"><span class="string">        return  dds;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    @Bean</span></span><br><span class="line"><span class="string">    public QueryRunner queryRunner()&#123;</span></span><br><span class="line"><span class="string">//        指定druidDataSource当然也可以不指定 让spring自己去找</span></span><br><span class="line"><span class="string">        QueryRunner qr = new QueryRunner(druidDataSource());</span></span><br><span class="line"><span class="string">        return qr;</span></span><br><span class="line"><span class="string">    &#125;   </span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"DataBase.properties"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;driverClassName&#125;"</span>)</span><br><span class="line">String driverClassName;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;url&#125;"</span>)</span><br><span class="line">String url;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;username&#125;"</span>)</span><br><span class="line">String username;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;password&#125;"</span>)</span><br><span class="line">String password;</span><br></pre></td></tr></table></figure><p><strong>在使用的时候就得使用下面的进行调用了</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfigScan<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure><p>@ComponentScan（要扫描的包） 打开扫描包的注解等价于<br>&lt;context:component-scan base-package=”xxx”&gt;</p><p> 这个时候就要用 @Controller @Service 直接生成bean 就不用自己@Bean来生成bean</p><h3 id="多种的混用"><a href="#多种的混用" class="headerlink" title="多种的混用"></a>多种的混用</h3><p>在注解类上可以使用@Import（.class）导入Java配置  用@ImportResource(.xml)导入Xml的配置</p><p>==讲了这么久 讲讲IoC的优势==</p><h3 id="IoC优势"><a href="#IoC优势" class="headerlink" title="IoC优势"></a>IoC优势</h3><ol><li>解耦合 （一个类跟一个类的关系就是耦合度）  降低了类与类之间的耦合度</li><li>提升了代码的灵活性，可维护性。因为一个类可能有多个实现，当不同需求的时候在xml中切换下就行</li></ol><h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><p>OOP：这是刚开始学Java就学的面相对象编程<br>今天讨论的是AOP：Aspect Oritented Programming</p><p>AOP：面相切面编程——为了解决公共、系统的问题</p><p><strong>那么哪些是属于公共、系统的问题呢？</strong><br>    比如打印日志，打印参数调用，执行时间，事务管理，安全验证…….</p><p>了解了这些，我们来看下AOP中的名词</p><h3 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h3><p><strong>连接点</strong>：    JoinPoint     需要加入功能的位置(通常是方法)</p><p><strong>切入点</strong>：    Pointcut     真正执行加入功能的连接点，从连接点中选出需要加入功能的连接点</p><p><strong>通知</strong>：        Advice         需要实现的功能</p><p><strong>切面</strong>：        Aspect         Java语言中将切入点和通知组装在一起的代码单元</p><p><strong>目标对象</strong>：    Target         要操作的对象，方法（连接点）所在的对象</p><p><strong>织入</strong>：        Weave         将功能加入到切入点中的过程</p><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><h4 id="配置方式1（较为麻烦）"><a href="#配置方式1（较为麻烦）" class="headerlink" title="配置方式1（较为麻烦）"></a>配置方式1（较为麻烦）</h4><ol><li>编写service类<ol start="2"><li>编写通知  ， 实现MethodBeforeAdvice接口（等下详细讲通知）</li><li>配置xml</li></ol></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置目标对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.spring.aop.service.impl.UserServiceImpl"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置通知: 实现了打日志的功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beforeExecution"</span> <span class="attr">class</span>=<span class="string">"com.spring.aop.component.BeforeExecution"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--切入点：写到需要增加功能的方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pointCut"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">"com.spring.aop.service.impl.UserServiceImpl.addUser"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--切面：连接切入点和通知，让打日志功能在切入点的位置执行--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspect"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.DefaultPointcutAdvisor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pointcut"</span> <span class="attr">ref</span>=<span class="string">"pointCut"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"advice"</span> <span class="attr">ref</span>=<span class="string">"beforeExecution"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--包装userService--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置方式2-aop：config"><a href="#配置方式2-aop：config" class="headerlink" title="配置方式2 aop：config"></a>配置方式2 aop：config</h4><p>非环绕式的通知</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置通知--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"tx"</span> <span class="attr">class</span>=<span class="string">"com.demo.Trans"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置切面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"tx"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置切入点--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"servicePointcut"</span> <span class="attr">expression</span>=<span class="string">"executon(* com.demo.aop.*.*(..)"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--前置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"begin"</span> <span class="attr">pointcut-ref</span>=<span class="string">"servicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--后--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"begin"</span> <span class="attr">pointcut-ref</span>=<span class="string">"servicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>expression语法：转载 <a href="https://zhuanlan.zhihu.com/p/63001123" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/63001123</a><br>环绕式通知，就只需要一个就够了<br><img src="https://img-blog.csdnimg.cn/20191103122312880.png" alt="在这里插入图片描述"></p><h4 id="注解式配置"><a href="#注解式配置" class="headerlink" title="注解式配置"></a>注解式配置</h4><p><img src="https://img-blog.csdnimg.cn/20191103122444263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>注解式的配置切面就如下的配置</strong>：<br>@Aspect  切面<br>@Pointcut    切入点<br>@Around     环绕式<br>@Before     前置<br>@After     后置<br>@AfterThrowing     抛出异常<br>@EnableAspectJAutoProxy  自动扫包等价于aop:aspectj-autoproxy<!-- toc --></p><h2 id="什么是框架-1"><a href="#什么是框架-1" class="headerlink" title="什么是框架?"></a>什么是框架?</h2><p>在特定的领域将总结的最佳实践编写成固定流程，帮助我们更加高效，更为健壮的编写。</p><ol><li><strong>总结的最佳实践</strong> ，这就表明框架已经是完成了一些特定的功能，自己已经实现了一些功能，不同的框架完成了不同的功能；</li><li><strong>固定流程</strong>，说明框架本身是有一套流程，需要实现的功能按照其流程来，就能达到效果。</li><li><strong>帮助我们</strong>，框架本身是不会运行点，在框架的帮助下，配合其他的程序，框架就能有效的帮助我们省去很多步骤，直接调用其本身，来达到功能的实现。<br><img src="https://img-blog.csdnimg.cn/20191102104307835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="框架与程序员的关系"></li></ol><h2 id="Spring概诉-1"><a href="#Spring概诉-1" class="headerlink" title="Spring概诉"></a>Spring概诉</h2><p>Spring 是最受欢迎的企业级 Java 应用程序开发框架，数以百万的来自世界各地的开发人员使用 Spring 框架来创建性能好、易于测试、可重用的代码。</p><p>Spring 框架是一个开源的 Java 平台，它最初是由 Rod Johnson 编写的，并且于 2003 年 6 月首次在 Apache 2.0 许可下发布。</p><p>Spring 是轻量级的框架，其基础版本只有 2 MB 左右的大小。</p><p>Spring 框架的核心特性是可以用于开发任何 Java 应用程序，但是在 Java EE 平台上构建 web 应用程序是需要扩展的。 Spring 框架的目标是使 J2EE 开发变得更容易使用，通过启用基于 POJO 编程模型来促进良好的编程实践。</p><p><strong>Spring的核心是控制反转（IoC）和面向切面（AOP）。</strong><br><strong>简单来说，Spring是一个分层的JavaSE/EEfull-stack（一站式）轻量级开源框架。</strong></p><p><del>上面的干货是不是很枯燥，那我们看下Spring</del>   ==集成的模块==</p><h2 id="Spring集成的模块-1"><a href="#Spring集成的模块-1" class="headerlink" title="Spring集成的模块"></a>Spring集成的模块</h2><p><img src="https://img-blog.csdnimg.cn/20191102105609500.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="Spring集成模块"><br>1 <strong>核心容器</strong></p><ul><li>Spring-beans:IoC的实现，配置文件的访问、创建和管理；</li><li>Spring-core：核心工具包；</li><li>Spring-context：封装IoC容器，提供扩展功能；</li><li>SpEL:Spring的表达式支持</li></ul><p>2.<strong>基础服务</strong></p><ul><li>AOP：面向切面编程的支持；</li><li>Aspect：模块提供了与 AspectJ 的集成，这是一个功能强大且成熟的面向切面编程（AOP）框架；</li><li>Instrumentation：字节码操作；</li><li>Messaging：对消息服务的支持</li></ul><p>3.<strong>功能</strong></p><ul><li>transactions:对事务的支持；</li><li>JDBC:Spring对JDBC的封装；</li><li>ORM：Spring对ORM的封装</li></ul><p>4.<strong>WEB</strong></p><ul><li><p>Web 模块提供面向web的基本功能和面向web的应用上下文，比如多部分（multipart）文件上传功能、使用Servlet监听器初始化IoC容器等。它还包括HTTP客户端以及Spring远程调用中与web相关的部分。。</p></li><li><p>Web-MVC 模块为web应用提供了模型视图控制（MVC）和REST Web服务的实现。Spring的MVC框架可以使领域模型代码和web表单完全地分离，且可以与Spring框架的其它所有功能进行集成。</p></li><li><p>Web-Socket 模块为 WebSocket-based 提供了支持，而且在 web 应用程序中提供了客户端和服务器端之间通信的两种方式。</p></li><li><p>Web-Portlet 模块提供了用于Portlet环境的MVC实现，并反映了spring-webmvc模块的功能。</p></li></ul><h2 id="Spring的核心理念——IoC容器-1"><a href="#Spring的核心理念——IoC容器-1" class="headerlink" title="Spring的核心理念——IoC容器"></a>Spring的核心理念——IoC容器</h2><p>在讲解IoC的时候我们先来回想，之前写MVC三层的时候<br><img src="https://img-blog.csdnimg.cn/20191102113512328.png" alt="之前的MVC三层控制权"><br>IoC:Inversion of Control 控制反转，通俗一点就是控制权由调用的类，转为Spring容器，由Spring容器来==创建实例以及依赖注入==。<br><img src="https://img-blog.csdnimg.cn/20191103104511324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="控制反转"></p><h3 id="Bean的四种实例化-1"><a href="#Bean的四种实例化-1" class="headerlink" title="Bean的四种实例化"></a>Bean的四种实例化</h3><p>首先你需要在xml中来，配置bean。</p><ol><li>默认使用的bean就是用的无参构造<br>其中id就表示这个bean的名字，class就是你要创建这个实例的class<br>– <code>&lt;bean id=&quot;userDao&quot; class=&quot;com.demo.dao.UserDaoImpl&quot;/&gt;</code></li><li>静态工厂方法实例化<br>这就运用到一个类中的一个静态方法，这个静态方法get就是用来返回bean的实例<br>– <code>&lt;bean id=&quot;userDao&quot; factory-method=&quot;get&quot;class=&quot;com.UserDaoFactory/&gt;</code></li><li>工厂bean的实例化<br>这个方法就用到了工厂模式，这个工厂的方法get用来生产这个bean的实例<br>– <code>&lt;bean id=&quot;userDaoFactory&quot; class=&quot;com.factory.user.UserDaoFactory&quot;/&gt;    &lt;bean id=&quot;userDao&quot; factory-bean=&quot;userDaoFactory&quot; factory-method=&quot;get&quot;/&gt;</code></li><li>Spring的factorybean接口<br>使用这种方式就是要类已经实现了FactoryBean的接口，然后重写了方法<br><img src="https://img-blog.csdnimg.cn/20191103110313725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>– <code>&lt;bean id=&quot;car&quot; class=&quot;com.demo.dao.CarFactory&quot;/&gt;</code></li></ol><h3 id="依赖注入-1"><a href="#依赖注入-1" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>依赖注入Spring也给我提供了两种方式</p><ol><li>setter注入<br>– 这个方式就是说，你要实例化的对象，必须要有setter方法来设置，然后才能才bean中进行依赖注入</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.demo.service.UserServiceImpl/&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string"></span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;bean id="</span><span class="attr">userController</span>" <span class="attr">class</span>=<span class="string">"com.demo.controller.UserController"</span>&gt;</span></span><br><span class="line">//这里的name其实就是调用的setter方法</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userService"</span> <span class="attr">ref</span>=<span class="string">"userService"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//当然你想注入其他类型的时候也是可以的</span><br><span class="line">//value 注入基本类型</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">"12"</span>/&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//list 存放基本类型注入list </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//map集合</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>构造器注入<br><img src="https://img-blog.csdnimg.cn/20191103111839165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="构造器注入"><br>==看完了这些实例化和依赖注入，再来看看怎么使用吧==<br><img src="https://img-blog.csdnimg.cn/201911031120165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="容器的使用"><br><strong>其中一般来说全局就一个spring容器</strong></li></ol><h3 id="bean的作用域范围-1"><a href="#bean的作用域范围-1" class="headerlink" title="bean的作用域范围"></a>bean的作用域范围</h3><p>prototype    原 型 =&gt; 每次创建一个实例<br>singleton     单 例 =&gt;一个bean的定义，只有一个实例，不是之前那种单例 一个类只有一个<br>request        一个请求一个实例<br>session        一个会话一个实例<br>websocket    一次websocket链接一个实例</p><h3 id="bean的生命周期-1"><a href="#bean的生命周期-1" class="headerlink" title="bean的生命周期"></a>bean的生命周期</h3><p>声明周期两种方式：==只有单例有效果==</p><ol><li><p>自己写开始结束的方法<br>在bean的配置中，添加init-method=“初始化的方法”，destroy-method=“销毁的方法”</p></li><li><p>实现开始结束的接口 重写方法<br>在类上实现InitializingBean,DisposableBean 方法</p></li></ol><h2 id="IoC的配置-1"><a href="#IoC的配置-1" class="headerlink" title="IoC的配置"></a>IoC的配置</h2><h3 id="1-通过注解来配置IoC-1"><a href="#1-通过注解来配置IoC-1" class="headerlink" title="1. 通过注解来配置IoC"></a>1. 通过注解来配置IoC</h3><p>在XML中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"要扫描的注解的包路径“/&gt;</span></span></span><br></pre></td></tr></table></figure><p>==注解有==<br>@Controller<br>@Service<br>@Repository 这是dao的<br>@Autowired 自动依赖注入 就可以不用setter<br>@Component 不是上面三层的就统一用这个<br>@Value 注入基本数据类型 可以注入配置的值</p><p>作用域用：<br>@Scope（“propertype”）<br>生命周期<br>@PostConstruct  初始化的方法上加<br>@PreDestroy    摧毁的方法上加</p><p>==<strong>当你加了注解的时候，Spring会自动将类名第一个首字母小写作为bean的id，因为是加在类上，所以class也省略配置了</strong>==</p><h3 id="2-Java类配置IoC-1"><a href="#2-Java类配置IoC-1" class="headerlink" title="2.Java类配置IoC"></a>2.Java类配置IoC</h3><p><em>使用java类来代替XML</em></p><p><strong>@Configuration 用于标记一个类为配置类<br>@Bean  标记某个方法返回值为spring的bean<br>@ComponentScan（要扫描的包） 打开扫描包的注解</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserService <span class="title">userService</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//        第一种推荐 @Bean就是来获得对象的 要注入信息就调用方法</span></span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserService();</span><br><span class="line">        userService.setUserDao(userDao());</span><br><span class="line">        <span class="keyword">return</span> userService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDao <span class="title">userDao</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserDao();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserController <span class="title">userController</span><span class="params">(UserService userService)</span></span>&#123;</span><br><span class="line"><span class="comment">//        第二种 通过传入参数 spring自己找对应的bean</span></span><br><span class="line">        UserController userController=<span class="keyword">new</span> UserController();</span><br><span class="line">        userController.setUserService(userService);</span><br><span class="line">        <span class="keyword">return</span> userController;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//   获得DruidDataSource</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">druidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DruidDataSource dds = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line"><span class="comment">//        设置每个属性</span></span><br><span class="line">        dds.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">        dds.setUsername(<span class="string">"root"</span>);</span><br><span class="line">        dds.setPassword(<span class="string">"root123"</span>);</span><br><span class="line">        dds.setUrl(<span class="string">"jdbc:mysql://localhost:3306/demo);</span></span><br><span class="line"><span class="string">        return  dds;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    @Bean</span></span><br><span class="line"><span class="string">    public QueryRunner queryRunner()&#123;</span></span><br><span class="line"><span class="string">//        指定druidDataSource当然也可以不指定 让spring自己去找</span></span><br><span class="line"><span class="string">        QueryRunner qr = new QueryRunner(druidDataSource());</span></span><br><span class="line"><span class="string">        return qr;</span></span><br><span class="line"><span class="string">    &#125;   </span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"DataBase.properties"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;driverClassName&#125;"</span>)</span><br><span class="line">String driverClassName;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;url&#125;"</span>)</span><br><span class="line">String url;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;username&#125;"</span>)</span><br><span class="line">String username;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;password&#125;"</span>)</span><br><span class="line">String password;</span><br></pre></td></tr></table></figure><p><strong>在使用的时候就得使用下面的进行调用了</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(AppConfigScan<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure><p>@ComponentScan（要扫描的包） 打开扫描包的注解等价于<br>&lt;context:component-scan base-package=”xxx”&gt;</p><p> 这个时候就要用 @Controller @Service 直接生成bean 就不用自己@Bean来生成bean</p><h3 id="多种的混用-1"><a href="#多种的混用-1" class="headerlink" title="多种的混用"></a>多种的混用</h3><p>在注解类上可以使用@Import（.class）导入Java配置  用@ImportResource(.xml)导入Xml的配置</p><p>==讲了这么久 讲讲IoC的优势==</p><h3 id="IoC优势-1"><a href="#IoC优势-1" class="headerlink" title="IoC优势"></a>IoC优势</h3><ol><li>解耦合 （一个类跟一个类的关系就是耦合度）  降低了类与类之间的耦合度</li><li>提升了代码的灵活性，可维护性。因为一个类可能有多个实现，当不同需求的时候在xml中切换下就行</li></ol><h2 id="AOP-1"><a href="#AOP-1" class="headerlink" title="AOP"></a>AOP</h2><p>OOP：这是刚开始学Java就学的面相对象编程<br>今天讨论的是AOP：Aspect Oritented Programming</p><p>AOP：面相切面编程——为了解决公共、系统的问题</p><p><strong>那么哪些是属于公共、系统的问题呢？</strong><br>    比如打印日志，打印参数调用，执行时间，事务管理，安全验证…….</p><p>了解了这些，我们来看下AOP中的名词</p><h3 id="名词解释-1"><a href="#名词解释-1" class="headerlink" title="名词解释"></a>名词解释</h3><p><strong>连接点</strong>：    JoinPoint     需要加入功能的位置(通常是方法)</p><p><strong>切入点</strong>：    Pointcut     真正执行加入功能的连接点，从连接点中选出需要加入功能的连接点</p><p><strong>通知</strong>：        Advice         需要实现的功能</p><p><strong>切面</strong>：        Aspect         Java语言中将切入点和通知组装在一起的代码单元</p><p><strong>目标对象</strong>：    Target         要操作的对象，方法（连接点）所在的对象</p><p><strong>织入</strong>：        Weave         将功能加入到切入点中的过程</p><h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤"></a>步骤</h3><h4 id="配置方式1（较为麻烦）-1"><a href="#配置方式1（较为麻烦）-1" class="headerlink" title="配置方式1（较为麻烦）"></a>配置方式1（较为麻烦）</h4><ol><li>编写service类<ol start="2"><li>编写通知  ， 实现MethodBeforeAdvice接口（等下详细讲通知）</li><li>配置xml</li></ol></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置目标对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"com.spring.aop.service.impl.UserServiceImpl"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置通知: 实现了打日志的功能--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beforeExecution"</span> <span class="attr">class</span>=<span class="string">"com.spring.aop.component.BeforeExecution"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--切入点：写到需要增加功能的方法--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"pointCut"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.JdkRegexpMethodPointcut"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">"com.spring.aop.service.impl.UserServiceImpl.addUser"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--切面：连接切入点和通知，让打日志功能在切入点的位置执行--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspect"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.support.DefaultPointcutAdvisor"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"pointcut"</span> <span class="attr">ref</span>=<span class="string">"pointCut"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"advice"</span> <span class="attr">ref</span>=<span class="string">"beforeExecution"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--包装userService--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="配置方式2-aop：config-1"><a href="#配置方式2-aop：config-1" class="headerlink" title="配置方式2 aop：config"></a>配置方式2 aop：config</h4><p>非环绕式的通知</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置通知--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"tx"</span> <span class="attr">class</span>=<span class="string">"com.demo.Trans"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置切面--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"tx"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置切入点--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"servicePointcut"</span> <span class="attr">expression</span>=<span class="string">"executon(* com.demo.aop.*.*(..)"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--前置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"begin"</span> <span class="attr">pointcut-ref</span>=<span class="string">"servicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--后--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"begin"</span> <span class="attr">pointcut-ref</span>=<span class="string">"servicePointcut"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>expression语法：转载 <a href="https://zhuanlan.zhihu.com/p/63001123" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/63001123</a><br>环绕式通知，就只需要一个就够了<br><img src="https://img-blog.csdnimg.cn/20191103122312880.png" alt="在这里插入图片描述"></p><h4 id="注解式配置-1"><a href="#注解式配置-1" class="headerlink" title="注解式配置"></a>注解式配置</h4><p><img src="https://img-blog.csdnimg.cn/20191103122444263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTQxNzIxMQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><strong>注解式的配置切面就如下的配置</strong>：<br>@Aspect  切面<br>@Pointcut    切入点<br>@Around     环绕式<br>@Before     前置<br>@After     后置<br>@AfterThrowing     抛出异常<br>@EnableAspectJAutoProxy  自动扫包等价于aop:aspectj-autoproxy</p>]]></content>
    
    
    <summary type="html">什么是框架?spring详解</summary>
    
    
    
    <category term="spring" scheme="https://floatinghua.github.io/categories/spring/"/>
    
    
    <category term="框架" scheme="https://floatinghua.github.io/tags/%E6%A1%86%E6%9E%B6/"/>
    
  </entry>
  
</feed>
